import{L as oo,a as tt,F as ki,C as fe,w as so,q as ao,r as Gi,k as Xe,x as mt,d as it,s as Ae,y as Ln,z as ji,I as lo,Q as Ce,N as uo,E as Wi,H as co,J as ho,K as fo,U as Vi,X as po,Y as go,R as yn,Z as Xi,_ as mo,$ as yo,T as vo,a0 as _o,a1 as xo,a2 as St,P as To,g as hn,f as Eo,a3 as Wt,a4 as Lo,B as Yi,a5 as Ki,j as Kt,a6 as wo,a7 as qi,h as Ro,a8 as Mo,a9 as So,i as Ao,G as dn,n as Zi,aa as bo,ab as $i,ac as Io,ad as _i,ae as Oo,af as Po,ag as Co,O as Ji,M as De,ah as wn,b as vn,ai as xi,aj as Do,V as q,ak as No,al as At,t as Uo,S as Qi,am as xe,an as Ye,ao as Fe,ap as Ho,aq as er,ar as tr,as as et,at as Ti,v as Fo,W as zo,o as Bo,au as ko,av as Go}from"./OrbitControls.a92ccbbb.js";import{_ as nr,o as jo,a as ir,c as rr,b as Rn,f as Wo,g as Vo}from"./index.a9d7f838.js";const ie=(a,e,n)=>Math.max(Math.min(a,n),e),Se=(a,e,n)=>(ie(a,e,n)-e)/(n-e),ct={Face:{eye:{l:1,r:1},mouth:{x:0,y:0,shape:{A:0,E:0,I:0,O:0,U:0}},head:{x:0,y:0,z:0,width:.3,height:.6,position:{x:.5,y:.5,z:0}},brow:0,pupil:{x:0,y:0}},Pose:{RightUpperArm:{x:0,y:0,z:-1.25},LeftUpperArm:{x:0,y:0,z:1.25},RightLowerArm:{x:0,y:0,z:0},LeftLowerArm:{x:0,y:0,z:0},LeftUpperLeg:{x:0,y:0,z:0},RightUpperLeg:{x:0,y:0,z:0},RightLowerLeg:{x:0,y:0,z:0},LeftLowerLeg:{x:0,y:0,z:0},LeftHand:{x:0,y:0,z:0},RightHand:{x:0,y:0,z:0},Spine:{x:0,y:0,z:0},Hips:{position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0}}},RightHand:{RightWrist:{x:-.13,y:-.07,z:-1.04},RightRingProximal:{x:0,y:0,z:-.13},RightRingIntermediate:{x:0,y:0,z:-.4},RightRingDistal:{x:0,y:0,z:-.04},RightIndexProximal:{x:0,y:0,z:-.24},RightIndexIntermediate:{x:0,y:0,z:-.25},RightIndexDistal:{x:0,y:0,z:-.06},RightMiddleProximal:{x:0,y:0,z:-.09},RightMiddleIntermediate:{x:0,y:0,z:-.44},RightMiddleDistal:{x:0,y:0,z:-.06},RightThumbProximal:{x:-.23,y:-.33,z:-.12},RightThumbIntermediate:{x:-.2,y:-.199,z:-.0139},RightThumbDistal:{x:-.2,y:.002,z:.15},RightLittleProximal:{x:0,y:0,z:-.09},RightLittleIntermediate:{x:0,y:0,z:-.225},RightLittleDistal:{x:0,y:0,z:-.1}},LeftHand:{LeftWrist:{x:-.13,y:-.07,z:-1.04},LeftRingProximal:{x:0,y:0,z:.13},LeftRingIntermediate:{x:0,y:0,z:.4},LeftRingDistal:{x:0,y:0,z:.049},LeftIndexProximal:{x:0,y:0,z:.24},LeftIndexIntermediate:{x:0,y:0,z:.25},LeftIndexDistal:{x:0,y:0,z:.06},LeftMiddleProximal:{x:0,y:0,z:.09},LeftMiddleIntermediate:{x:0,y:0,z:.44},LeftMiddleDistal:{x:0,y:0,z:.066},LeftThumbProximal:{x:-.23,y:.33,z:.12},LeftThumbIntermediate:{x:-.2,y:.25,z:.05},LeftThumbDistal:{x:-.2,y:.17,z:-.06},LeftLittleProximal:{x:0,y:0,z:.17},LeftLittleIntermediate:{x:0,y:0,z:.4},LeftLittleDistal:{x:0,y:0,z:.1}}},oe="Right",we="Left",Q=Math.PI,ht=Math.PI*2;class T{constructor(e,n,i){var r,s,l,c,h,f;if(Array.isArray(e)){this.x=(r=e[0])!==null&&r!==void 0?r:0,this.y=(s=e[1])!==null&&s!==void 0?s:0,this.z=(l=e[2])!==null&&l!==void 0?l:0;return}if(!!e&&typeof e=="object"){this.x=(c=e.x)!==null&&c!==void 0?c:0,this.y=(h=e.y)!==null&&h!==void 0?h:0,this.z=(f=e.z)!==null&&f!==void 0?f:0;return}this.x=e!=null?e:0,this.y=n!=null?n:0,this.z=i!=null?i:0}negative(){return new T(-this.x,-this.y,-this.z)}add(e){return e instanceof T?new T(this.x+e.x,this.y+e.y,this.z+e.z):new T(this.x+e,this.y+e,this.z+e)}subtract(e){return e instanceof T?new T(this.x-e.x,this.y-e.y,this.z-e.z):new T(this.x-e,this.y-e,this.z-e)}multiply(e){return e instanceof T?new T(this.x*e.x,this.y*e.y,this.z*e.z):new T(this.x*e,this.y*e,this.z*e)}divide(e){return e instanceof T?new T(this.x/e.x,this.y/e.y,this.z/e.z):new T(this.x/e,this.y/e,this.z/e)}equals(e){return this.x==e.x&&this.y==e.y&&this.z==e.z}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}cross(e){return new T(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)}length(){return Math.sqrt(this.dot(this))}distance(e,n=3){return Math.sqrt(n===2?Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2):Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2)+Math.pow(this.z-e.z,2))}lerp(e,n){return e.subtract(this).multiply(n).add(this)}unit(){return this.divide(this.length())}min(){return Math.min(Math.min(this.x,this.y),this.z)}max(){return Math.max(Math.max(this.x,this.y),this.z)}toSphericalCoords(e={x:"x",y:"y",z:"z"}){return{theta:Math.atan2(this[e.y],this[e.x]),phi:Math.acos(this[e.z]/this.length())}}angleTo(e){return Math.acos(this.dot(e)/(this.length()*e.length()))}toArray(e){return[this.x,this.y,this.z].slice(0,e||3)}clone(){return new T(this.x,this.y,this.z)}init(e,n,i){return this.x=e,this.y=n,this.z=i,this}static negative(e,n=new T){return n.x=-e.x,n.y=-e.y,n.z=-e.z,n}static add(e,n,i=new T){return n instanceof T?(i.x=e.x+n.x,i.y=e.y+n.y,i.z=e.z+n.z):(i.x=e.x+n,i.y=e.y+n,i.z=e.z+n),i}static subtract(e,n,i=new T){return n instanceof T?(i.x=e.x-n.x,i.y=e.y-n.y,i.z=e.z-n.z):(i.x=e.x-n,i.y=e.y-n,i.z=e.z-n),i}static multiply(e,n,i=new T){return n instanceof T?(i.x=e.x*n.x,i.y=e.y*n.y,i.z=e.z*n.z):(i.x=e.x*n,i.y=e.y*n,i.z=e.z*n),i}static divide(e,n,i=new T){return n instanceof T?(i.x=e.x/n.x,i.y=e.y/n.y,i.z=e.z/n.z):(i.x=e.x/n,i.y=e.y/n,i.z=e.z/n),i}static cross(e,n,i=new T){return i.x=e.y*n.z-e.z*n.y,i.y=e.z*n.x-e.x*n.z,i.z=e.x*n.y-e.y*n.x,i}static unit(e,n){const i=e.length();return n.x=e.x/i,n.y=e.y/i,n.z=e.z/i,n}static fromAngles(e,n){return new T(Math.cos(e)*Math.cos(n),Math.sin(n),Math.sin(e)*Math.cos(n))}static randomDirection(){return T.fromAngles(Math.random()*ht,Math.asin(Math.random()*2-1))}static min(e,n){return new T(Math.min(e.x,n.x),Math.min(e.y,n.y),Math.min(e.z,n.z))}static max(e,n){return new T(Math.max(e.x,n.x),Math.max(e.y,n.y),Math.max(e.z,n.z))}static lerp(e,n,i){return n instanceof T?n.subtract(e).multiply(i).add(e):(n-e)*i+e}static fromArray(e){return Array.isArray(e)?new T(e[0],e[1],e[2]):new T(e.x,e.y,e.z)}static angleBetween(e,n){return e.angleTo(n)}static distance(e,n,i){return Math.sqrt(i===2?Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2):Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)+Math.pow(e.z-n.z,2))}static toDegrees(e){return e*(180/Q)}static normalizeAngle(e){let n=e%ht;return n=n>Q?n-ht:n<-Q?ht+n:n,n/Q}static normalizeRadians(e){return e>=Q/2&&(e-=ht),e<=-Q/2&&(e+=ht,e=Q-e),e/Q}static find2DAngle(e,n,i,r){const s=r-n,l=i-e;return Math.atan2(s,l)}static findRotation(e,n,i=!0){return i?new T(T.normalizeRadians(T.find2DAngle(e.z,e.x,n.z,n.x)),T.normalizeRadians(T.find2DAngle(e.z,e.y,n.z,n.y)),T.normalizeRadians(T.find2DAngle(e.x,e.y,n.x,n.y))):new T(T.find2DAngle(e.z,e.x,n.z,n.x),T.find2DAngle(e.z,e.y,n.z,n.y),T.find2DAngle(e.x,e.y,n.x,n.y))}static rollPitchYaw(e,n,i){if(!i)return new T(T.normalizeAngle(T.find2DAngle(e.z,e.y,n.z,n.y)),T.normalizeAngle(T.find2DAngle(e.z,e.x,n.z,n.x)),T.normalizeAngle(T.find2DAngle(e.x,e.y,n.x,n.y)));const r=n.subtract(e),s=i.subtract(e),c=r.cross(s).unit(),h=r.unit(),f=c.cross(h),m=Math.asin(c.x)||0,p=Math.atan2(-c.y,c.z)||0,L=Math.atan2(-f.x,h.x)||0;return new T(T.normalizeAngle(p),T.normalizeAngle(m),T.normalizeAngle(L))}static angleBetween3DCoords(e,n,i){e instanceof T||(e=new T(e),n=new T(n),i=new T(i));const r=e.subtract(n),s=i.subtract(n),l=r.unit(),c=s.unit(),h=l.dot(c),f=Math.acos(h);return T.normalizeRadians(f)}static getRelativeSphericalCoords(e,n,i,r){e instanceof T||(e=new T(e),n=new T(n),i=new T(i));const s=n.subtract(e),l=i.subtract(n),c=s.unit(),h=l.unit(),{theta:f,phi:m}=c.toSphericalCoords(r),{theta:p,phi:L}=h.toSphericalCoords(r),x=f-p,y=m-L;return{theta:T.normalizeAngle(x),phi:T.normalizeAngle(y)}}static getSphericalCoords(e,n,i={x:"x",y:"y",z:"z"}){e instanceof T||(e=new T(e),n=new T(n));const s=n.subtract(e).unit(),{theta:l,phi:c}=s.toSphericalCoords(i);return{theta:T.normalizeAngle(-l),phi:T.normalizeAngle(Q/2-c)}}}const or=a=>{const e={r:T.findRotation(a[11],a[13]),l:T.findRotation(a[12],a[14])};e.r.y=T.angleBetween3DCoords(a[12],a[11],a[13]),e.l.y=T.angleBetween3DCoords(a[11],a[12],a[14]);const n={r:T.findRotation(a[13],a[15]),l:T.findRotation(a[14],a[16])};n.r.y=T.angleBetween3DCoords(a[11],a[13],a[15]),n.l.y=T.angleBetween3DCoords(a[12],a[14],a[16]),n.r.z=ie(n.r.z,-2.14,0),n.l.z=ie(n.l.z,-2.14,0);const i={r:T.findRotation(T.fromArray(a[15]),T.lerp(T.fromArray(a[17]),T.fromArray(a[19]),.5)),l:T.findRotation(T.fromArray(a[16]),T.lerp(T.fromArray(a[18]),T.fromArray(a[20]),.5))},r=Ei(e.r,n.r,i.r,oe),s=Ei(e.l,n.l,i.l,we);return{UpperArm:{r:r.UpperArm,l:s.UpperArm},LowerArm:{r:r.LowerArm,l:s.LowerArm},Hand:{r:r.Hand,l:s.Hand},Unscaled:{UpperArm:e,LowerArm:n,Hand:i}}},Ei=(a,e,n,i=oe)=>{const r=i===oe?1:-1;return a.z*=-2.3*r,a.y*=Q*r,a.y-=Math.max(e.x),a.y-=-r*Math.max(e.z,0),a.x-=.3*r,e.z*=-2.14*r,e.y*=2.14*r,e.x*=2.14*r,a.x=ie(a.x,-.5,Q),e.x=ie(e.x,-.3,.3),n.y=ie(n.z*2,-.6,.6),n.z=n.z*-2.3*r,{UpperArm:a,LowerArm:e,Hand:n}},sr=(a,e)=>{const n=T.fromArray(e[23]),i=T.fromArray(e[24]),r=T.fromArray(e[11]),s=T.fromArray(e[12]),l=n.lerp(i,1),c=r.lerp(s,1),h=l.distance(c),f={position:{x:ie(l.x-.4,-1,1),y:0,z:ie(h-1,-2,0)}};f.worldPosition={x:f.position.x,y:0,z:f.position.z*Math.pow(f.position.z*-2,2)},f.worldPosition.x*=f.worldPosition.z,f.rotation=T.rollPitchYaw(a[23],a[24]),f.rotation.y>.5&&(f.rotation.y-=2),f.rotation.y+=.5,f.rotation.z>0&&(f.rotation.z=1-f.rotation.z),f.rotation.z<0&&(f.rotation.z=-1-f.rotation.z);const m=Se(Math.abs(f.rotation.y),.2,.4);f.rotation.z*=1-m,f.rotation.x=0;const p=T.rollPitchYaw(a[11],a[12]);p.y>.5&&(p.y-=2),p.y+=.5,p.z>0&&(p.z=1-p.z),p.z<0&&(p.z=-1-p.z);const L=Se(Math.abs(p.y),.2,.4);return p.z*=1-L,p.x=0,Xo(f,p)},Xo=(a,e)=>(a.rotation&&(a.rotation.x*=Math.PI,a.rotation.y*=Math.PI,a.rotation.z*=Math.PI),e.x*=Q,e.y*=Q,e.z*=Q,{Hips:a,Spine:e});class Vt{constructor(e,n,i,r){var s,l,c,h;if(!!e&&typeof e=="object"){this.x=(s=e.x)!==null&&s!==void 0?s:0,this.y=(l=e.y)!==null&&l!==void 0?l:0,this.z=(c=e.z)!==null&&c!==void 0?c:0,this.rotationOrder=(h=e.rotationOrder)!==null&&h!==void 0?h:"XYZ";return}this.x=e!=null?e:0,this.y=n!=null?n:0,this.z=i!=null?i:0,this.rotationOrder=r!=null?r:"XYZ"}multiply(e){return new Vt(this.x*e,this.y*e,this.z*e,this.rotationOrder)}}const Yo={upperLeg:{z:.1}},ar=a=>{const e=T.getSphericalCoords(a[23],a[25],{x:"y",y:"z",z:"x"}),n=T.getSphericalCoords(a[24],a[26],{x:"y",y:"z",z:"x"}),i=T.getRelativeSphericalCoords(a[23],a[25],a[27],{x:"y",y:"z",z:"x"}),r=T.getRelativeSphericalCoords(a[24],a[26],a[28],{x:"y",y:"z",z:"x"}),s=T.findRotation(a[23],a[24]),l={r:new T({x:e.theta,y:i.phi,z:e.phi-s.z}),l:new T({x:n.theta,y:r.phi,z:n.phi-s.z})},c={r:new T({x:-Math.abs(i.theta),y:0,z:0}),l:new T({x:-Math.abs(r.theta),y:0,z:0})},h=Li(l.r,c.r,oe),f=Li(l.l,c.l,we);return{UpperLeg:{r:h.UpperLeg,l:f.UpperLeg},LowerLeg:{r:h.LowerLeg,l:f.LowerLeg},Unscaled:{UpperLeg:l,LowerLeg:c}}},Li=(a,e,n=oe)=>{const i=n===oe?1:-1,r=new Vt({x:ie(a.x,0,.5)*Q,y:ie(a.y,-.25,.25)*Q,z:ie(a.z,-.5,.5)*Q+i*Yo.upperLeg.z,rotationOrder:"XYZ"}),s=new Vt({x:e.x*Q,y:e.y*Q,z:e.z*Q});return{UpperLeg:r,LowerLeg:s}};class qt{static solve(e,n,{runtime:i="mediapipe",video:r=null,imageSize:s=null,enableLegs:l=!0}={}){var c,h,f,m;if(!e&&!n){console.error("Need both World Pose and Pose Landmarks");return}if(r){const R=typeof r=="string"?document.querySelector(r):r;s={width:R.videoWidth,height:R.videoHeight}}if(i==="tfjs"&&s){for(const R of e)R.visibility=R.score;for(const R of n)R.x/=s.width,R.y/=s.height,R.z=0,R.visibility=R.score}const p=or(e),L=sr(e,n),x=l?ar(e):null,y=e[15].y>.1||((c=e[15].visibility)!==null&&c!==void 0?c:0)<.23||.995<n[15].y,E=e[16].y>.1||((h=e[16].visibility)!==null&&h!==void 0?h:0)<.23||.995<n[16].y,M=e[23].y>.1||((f=e[23].visibility)!==null&&f!==void 0?f:0)<.63||L.Hips.position.z>-.4,S=e[24].y>.1||((m=e[24].visibility)!==null&&m!==void 0?m:0)<.63||L.Hips.position.z>-.4;return p.UpperArm.l=p.UpperArm.l.multiply(E?0:1),p.UpperArm.l.z=E?ct.Pose.LeftUpperArm.z:p.UpperArm.l.z,p.UpperArm.r=p.UpperArm.r.multiply(y?0:1),p.UpperArm.r.z=y?ct.Pose.RightUpperArm.z:p.UpperArm.r.z,p.LowerArm.l=p.LowerArm.l.multiply(E?0:1),p.LowerArm.r=p.LowerArm.r.multiply(y?0:1),p.Hand.l=p.Hand.l.multiply(E?0:1),p.Hand.r=p.Hand.r.multiply(y?0:1),x&&(x.UpperLeg.l=x.UpperLeg.l.multiply(S?0:1),x.UpperLeg.r=x.UpperLeg.r.multiply(M?0:1),x.LowerLeg.l=x.LowerLeg.l.multiply(S?0:1),x.LowerLeg.r=x.LowerLeg.r.multiply(M?0:1)),{RightUpperArm:p.UpperArm.r,RightLowerArm:p.LowerArm.r,LeftUpperArm:p.UpperArm.l,LeftLowerArm:p.LowerArm.l,RightHand:p.Hand.r,LeftHand:p.Hand.l,RightUpperLeg:x?x.UpperLeg.r:ct.Pose.RightUpperLeg,RightLowerLeg:x?x.LowerLeg.r:ct.Pose.RightLowerLeg,LeftUpperLeg:x?x.UpperLeg.l:ct.Pose.LeftUpperLeg,LeftLowerLeg:x?x.LowerLeg.l:ct.Pose.LeftLowerLeg,Hips:L.Hips,Spine:L.Spine}}}qt.calcArms=or;qt.calcHips=sr;qt.calcLegs=ar;class wi{static solve(e,n=oe){if(!e){console.error("Need Hand Landmarks");return}const i=[new T(e[0]),new T(e[n===oe?17:5]),new T(e[n===oe?5:17])],r=T.rollPitchYaw(i[0],i[1],i[2]);r.y=r.z,r.y-=.4;let s={};return s[n+"Wrist"]={x:r.x,y:r.y,z:r.z},s[n+"RingProximal"]={x:0,y:0,z:T.angleBetween3DCoords(e[0],e[13],e[14])},s[n+"RingIntermediate"]={x:0,y:0,z:T.angleBetween3DCoords(e[13],e[14],e[15])},s[n+"RingDistal"]={x:0,y:0,z:T.angleBetween3DCoords(e[14],e[15],e[16])},s[n+"IndexProximal"]={x:0,y:0,z:T.angleBetween3DCoords(e[0],e[5],e[6])},s[n+"IndexIntermediate"]={x:0,y:0,z:T.angleBetween3DCoords(e[5],e[6],e[7])},s[n+"IndexDistal"]={x:0,y:0,z:T.angleBetween3DCoords(e[6],e[7],e[8])},s[n+"MiddleProximal"]={x:0,y:0,z:T.angleBetween3DCoords(e[0],e[9],e[10])},s[n+"MiddleIntermediate"]={x:0,y:0,z:T.angleBetween3DCoords(e[9],e[10],e[11])},s[n+"MiddleDistal"]={x:0,y:0,z:T.angleBetween3DCoords(e[10],e[11],e[12])},s[n+"ThumbProximal"]={x:0,y:0,z:T.angleBetween3DCoords(e[0],e[1],e[2])},s[n+"ThumbIntermediate"]={x:0,y:0,z:T.angleBetween3DCoords(e[1],e[2],e[3])},s[n+"ThumbDistal"]={x:0,y:0,z:T.angleBetween3DCoords(e[2],e[3],e[4])},s[n+"LittleProximal"]={x:0,y:0,z:T.angleBetween3DCoords(e[0],e[17],e[18])},s[n+"LittleIntermediate"]={x:0,y:0,z:T.angleBetween3DCoords(e[17],e[18],e[19])},s[n+"LittleDistal"]={x:0,y:0,z:T.angleBetween3DCoords(e[18],e[19],e[20])},s=Ko(s,n),s}}const Ko=(a,e=oe)=>{const n=e===oe?1:-1,i=["Ring","Index","Little","Thumb","Middle"],r=["Proximal","Intermediate","Distal"];return a[e+"Wrist"].x=ie(a[e+"Wrist"].x*2*n,-.3,.3),a[e+"Wrist"].y=ie(a[e+"Wrist"].y*2.3,e===oe?-1.2:-.6,e===oe?.6:1.6),a[e+"Wrist"].z=a[e+"Wrist"].z*-2.3*n,i.forEach(s=>{r.forEach(l=>{const c=a[e+s+l];if(s==="Thumb"){const h={x:l==="Proximal"?2.2:0,y:l==="Proximal"?2.2:l==="Intermediate"?.7:1,z:.5},f={x:l==="Proximal"?1.2:-.2,y:l==="Proximal"?1.1*n:.1*n,z:.2*n},m={x:0,y:0,z:0};l==="Proximal"?(m.z=ie(f.z+c.z*-Q*h.z*n,e===oe?-.6:-.3,e===oe?.3:.6),m.x=ie(f.x+c.z*-Q*h.x,-.6,.3),m.y=ie(f.y+c.z*-Q*h.y*n,e===oe?-1:-.3,e===oe?.3:1)):(m.z=ie(f.z+c.z*-Q*h.z*n,-2,2),m.x=ie(f.x+c.z*-Q*h.x,-2,2),m.y=ie(f.y+c.z*-Q*h.y*n,-2,2)),c.x=m.x,c.y=m.y,c.z=m.z}else c.z=ie(c.z*-Q*n,e===oe?-Q:0,e===oe?0:Q)})}),a},qo=a=>{const e=new T(a[21]),n=new T(a[251]),i=new T(a[397]),r=new T(a[172]),s=i.lerp(r,.5);return{vector:[e,n,s],points:[e,n,i,r]}},Zo=a=>{const e=qo(a).vector,n=T.rollPitchYaw(e[0],e[1],e[2]),i=e[0].lerp(e[1],.5),r=e[0].distance(e[1]),s=i.distance(e[2]);return n.x*=-1,n.z*=-1,{y:n.y*Q,x:n.x*Q,z:n.z*Q,width:r,height:s,position:i.lerp(e[2],.5),normalized:{y:n.y,x:n.x,z:n.z},degrees:{y:n.y*180,x:n.x*180,z:n.z*180}}},bt={eye:{[we]:[130,133,160,159,158,144,145,153],[oe]:[263,362,387,386,385,373,374,380]},brow:{[we]:[35,244,63,105,66,229,230,231],[oe]:[265,464,293,334,296,449,450,451]},pupil:{[we]:[468,469,470,471,472],[oe]:[473,474,475,476,477]}},Ri=(a,e=we,{high:n=.85,low:i=.55}={})=>{const r=bt.eye[e],s=lr(a[r[0]],a[r[1]],a[r[2]],a[r[3]],a[r[4]],a[r[5]],a[r[6]],a[r[7]]),c=ie(s/.285,0,2);return{norm:Se(c,i,n),raw:c}},lr=(a,e,n,i,r,s,l,c)=>{a=new T(a),e=new T(e),n=new T(n),i=new T(i),r=new T(r),s=new T(s),l=new T(l),c=new T(c);const h=a.distance(e,2),f=n.distance(s,2),m=i.distance(l,2),p=r.distance(c,2);return(f+m+p)/3/h},Mi=(a,e=we)=>{const n=new T(a[bt.eye[e][0]]),i=new T(a[bt.eye[e][1]]),r=n.distance(i,2),s=n.lerp(i,.5),l=new T(a[bt.pupil[e][0]]),c=s.x-l.x,h=s.y-r*.075-l.y;let f=c/(r/2),m=h/(r/4);return f*=4,m*=4,{x:f,y:m}},ur=(a,e,{enableWink:n=!0,maxRot:i=.5}={})=>{a.r=ie(a.r,0,1),a.l=ie(a.l,0,1);const r=Math.abs(a.l-a.r),s=n?.8:1.2,l=a.l<.3&&a.r<.3,c=a.l>.6&&a.r>.6;return e>i?{l:a.r,r:a.r}:e<-i?{l:a.l,r:a.l}:{l:r>=s&&!l&&!c?a.l:a.r>a.l?T.lerp(a.r,a.l,.95):T.lerp(a.r,a.l,.05),r:r>=s&&!l&&!c?a.r:a.r>a.l?T.lerp(a.r,a.l,.95):T.lerp(a.r,a.l,.05)}},$o=(a,{high:e=.85,low:n=.55}={})=>{if(a.length!==478)return{l:1,r:1};const i=Ri(a,we,{high:e,low:n}),r=Ri(a,oe,{high:e,low:n});return{l:i.norm||0,r:r.norm||0}},Jo=a=>{if(a.length!==478)return{x:0,y:0};{const e=Mi(a,we),n=Mi(a,oe);return{x:(e.x+n.x)*.5||0,y:(e.y+n.y)*.5||0}}},Si=(a,e=we)=>{const n=bt.brow[e],i=lr(a[n[0]],a[n[1]],a[n[2]],a[n[3]],a[n[4]],a[n[5]],a[n[6]],a[n[7]]),r=1.15,s=.125,l=.07,c=i/r-1;return(ie(c,l,s)-l)/(s-l)},Qo=a=>{if(a.length!==478)return 0;{const e=Si(a,we),n=Si(a,oe);return(e+n)/2||0}},es=a=>{const e=new T(a[133]),n=new T(a[362]),i=new T(a[130]),r=new T(a[263]),s=e.distance(n),l=i.distance(r),c=new T(a[13]),h=new T(a[14]),f=new T(a[61]),m=new T(a[291]),p=c.distance(h),L=f.distance(m);let x=p/s,y=L/l;x=Se(x,.15,.7),y=Se(y,.45,.9),y=(y-.3)*2;const E=y,M=Se(p/s,.17,.5),S=ie(Se(E,0,1)*2*Se(M,.2,.7),0,1),R=M*.4+M*(1-S)*.6,O=M*Se(1-S,0,.3)*.1,k=Se(O,.2,1)*(1-S)*.3,$=(1-S)*Se(M,.3,1)*.4;return{x:y||0,y:x||0,shape:{A:R||0,E:k||0,I:S||0,O:$||0,U:O||0}}};class Xt{static solve(e,{runtime:n="tfjs",video:i=null,imageSize:r=null,smoothBlink:s=!1,blinkSettings:l=[]}={}){if(!e){console.error("Need Face Landmarks");return}if(i){const L=typeof i=="string"?document.querySelector(i):i;r={width:L.videoWidth,height:L.videoHeight}}if(n==="mediapipe"&&r)for(const L of e)L.x*=r.width,L.y*=r.height,L.z*=r.width;const c=Zo(e),h=es(e);l=l.length>0?l:n==="tfjs"?[.55,.85]:[.35,.5];let f=$o(e,{high:l[1],low:l[0]});s&&(f=ur(f,c.y));const m=Jo(e),p=Qo(e);return{head:c,eye:f,brow:p,pupil:m,mouth:h}}}Xt.stabilizeBlink=ur;var Be=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},Et={};(function(){var a;function e(t){var o=0;return function(){return o<t.length?{done:!1,value:t[o++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(t,o,u){return t==Array.prototype||t==Object.prototype||(t[o]=u.value),t};function i(t){t=[typeof globalThis=="object"&&globalThis,t,typeof window=="object"&&window,typeof self=="object"&&self,typeof Be=="object"&&Be];for(var o=0;o<t.length;++o){var u=t[o];if(u&&u.Math==Math)return u}throw Error("Cannot find global object")}var r=i(this);function s(t,o){if(o)e:{var u=r;t=t.split(".");for(var d=0;d<t.length-1;d++){var g=t[d];if(!(g in u))break e;u=u[g]}t=t[t.length-1],d=u[t],o=o(d),o!=d&&o!=null&&n(u,t,{configurable:!0,writable:!0,value:o})}}s("Symbol",function(t){function o(w){if(this instanceof o)throw new TypeError("Symbol is not a constructor");return new u(d+(w||"")+"_"+g++,w)}function u(w,_){this.g=w,n(this,"description",{configurable:!0,writable:!0,value:_})}if(t)return t;u.prototype.toString=function(){return this.g};var d="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",g=0;return o}),s("Symbol.iterator",function(t){if(t)return t;t=Symbol("Symbol.iterator");for(var o="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),u=0;u<o.length;u++){var d=r[o[u]];typeof d=="function"&&typeof d.prototype[t]!="function"&&n(d.prototype,t,{configurable:!0,writable:!0,value:function(){return l(e(this))}})}return t});function l(t){return t={next:t},t[Symbol.iterator]=function(){return this},t}function c(t){var o=typeof Symbol!="undefined"&&Symbol.iterator&&t[Symbol.iterator];return o?o.call(t):{next:e(t)}}function h(t){if(!(t instanceof Array)){t=c(t);for(var o,u=[];!(o=t.next()).done;)u.push(o.value);t=u}return t}var f=typeof Object.create=="function"?Object.create:function(t){function o(){}return o.prototype=t,new o},m;if(typeof Object.setPrototypeOf=="function")m=Object.setPrototypeOf;else{var p;e:{var L={a:!0},x={};try{x.__proto__=L,p=x.a;break e}catch{}p=!1}m=p?function(t,o){if(t.__proto__=o,t.__proto__!==o)throw new TypeError(t+" is not extensible");return t}:null}var y=m;function E(t,o){if(t.prototype=f(o.prototype),t.prototype.constructor=t,y)y(t,o);else for(var u in o)if(u!="prototype")if(Object.defineProperties){var d=Object.getOwnPropertyDescriptor(o,u);d&&Object.defineProperty(t,u,d)}else t[u]=o[u];t.da=o.prototype}function M(){this.l=!1,this.i=null,this.h=void 0,this.g=1,this.s=this.m=0,this.j=null}function S(t){if(t.l)throw new TypeError("Generator is already running");t.l=!0}M.prototype.o=function(t){this.h=t};function R(t,o){t.j={U:o,V:!0},t.g=t.m||t.s}M.prototype.return=function(t){this.j={return:t},this.g=this.s};function O(t,o,u){return t.g=u,{value:o}}function k(t){this.g=new M,this.h=t}function $(t,o){S(t.g);var u=t.g.i;return u?se(t,"return"in u?u.return:function(d){return{value:d,done:!0}},o,t.g.return):(t.g.return(o),C(t))}function se(t,o,u,d){try{var g=o.call(t.g.i,u);if(!(g instanceof Object))throw new TypeError("Iterator result "+g+" is not an object");if(!g.done)return t.g.l=!1,g;var w=g.value}catch(_){return t.g.i=null,R(t.g,_),C(t)}return t.g.i=null,d.call(t.g,w),C(t)}function C(t){for(;t.g.g;)try{var o=t.h(t.g);if(o)return t.g.l=!1,{value:o.value,done:!1}}catch(u){t.g.h=void 0,R(t.g,u)}if(t.g.l=!1,t.g.j){if(o=t.g.j,t.g.j=null,o.V)throw o.U;return{value:o.return,done:!0}}return{value:void 0,done:!0}}function N(t){this.next=function(o){return S(t.g),t.g.i?o=se(t,t.g.i.next,o,t.g.o):(t.g.o(o),o=C(t)),o},this.throw=function(o){return S(t.g),t.g.i?o=se(t,t.g.i.throw,o,t.g.o):(R(t.g,o),o=C(t)),o},this.return=function(o){return $(t,o)},this[Symbol.iterator]=function(){return this}}function j(t){function o(d){return t.next(d)}function u(d){return t.throw(d)}return new Promise(function(d,g){function w(_){_.done?d(_.value):Promise.resolve(_.value).then(o,u).then(w,g)}w(t.next())})}function v(t){return j(new N(new k(t)))}s("Promise",function(t){function o(_){this.h=0,this.i=void 0,this.g=[],this.o=!1;var I=this.j();try{_(I.resolve,I.reject)}catch(b){I.reject(b)}}function u(){this.g=null}function d(_){return _ instanceof o?_:new o(function(I){I(_)})}if(t)return t;u.prototype.h=function(_){if(this.g==null){this.g=[];var I=this;this.i(function(){I.l()})}this.g.push(_)};var g=r.setTimeout;u.prototype.i=function(_){g(_,0)},u.prototype.l=function(){for(;this.g&&this.g.length;){var _=this.g;this.g=[];for(var I=0;I<_.length;++I){var b=_[I];_[I]=null;try{b()}catch(D){this.j(D)}}}this.g=null},u.prototype.j=function(_){this.i(function(){throw _})},o.prototype.j=function(){function _(D){return function(G){b||(b=!0,D.call(I,G))}}var I=this,b=!1;return{resolve:_(this.C),reject:_(this.l)}},o.prototype.C=function(_){if(_===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(_ instanceof o)this.F(_);else{e:switch(typeof _){case"object":var I=_!=null;break e;case"function":I=!0;break e;default:I=!1}I?this.v(_):this.m(_)}},o.prototype.v=function(_){var I=void 0;try{I=_.then}catch(b){this.l(b);return}typeof I=="function"?this.G(I,_):this.m(_)},o.prototype.l=function(_){this.s(2,_)},o.prototype.m=function(_){this.s(1,_)},o.prototype.s=function(_,I){if(this.h!=0)throw Error("Cannot settle("+_+", "+I+"): Promise already settled in state"+this.h);this.h=_,this.i=I,this.h===2&&this.D(),this.A()},o.prototype.D=function(){var _=this;g(function(){if(_.B()){var I=r.console;typeof I!="undefined"&&I.error(_.i)}},1)},o.prototype.B=function(){if(this.o)return!1;var _=r.CustomEvent,I=r.Event,b=r.dispatchEvent;return typeof b=="undefined"?!0:(typeof _=="function"?_=new _("unhandledrejection",{cancelable:!0}):typeof I=="function"?_=new I("unhandledrejection",{cancelable:!0}):(_=r.document.createEvent("CustomEvent"),_.initCustomEvent("unhandledrejection",!1,!0,_)),_.promise=this,_.reason=this.i,b(_))},o.prototype.A=function(){if(this.g!=null){for(var _=0;_<this.g.length;++_)w.h(this.g[_]);this.g=null}};var w=new u;return o.prototype.F=function(_){var I=this.j();_.J(I.resolve,I.reject)},o.prototype.G=function(_,I){var b=this.j();try{_.call(I,b.resolve,b.reject)}catch(D){b.reject(D)}},o.prototype.then=function(_,I){function b(W,z){return typeof W=="function"?function(V){try{D(W(V))}catch(Z){G(Z)}}:z}var D,G,Y=new o(function(W,z){D=W,G=z});return this.J(b(_,D),b(I,G)),Y},o.prototype.catch=function(_){return this.then(void 0,_)},o.prototype.J=function(_,I){function b(){switch(D.h){case 1:_(D.i);break;case 2:I(D.i);break;default:throw Error("Unexpected state: "+D.h)}}var D=this;this.g==null?w.h(b):this.g.push(b),this.o=!0},o.resolve=d,o.reject=function(_){return new o(function(I,b){b(_)})},o.race=function(_){return new o(function(I,b){for(var D=c(_),G=D.next();!G.done;G=D.next())d(G.value).J(I,b)})},o.all=function(_){var I=c(_),b=I.next();return b.done?d([]):new o(function(D,G){function Y(V){return function(Z){W[V]=Z,z--,z==0&&D(W)}}var W=[],z=0;do W.push(void 0),z++,d(b.value).J(Y(W.length-1),G),b=I.next();while(!b.done)})},o});function A(t,o){t instanceof String&&(t+="");var u=0,d=!1,g={next:function(){if(!d&&u<t.length){var w=u++;return{value:o(w,t[w]),done:!1}}return d=!0,{done:!0,value:void 0}}};return g[Symbol.iterator]=function(){return g},g}var H=typeof Object.assign=="function"?Object.assign:function(t,o){for(var u=1;u<arguments.length;u++){var d=arguments[u];if(d)for(var g in d)Object.prototype.hasOwnProperty.call(d,g)&&(t[g]=d[g])}return t};s("Object.assign",function(t){return t||H}),s("Object.is",function(t){return t||function(o,u){return o===u?o!==0||1/o===1/u:o!==o&&u!==u}}),s("Array.prototype.includes",function(t){return t||function(o,u){var d=this;d instanceof String&&(d=String(d));var g=d.length;for(u=u||0,0>u&&(u=Math.max(u+g,0));u<g;u++){var w=d[u];if(w===o||Object.is(w,o))return!0}return!1}}),s("String.prototype.includes",function(t){return t||function(o,u){if(this==null)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(o instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return this.indexOf(o,u||0)!==-1}}),s("Array.prototype.keys",function(t){return t||function(){return A(this,function(o){return o})}});var U=this||self;function F(t,o){t=t.split(".");var u=U;t[0]in u||typeof u.execScript=="undefined"||u.execScript("var "+t[0]);for(var d;t.length&&(d=t.shift());)t.length||o===void 0?u[d]&&u[d]!==Object.prototype[d]?u=u[d]:u=u[d]={}:u[d]=o}function te(t){U.setTimeout(function(){throw t},0)}function P(t){te(t)}function B(t,o){P(Error("Invalid wire type: "+t+" (at position "+o+")"))}function X(){P(Error("Failed to read varint, encoding is invalid."))}function ee(t,o){return o=String.fromCharCode.apply(null,o),t==null?o:t+o}var me,yt=typeof TextDecoder!="undefined",Te,Ne=typeof TextEncoder!="undefined";function rt(t){if(Ne)t=(Te||(Te=new TextEncoder)).encode(t);else{var o=void 0;o=o===void 0?!1:o;for(var u=0,d=new Uint8Array(3*t.length),g=0;g<t.length;g++){var w=t.charCodeAt(g);if(128>w)d[u++]=w;else{if(2048>w)d[u++]=w>>6|192;else{if(55296<=w&&57343>=w){if(56319>=w&&g<t.length){var _=t.charCodeAt(++g);if(56320<=_&&57343>=_){w=1024*(w-55296)+_-56320+65536,d[u++]=w>>18|240,d[u++]=w>>12&63|128,d[u++]=w>>6&63|128,d[u++]=w&63|128;continue}else g--}if(o)throw Error("Found an unpaired surrogate");w=65533}d[u++]=w>>12|224,d[u++]=w>>6&63|128}d[u++]=w&63|128}}t=d.subarray(0,u)}return t}var ot={},vt=null;function Sn(t){var o;o===void 0&&(o=0),bn(),o=ot[o];for(var u=Array(Math.floor(t.length/3)),d=o[64]||"",g=0,w=0;g<t.length-2;g+=3){var _=t[g],I=t[g+1],b=t[g+2],D=o[_>>2];_=o[(_&3)<<4|I>>4],I=o[(I&15)<<2|b>>6],b=o[b&63],u[w++]=D+_+I+b}switch(D=0,b=d,t.length-g){case 2:D=t[g+1],b=o[(D&15)<<2]||d;case 1:t=t[g],u[w]=o[t>>2]+o[(t&3)<<4|D>>4]+b+d}return u.join("")}function An(t){var o=t.length,u=3*o/4;u%3?u=Math.floor(u):"=.".indexOf(t[o-1])!=-1&&(u="=.".indexOf(t[o-2])!=-1?u-2:u-1);var d=new Uint8Array(u),g=0;return _r(t,function(w){d[g++]=w}),d.subarray(0,g)}function _r(t,o){function u(b){for(;d<t.length;){var D=t.charAt(d++),G=vt[D];if(G!=null)return G;if(!/^[\s\xa0]*$/.test(D))throw Error("Unknown base64 encoding at char: "+D)}return b}bn();for(var d=0;;){var g=u(-1),w=u(0),_=u(64),I=u(64);if(I===64&&g===-1)break;o(g<<2|w>>4),_!=64&&(o(w<<4&240|_>>2),I!=64&&o(_<<6&192|I))}}function bn(){if(!vt){vt={};for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".split(""),o=["+/=","+/","-_=","-_.","-_"],u=0;5>u;u++){var d=t.concat(o[u].split(""));ot[u]=d;for(var g=0;g<d.length;g++){var w=d[g];vt[w]===void 0&&(vt[w]=g)}}}}var Zt=typeof Uint8Array=="function",Dt;function In(t){if(this.g=t,t!==null&&t.length===0)throw Error("ByteString should be constructed with non-empty values")}In.prototype.toJSON=function(){if(this.g==null)var t="";else t=this.g,t=this.g=t==null||typeof t=="string"?t:Zt&&t instanceof Uint8Array?Sn(t):null;return t};var xr=typeof Uint8Array.prototype.slice=="function";function On(t,o,u){return o===u?Dt||(Dt=new Uint8Array(0)):xr?t.slice(o,u):new Uint8Array(t.subarray(o,u))}var Ue=0,ke=0;function Tr(t){if(t.constructor===Uint8Array)return t;if(t.constructor===ArrayBuffer)return new Uint8Array(t);if(t.constructor===Array)return new Uint8Array(t);if(t.constructor===String)return An(t);if(t.constructor===In){if(t.g==null)var o=Dt||(Dt=new Uint8Array(0));else{o=Uint8Array;var u=t.g;u=u==null||Zt&&u!=null&&u instanceof Uint8Array?u:typeof u=="string"?An(u):null,t=t.g=u,o=new o(t)}return o}if(t instanceof Uint8Array)return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw Error("Type not convertible to a Uint8Array, expected a Uint8Array, an ArrayBuffer, a base64 encoded string, or Array of numbers")}function st(t,o){o=o===void 0?{}:o,o=o.u===void 0?!1:o.u,this.h=null,this.g=this.i=this.m=0,this.l=!1,this.u=o,t&&$t(this,t)}function $t(t,o){t.h=Tr(o),t.m=0,t.i=t.h.length,t.g=t.m}st.prototype.reset=function(){this.g=this.m};function Pn(t){for(var o=128,u=0,d=0,g=0;4>g&&128<=o;g++)o=t.h[t.g++],u|=(o&127)<<7*g;if(128<=o&&(o=t.h[t.g++],u|=(o&127)<<28,d|=(o&127)>>4),128<=o)for(g=0;5>g&&128<=o;g++)o=t.h[t.g++],d|=(o&127)<<7*g+3;if(128>o)return t=u>>>0,o=d>>>0,(d=o&2147483648)&&(t=~t+1>>>0,o=~o>>>0,t==0&&(o=o+1>>>0)),t=4294967296*o+(t>>>0),d?-t:t;t.l=!0,X()}function Ee(t){t.g>t.i&&(t.l=!0,P(Error("Tried to read past the end of the data "+t.g+" > "+t.i)))}st.prototype.j=function(){var t=this.h,o=t[this.g],u=o&127;return 128>o?(this.g+=1,Ee(this),u):(o=t[this.g+1],u|=(o&127)<<7,128>o?(this.g+=2,Ee(this),u):(o=t[this.g+2],u|=(o&127)<<14,128>o?(this.g+=3,Ee(this),u):(o=t[this.g+3],u|=(o&127)<<21,128>o?(this.g+=4,Ee(this),u):(o=t[this.g+4],u|=(o&15)<<28,128>o?(this.g+=5,Ee(this),u>>>0):(this.g+=5,128<=t[this.g++]&&128<=t[this.g++]&&128<=t[this.g++]&&128<=t[this.g++]&&128<=t[this.g++]?(this.l=!0,X(),u):(Ee(this),u))))))},st.prototype.o=function(){var t=this.h[this.g],o=this.h[this.g+1],u=this.h[this.g+2],d=this.h[this.g+3];return this.g+=4,Ee(this),u=(t<<0|o<<8|u<<16|d<<24)>>>0,t=2*(u>>31)+1,o=u>>>23&255,u&=8388607,o==255?u?NaN:1/0*t:o==0?t*Math.pow(2,-149)*u:t*Math.pow(2,o-150)*(u+Math.pow(2,23))};var Cn=[];function Jt(){this.g=new Uint8Array(64),this.h=0}function be(t,o){if(!(t.h+1<t.g.length)){var u=t.g;t.g=new Uint8Array(Math.ceil(1+2*t.g.length)),t.g.set(u)}t.g[t.h++]=o}Jt.prototype.length=function(){return this.h},Jt.prototype.end=function(){var t=this.g,o=this.h;return this.h=0,On(t,0,o)};function at(t,o){for(;127<o;)be(t,o&127|128),o>>>=7;be(t,o)}function Dn(t){var o={},u=o.N===void 0?!1:o.N;this.m={u:o.u===void 0?!1:o.u},this.N=u,o=this.m,Cn.length?(u=Cn.pop(),o&&(u.u=o.u),t&&$t(u,t),t=u):t=new st(t,o),this.g=t,this.l=this.g.g,this.h=this.i=-1,this.j=!1}Dn.prototype.reset=function(){this.g.reset(),this.h=this.i=-1};function Nn(t){var o=t.g;if((o=o.g==o.i)||(o=t.j)||(o=t.g,o=o.l||0>o.g||o.g>o.i),o)return!1;t.l=t.g.g;var u=t.g.j();return o=u>>>3,u&=7,0<=u&&5>=u?(t.i=o,t.h=u,!0):(t.j=!0,B(u,t.l),!1)}function _t(t){switch(t.h){case 0:if(t.h!=0)_t(t);else e:{t=t.g;for(var o=t.g,u=0;10>u;u++){if((t.h[o]&128)===0){t.g=o+1,Ee(t);break e}o++}t.l=!0,X()}break;case 1:t=t.g,t.g+=8,Ee(t);break;case 2:t.h!=2?_t(t):(o=t.g.j(),t=t.g,t.g+=o,Ee(t));break;case 5:t=t.g,t.g+=4,Ee(t);break;case 3:o=t.i;do{if(!Nn(t)){t.j=!0,P(Error("Unmatched start-group tag: stream EOF"));break}if(t.h==4){t.i!=o&&(t.j=!0,P(Error("Unmatched end-group tag")));break}_t(t)}while(1);break;default:t.j=!0,B(t.h,t.l)}}function Un(t,o,u){t.N||(t=On(t.g.h,u,t.g.g),(u=o.o)?u.push(t):o.o=[t])}function Hn(t,o,u){var d=t.g.i,g=t.g.j(),w=t.g.g+g;if(t.g.i=w,u(o,t),u=w-t.g.g,u!==0)throw Error("Message parsing ended unexpectedly. Expected to read "+(g+" bytes, instead read "+(g-u)+" bytes, either the data ended unexpectedly or the message misreported its own length"));return t.g.g=w,t.g.i=d,o}function Fn(t,o,u){var d=t.g.j();for(d=t.g.g+d;t.g.g<d;)u.push(o.call(t.g))}var Nt=[];function Er(){this.h=[],this.i=0,this.g=new Jt}function Ut(t,o){o.length!==0&&(t.h.push(o),t.i+=o.length)}function zn(t,o,u){at(t.g,8*o+2),at(t.g,u.length),Ut(t,t.g.end()),Ut(t,u)}var Ht=typeof Symbol=="function"&&typeof Symbol()=="symbol"?Symbol(void 0):void 0;function Bn(t,o){Object.isFrozen(t)||(Ht?t[Ht]|=o:t.g!==void 0?t.g|=o:Object.defineProperties(t,{g:{value:o,configurable:!0,writable:!0,enumerable:!1}}))}function Qt(t){if(!t)return 0;var o;return Ht?o=t[Ht]:o=t.g,o==null?0:o}function xt(t){return Array.isArray(t)&&Bn(t,1),t}function kn(t){if(!Array.isArray(t))throw Error("cannot mark non-array as immutable");Bn(t,2)}function Gn(t){return t!==null&&typeof t=="object"&&t.constructor===Object}function Lr(t){switch(typeof t){case"number":return isFinite(t)?t:String(t);case"object":return Zt&&t!=null&&t instanceof Uint8Array?Sn(t):t;default:return t}}function jn(t,o){if(t!=null)return Array.isArray(t)||Gn(t)?Wn(t,o):o(t)}function Wn(t,o){if(Array.isArray(t)){for(var u=Array(t.length),d=0;d<t.length;d++)u[d]=jn(t[d],o);return Qt(t)&1&&xt(u),u}u={};for(d in t)u[d]=jn(t[d],o);return u}var Vn;function he(t,o,u){var d=Vn;Vn=null,t||(t=d),d=this.constructor.ba,t||(t=d?[d]:[]),this.j=(d?0:-1)-(this.constructor.$||0),this.m=this.g=null,this.h=t;e:{if(d=this.h.length,t=d-1,d&&(d=this.h[t],Gn(d))){this.l=t-this.j,this.i=d;break e}o!==void 0&&-1<o?(this.l=Math.max(o,t+1-this.j),this.i=null):this.l=Number.MAX_VALUE}if(u)for(o=0;o<u.length;o++)t=u[o],t<this.l?(t+=this.j,(d=this.h[t])?xt(d):this.h[t]=Ft):(Xn(this),(d=this.i[t])?xt(d):this.i[t]=Ft)}var Ft=Object.freeze(xt([]));function Xn(t){var o=t.l+t.j;t.h[o]||(t.i=t.h[o]={})}function ye(t,o,u){return o===-1?null:(u===void 0?0:u)||o>=t.l?t.i?t.i[o]:void 0:t.h[o+t.j]}function lt(t,o,u){u=u===void 0?!0:u;var d=d===void 0?!1:d,g=ye(t,o,d);return g==null&&(g=Ft),g===Ft?(g=xt([]),le(t,o,g,d)):u&&Array.isArray(g)&&Qt(g)&2&&(g=g.slice(),le(t,o,g,d)),g}function Yn(t){var o=lt(t,3,!1);if(t.m||(t.m={}),!t.m[3]){for(var u=0;u<o.length;u++)o[u]=+o[u];t.m[3]=!0}return o}function qe(t,o,u){return t=ye(t,o),t==null?u:t}function Ie(t,o,u){return t=ye(t,o),t=t==null?t:+t,t==null?u===void 0?0:u:t}function le(t,o,u,d){(d===void 0?0:d)||o>=t.l?(Xn(t),t.i[o]=u):t.h[o+t.j]=u}function Kn(t,o,u){if(u===-1)return null;t.g||(t.g={});var d=t.g[u];if(d)return d;var g=ye(t,u,!1);return g==null?d:(o=new o(g),t.g[u]=o)}function en(t,o,u){t.g||(t.g={});var d=t.g[u];if(!d){var g=lt(t,u,!1);d=[];for(var w=Array.isArray(g)?!!(Qt(g)&2):!1,_=0;_<g.length;_++)d[_]=new o(g[_]),w&&kn(d[_].h);w&&(kn(d),Object.freeze(d)),t.g[u]=d}return d}function qn(t,o,u,d,g){var w=en(t,d,o);u=u||new d,t=lt(t,o),g!=null?(w.splice(g,0,u),t.splice(g,0,Ze(u))):(w.push(u),t.push(Ze(u)))}he.prototype.toJSON=function(){var t=Ze(this);return Wn(t,Lr)};function Ze(t){if(t.g)for(var o in t.g){var u=t.g[o];if(Array.isArray(u))for(var d=0;d<u.length;d++)u[d]&&Ze(u[d]);else u&&Ze(u)}return t.h}he.prototype.toString=function(){return Ze(this).toString()};function tn(t,o){if(t=t.o){Ut(o,o.g.end());for(var u=0;u<t.length;u++)Ut(o,t[u])}}function wr(t){var o=t[0];switch(t.length){case 2:var u=t[1];return function(b,D,G){return o(b,D,G,u)};case 3:var d=t[1],g=t[2];return function(b,D,G){return o(b,D,G,d,g)};case 4:var w=t[1],_=t[2],I=t[3];return function(b,D,G){return o(b,D,G,w,_,I)};default:throw Error("unsupported number of parameters, expected [2-4], got "+t.length)}}function Ge(t,o,u){for(;Nn(o)&&o.h!=4;){var d=o.i,g=u[d];if(g){if(Array.isArray(g)&&(g=u[d]=wr(g)),!g(o,t,d)){d=o,g=t;var w=d.l;_t(d),Un(d,g,w)}}else d=o,g=t,w=d.l,_t(d),Un(d,g,w)}return t}function nn(t,o){var u=new Er;if(o(t,u),t=u.i+u.g.length(),t===0)u=new Uint8Array(0);else{t=new Uint8Array(t);for(var d=u.h,g=d.length,w=o=0;w<g;w++){var _=d[w];_.length!==0&&(t.set(_,o),o+=_.length)}d=u.g,g=d.h,g!==0&&(t.set(d.g.subarray(0,g),o),d.h=0),u.h=[t],u=t}return u}function zt(t,o,u){if(Nt.length){var d=Nt.pop();t&&($t(d.g,t),d.i=-1,d.h=-1),t=d}else t=new Dn(t);try{return u(new o,t)}finally{o=t.g,o.h=null,o.m=0,o.i=0,o.g=0,o.l=!1,o.u=!1,t.i=-1,t.h=-1,t.j=!1,100>Nt.length&&Nt.push(t)}}function Re(t,o,u){if(o=ye(o,u),o!=null){at(t.g,8*u+5),t=t.g;var d=o;d=(u=0>d?1:0)?-d:d,d===0?0<1/d?Ue=ke=0:(ke=0,Ue=2147483648):isNaN(d)?(ke=0,Ue=2147483647):34028234663852886e22<d?(ke=0,Ue=(u<<31|2139095040)>>>0):11754943508222875e-54>d?(d=Math.round(d/Math.pow(2,-149)),ke=0,Ue=(u<<31|d)>>>0):(o=Math.floor(Math.log(d)/Math.LN2),d*=Math.pow(2,-o),d=Math.round(8388608*d),16777216<=d&&++o,ke=0,Ue=(u<<31|o+127<<23|d&8388607)>>>0),u=Ue,be(t,u>>>0&255),be(t,u>>>8&255),be(t,u>>>16&255),be(t,u>>>24&255)}}function Me(t,o,u){return t.h!==5?!1:(le(o,u,t.g.o()),!0)}function Zn(t,o,u){return t.h!==5&&t.h!==2?!1:(o=lt(o,u),t.h==2?Fn(t,st.prototype.o,o):o.push(t.g.o()),!0)}function Rr(t,o,u){return t.h!==0?!1:(le(o,u,Pn(t.g)),!0)}function rn(t,o,u){return t.h!==0?!1:(le(o,u,t.g.j()),!0)}function $n(t,o,u){if(t.h!==2)return!1;var d=t.g.j();t=t.g;var g=t.g;t.g+=d,Ee(t),t=t.h;var w;if(yt)(w=me)||(w=me=new TextDecoder("utf-8",{fatal:!1})),w=w.decode(t.subarray(g,g+d));else{d=g+d;for(var _=[],I=null,b,D,G;g<d;)b=t[g++],128>b?_.push(b):224>b?g>=d?_.push(65533):(D=t[g++],194>b||(D&192)!==128?(g--,_.push(65533)):_.push((b&31)<<6|D&63)):240>b?g>=d-1?_.push(65533):(D=t[g++],(D&192)!==128||b===224&&160>D||b===237&&160<=D||((w=t[g++])&192)!==128?(g--,_.push(65533)):_.push((b&15)<<12|(D&63)<<6|w&63)):244>=b?g>=d-2?_.push(65533):(D=t[g++],(D&192)!==128||(b<<28)+(D-144)>>30!==0||((w=t[g++])&192)!==128||((G=t[g++])&192)!==128?(g--,_.push(65533)):(b=(b&7)<<18|(D&63)<<12|(w&63)<<6|G&63,b-=65536,_.push((b>>10&1023)+55296,(b&1023)+56320))):_.push(65533),8192<=_.length&&(I=ee(I,_),_.length=0);w=ee(I,_)}return le(o,u,w),!0}function Jn(t,o,u,d,g){if(t.h!==2)return!1;t=Hn(t,new d,g);var w=w===void 0?!1:w;return o.g||(o.g={}),d=t&&Ze(t),o.g[u]=t,le(o,u,d,w),!0}function Qn(t,o,u,d,g){return t.h!==2?!1:(t=Hn(t,new d,g),qn(o,u,t,d,void 0),!0)}function Mr(t,o,u){return t.h!==0&&t.h!==2?!1:(o=lt(o,u),t.h==2?Fn(t,st.prototype.j,o):o.push(t.g.j()),!0)}function on(t,o,u){return t.h!==0?!1:(le(o,u,Pn(t.g)),!0)}function $e(t){he.call(this,t,-1,Ar)}var ei;E($e,he),$e.prototype.getRows=function(){return ye(this,1)},$e.prototype.getCols=function(){return ye(this,2)},$e.prototype.getPackedDataList=function(){return Yn(this)},$e.prototype.getLayout=function(){return qe(this,4,0)};function Sr(t,o){return Ge(t,o,ei||(ei={1:rn,2:rn,3:Zn,4:on}))}var Ar=[3];function Tt(t){he.call(this,t)}var ti;E(Tt,he);function br(t,o){var u=ye(t,1);if(u!=null&&u!=null){at(o.g,8);var d=o.g;if(0<=u)at(d,u);else{for(var g=0;9>g;g++)be(d,u&127|128),u>>=7;be(d,1)}}Re(o,t,2),d=ye(t,3),d!=null&&zn(o,3,rt(d)),d=ye(t,4),d!=null&&zn(o,4,rt(d)),tn(t,o)}function Ir(t,o){return Ge(t,o,ti||(ti={1:rn,2:Me,3:$n,4:$n}))}function sn(t){he.call(this,t,-1,Pr)}var ni;E(sn,he),sn.prototype.addClassification=function(t,o){return qn(this,1,t,Tt,o),this};function Or(t,o){return Ge(t,o,ni||(ni={1:[Qn,Tt,Ir]}))}var Pr=[1];function Bt(t){he.call(this,t)}var ii;E(Bt,he);function Cr(t,o){Re(o,t,1),Re(o,t,2),Re(o,t,3),Re(o,t,4),Re(o,t,5),tn(t,o)}function Dr(t,o){return Ge(t,o,ii||(ii={1:Me,2:Me,3:Me,4:Me,5:Me}))}function ri(t){he.call(this,t,-1,Ur)}var oi;E(ri,he);function Nr(t,o){return Ge(t,o,oi||(oi={1:[Qn,Bt,Dr]}))}var Ur=[1];function an(t){he.call(this,t)}var si;E(an,he);function Hr(t,o){Re(o,t,1),Re(o,t,2),Re(o,t,3),Re(o,t,4),Re(o,t,5);var u=ye(t,6);if(u!=null&&u!=null){at(o.g,48);var d=o.g,g=u;u=0>g,g=Math.abs(g);var w=g>>>0;for(g=Math.floor((g-w)/4294967296),g>>>=0,u&&(g=~g>>>0,w=(~w>>>0)+1,4294967295<w&&(w=0,g++,4294967295<g&&(g=0))),Ue=w,ke=g,u=Ue,w=ke;0<w||127<u;)be(d,u&127|128),u=(u>>>7|w<<25)>>>0,w>>>=7;be(d,u)}tn(t,o)}function Fr(t,o){return Ge(t,o,si||(si={1:Me,2:Me,3:Me,4:Me,5:Me,6:Rr}))}function Je(t){he.call(this,t,-1,Br)}var ai;E(Je,he),Je.prototype.getVertexType=function(){return qe(this,1,0)},Je.prototype.getPrimitiveType=function(){return qe(this,2,0)},Je.prototype.getVertexBufferList=function(){return Yn(this)},Je.prototype.getIndexBufferList=function(){return lt(this,4)};function zr(t,o){return Ge(t,o,ai||(ai={1:on,2:on,3:Zn,4:Mr}))}var Br=[3,4];function kt(t){he.call(this,t)}var li;E(kt,he),kt.prototype.getMesh=function(){return Kn(this,Je,1)},kt.prototype.getPoseTransformMatrix=function(){return Kn(this,$e,2)};function kr(t,o){return Ge(t,o,li||(li={1:[Jn,Je,zr],2:[Jn,$e,Sr]}))}var ui=[[61,146],[146,91],[91,181],[181,84],[84,17],[17,314],[314,405],[405,321],[321,375],[375,291],[61,185],[185,40],[40,39],[39,37],[37,0],[0,267],[267,269],[269,270],[270,409],[409,291],[78,95],[95,88],[88,178],[178,87],[87,14],[14,317],[317,402],[402,318],[318,324],[324,308],[78,191],[191,80],[80,81],[81,82],[82,13],[13,312],[312,311],[311,310],[310,415],[415,308]],ci=[[263,249],[249,390],[390,373],[373,374],[374,380],[380,381],[381,382],[382,362],[263,466],[466,388],[388,387],[387,386],[386,385],[385,384],[384,398],[398,362]],hi=[[276,283],[283,282],[282,295],[295,285],[300,293],[293,334],[334,296],[296,336]],di=[[33,7],[7,163],[163,144],[144,145],[145,153],[153,154],[154,155],[155,133],[33,246],[246,161],[161,160],[160,159],[159,158],[158,157],[157,173],[173,133]],fi=[[46,53],[53,52],[52,65],[65,55],[70,63],[63,105],[105,66],[66,107]],pi=[[10,338],[338,297],[297,332],[332,284],[284,251],[251,389],[389,356],[356,454],[454,323],[323,361],[361,288],[288,397],[397,365],[365,379],[379,378],[378,400],[400,377],[377,152],[152,148],[148,176],[176,149],[149,150],[150,136],[136,172],[172,58],[58,132],[132,93],[93,234],[234,127],[127,162],[162,21],[21,54],[54,103],[103,67],[67,109],[109,10]],Gr=[].concat(h(ui),h(ci),h(hi),h(di),h(fi),h(pi));function gi(t,o,u){if(u=t.createShader(u===0?t.VERTEX_SHADER:t.FRAGMENT_SHADER),t.shaderSource(u,o),t.compileShader(u),!t.getShaderParameter(u,t.COMPILE_STATUS))throw Error(`Could not compile WebGL shader.

`+t.getShaderInfoLog(u));return u}function jr(t){return en(t,Tt,1).map(function(o){return{index:qe(o,1,0),score:Ie(o,2),label:ye(o,3)!=null?qe(o,3,""):void 0,displayName:ye(o,4)!=null?qe(o,4,""):void 0}})}function Wr(t){return{x:Ie(t,1),y:Ie(t,2),z:Ie(t,3),visibility:ye(t,4)!=null?Ie(t,4):void 0}}function ut(t){return en(zt(t,ri,Nr),Bt,1).map(Wr)}function ln(t,o){this.h=t,this.g=o,this.l=0}function mi(t,o,u){return Vr(t,o),typeof t.g.canvas.transferToImageBitmap=="function"?Promise.resolve(t.g.canvas.transferToImageBitmap()):u?Promise.resolve(t.g.canvas):typeof createImageBitmap=="function"?createImageBitmap(t.g.canvas):(t.i===void 0&&(t.i=document.createElement("canvas")),new Promise(function(d){t.i.height=t.g.canvas.height,t.i.width=t.g.canvas.width,t.i.getContext("2d",{}).drawImage(t.g.canvas,0,0,t.g.canvas.width,t.g.canvas.height),d(t.i)}))}function Vr(t,o){var u=t.g;if(t.m===void 0){var d=gi(u,`
  attribute vec2 aVertex;
  attribute vec2 aTex;
  varying vec2 vTex;
  void main(void) {
    gl_Position = vec4(aVertex, 0.0, 1.0);
    vTex = aTex;
  }`,0),g=gi(u,`
  precision mediump float;
  varying vec2 vTex;
  uniform sampler2D sampler0;
  void main(){
    gl_FragColor = texture2D(sampler0, vTex);
  }`,1),w=u.createProgram();if(u.attachShader(w,d),u.attachShader(w,g),u.linkProgram(w),!u.getProgramParameter(w,u.LINK_STATUS))throw Error(`Could not compile WebGL program.

`+u.getProgramInfoLog(w));d=t.m=w,u.useProgram(d),g=u.getUniformLocation(d,"sampler0"),t.j={I:u.getAttribLocation(d,"aVertex"),H:u.getAttribLocation(d,"aTex"),ca:g},t.s=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,t.s),u.enableVertexAttribArray(t.j.I),u.vertexAttribPointer(t.j.I,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,new Float32Array([-1,-1,-1,1,1,1,1,-1]),u.STATIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,null),t.o=u.createBuffer(),u.bindBuffer(u.ARRAY_BUFFER,t.o),u.enableVertexAttribArray(t.j.H),u.vertexAttribPointer(t.j.H,2,u.FLOAT,!1,0,0),u.bufferData(u.ARRAY_BUFFER,new Float32Array([0,1,0,0,1,0,1,1]),u.STATIC_DRAW),u.bindBuffer(u.ARRAY_BUFFER,null),u.uniform1i(g,0)}d=t.j,u.useProgram(t.m),u.canvas.width=o.width,u.canvas.height=o.height,u.viewport(0,0,o.width,o.height),u.activeTexture(u.TEXTURE0),t.h.bindTexture2d(o.glName),u.enableVertexAttribArray(d.I),u.bindBuffer(u.ARRAY_BUFFER,t.s),u.vertexAttribPointer(d.I,2,u.FLOAT,!1,0,0),u.enableVertexAttribArray(d.H),u.bindBuffer(u.ARRAY_BUFFER,t.o),u.vertexAttribPointer(d.H,2,u.FLOAT,!1,0,0),u.bindFramebuffer(u.DRAW_FRAMEBUFFER?u.DRAW_FRAMEBUFFER:u.FRAMEBUFFER,null),u.clearColor(0,0,0,0),u.clear(u.COLOR_BUFFER_BIT),u.colorMask(!0,!0,!0,!0),u.drawArrays(u.TRIANGLE_FAN,0,4),u.disableVertexAttribArray(d.I),u.disableVertexAttribArray(d.H),u.bindBuffer(u.ARRAY_BUFFER,null),t.h.bindTexture2d(0)}function Xr(t){this.g=t}var Yr=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,2,1,0,10,9,1,7,0,65,0,253,15,26,11]);function Kr(t,o){return o+t}function yi(t,o){window[t]=o}function qr(t){var o=document.createElement("script");return o.setAttribute("src",t),o.setAttribute("crossorigin","anonymous"),new Promise(function(u){o.addEventListener("load",function(){u()},!1),o.addEventListener("error",function(){u()},!1),document.body.appendChild(o)})}function Zr(){return v(function(t){switch(t.g){case 1:return t.m=2,O(t,WebAssembly.instantiate(Yr),4);case 4:t.g=3,t.m=0;break;case 2:return t.m=0,t.j=null,t.return(!1);case 3:return t.return(!0)}})}function un(t){if(this.g=t,this.listeners={},this.j={},this.F={},this.m={},this.s={},this.G=this.o=this.R=!0,this.C=Promise.resolve(),this.P="",this.B={},this.locateFile=t&&t.locateFile||Kr,typeof window=="object")var o=window.location.pathname.toString().substring(0,window.location.pathname.toString().lastIndexOf("/"))+"/";else if(typeof location!="undefined")o=location.pathname.toString().substring(0,location.pathname.toString().lastIndexOf("/"))+"/";else throw Error("solutions can only be loaded on a web page or in a web worker");if(this.S=o,t.options){o=c(Object.keys(t.options));for(var u=o.next();!u.done;u=o.next()){u=u.value;var d=t.options[u].default;d!==void 0&&(this.j[u]=typeof d=="function"?d():d)}}}a=un.prototype,a.close=function(){return this.i&&this.i.delete(),Promise.resolve()};function $r(t){var o,u,d,g,w,_,I,b,D,G,Y;return v(function(W){switch(W.g){case 1:return t.R?(o=t.g.files===void 0?[]:typeof t.g.files=="function"?t.g.files(t.j):t.g.files,O(W,Zr(),2)):W.return();case 2:if(u=W.h,typeof window=="object")return yi("createMediapipeSolutionsWasm",{locateFile:t.locateFile}),yi("createMediapipeSolutionsPackedAssets",{locateFile:t.locateFile}),_=o.filter(function(z){return z.data!==void 0}),I=o.filter(function(z){return z.data===void 0}),b=Promise.all(_.map(function(z){var V=cn(t,z.url);if(z.path!==void 0){var Z=z.path;V=V.then(function(re){return t.overrideFile(Z,re),Promise.resolve(re)})}return V})),D=Promise.all(I.map(function(z){return z.simd===void 0||z.simd&&u||!z.simd&&!u?qr(t.locateFile(z.url,t.S)):Promise.resolve()})).then(function(){var z,V,Z;return v(function(re){if(re.g==1)return z=window.createMediapipeSolutionsWasm,V=window.createMediapipeSolutionsPackedAssets,Z=t,O(re,z(V),2);Z.h=re.h,re.g=0})}),G=function(){return v(function(z){return t.g.graph&&t.g.graph.url?z=O(z,cn(t,t.g.graph.url),0):(z.g=0,z=void 0),z})}(),O(W,Promise.all([D,b,G]),7);if(typeof importScripts!="function")throw Error("solutions can only be loaded on a web page or in a web worker");return d=o.filter(function(z){return z.simd===void 0||z.simd&&u||!z.simd&&!u}).map(function(z){return t.locateFile(z.url,t.S)}),importScripts.apply(null,h(d)),g=t,O(W,createMediapipeSolutionsWasm(Module),6);case 6:g.h=W.h,t.l=new OffscreenCanvas(1,1),t.h.canvas=t.l,w=t.h.GL.createContext(t.l,{antialias:!1,alpha:!1,aa:typeof WebGL2RenderingContext!="undefined"?2:1}),t.h.GL.makeContextCurrent(w),W.g=4;break;case 7:if(t.l=document.createElement("canvas"),Y=t.l.getContext("webgl2",{}),!Y&&(Y=t.l.getContext("webgl",{}),!Y))return alert("Failed to create WebGL canvas context when passing video frame."),W.return();t.D=Y,t.h.canvas=t.l,t.h.createContext(t.l,!0,!0,{});case 4:t.i=new t.h.SolutionWasm,t.R=!1,W.g=0}})}function Jr(t){var o,u,d,g,w,_,I,b;return v(function(D){if(D.g==1){if(t.g.graph&&t.g.graph.url&&t.P===t.g.graph.url)return D.return();if(t.o=!0,!t.g.graph||!t.g.graph.url){D.g=2;return}return t.P=t.g.graph.url,O(D,cn(t,t.g.graph.url),3)}for(D.g!=2&&(o=D.h,t.i.loadGraph(o)),u=c(Object.keys(t.B)),d=u.next();!d.done;d=u.next())g=d.value,t.i.overrideFile(g,t.B[g]);if(t.B={},t.g.listeners)for(w=c(t.g.listeners),_=w.next();!_.done;_=w.next())I=_.value,no(t,I);b=t.j,t.j={},t.setOptions(b),D.g=0})}a.reset=function(){var t=this;return v(function(o){t.i&&(t.i.reset(),t.m={},t.s={}),o.g=0})},a.setOptions=function(t,o){var u=this;if(o=o||this.g.options){for(var d=[],g=[],w={},_=c(Object.keys(t)),I=_.next();!I.done;w={K:w.K,L:w.L},I=_.next()){var b=I.value;b in this.j&&this.j[b]===t[b]||(this.j[b]=t[b],I=o[b],I!==void 0&&(I.onChange&&(w.K=I.onChange,w.L=t[b],d.push(function(D){return function(){var G;return v(function(Y){if(Y.g==1)return O(Y,D.K(D.L),2);G=Y.h,G===!0&&(u.o=!0),Y.g=0})}}(w))),I.graphOptionXref&&(b={valueNumber:I.type===1?t[b]:0,valueBoolean:I.type===0?t[b]:!1,valueString:I.type===2?t[b]:""},I=Object.assign(Object.assign(Object.assign({},{calculatorName:"",calculatorIndex:0}),I.graphOptionXref),b),g.push(I))))}(d.length!==0||g.length!==0)&&(this.o=!0,this.A=(this.A===void 0?[]:this.A).concat(g),this.v=(this.v===void 0?[]:this.v).concat(d))}};function Qr(t){var o,u,d,g,w,_,I;return v(function(b){switch(b.g){case 1:if(!t.o)return b.return();if(!t.v){b.g=2;break}o=c(t.v),u=o.next();case 3:if(u.done){b.g=5;break}return d=u.value,O(b,d(),4);case 4:u=o.next(),b.g=3;break;case 5:t.v=void 0;case 2:if(t.A){for(g=new t.h.GraphOptionChangeRequestList,w=c(t.A),_=w.next();!_.done;_=w.next())I=_.value,g.push_back(I);t.i.changeOptions(g),g.delete(),t.A=void 0}t.o=!1,b.g=0}})}a.initialize=function(){var t=this;return v(function(o){return o.g==1?O(o,$r(t),2):o.g!=3?O(o,Jr(t),3):O(o,Qr(t),0)})};function cn(t,o){var u,d;return v(function(g){return o in t.F?g.return(t.F[o]):(u=t.locateFile(o,""),d=fetch(u).then(function(w){return w.arrayBuffer()}),t.F[o]=d,g.return(d))})}a.overrideFile=function(t,o){this.i?this.i.overrideFile(t,o):this.B[t]=o},a.clearOverriddenFiles=function(){this.B={},this.i&&this.i.clearOverriddenFiles()},a.send=function(t,o){var u=this,d,g,w,_,I,b,D,G,Y;return v(function(W){switch(W.g){case 1:return u.g.inputs?(d=1e3*(o==null?performance.now():o),O(W,u.C,2)):W.return();case 2:return O(W,u.initialize(),3);case 3:for(g=new u.h.PacketDataList,w=c(Object.keys(t)),_=w.next();!_.done;_=w.next())if(I=_.value,b=u.g.inputs[I]){e:{var z=t[I];switch(b.type){case"video":var V=u.m[b.stream];if(V||(V=new ln(u.h,u.D),u.m[b.stream]=V),V.l===0&&(V.l=V.h.createTexture()),typeof HTMLVideoElement!="undefined"&&z instanceof HTMLVideoElement)var Z=z.videoWidth,re=z.videoHeight;else typeof HTMLImageElement!="undefined"&&z instanceof HTMLImageElement?(Z=z.naturalWidth,re=z.naturalHeight):(Z=z.width,re=z.height);re={glName:V.l,width:Z,height:re},Z=V.g,Z.canvas.width=re.width,Z.canvas.height=re.height,Z.activeTexture(Z.TEXTURE0),V.h.bindTexture2d(V.l),Z.texImage2D(Z.TEXTURE_2D,0,Z.RGBA,Z.RGBA,Z.UNSIGNED_BYTE,z),V.h.bindTexture2d(0),V=re;break e;case"detections":for(V=u.m[b.stream],V||(V=new Xr(u.h),u.m[b.stream]=V),V.data||(V.data=new V.g.DetectionListData),V.data.reset(z.length),re=0;re<z.length;++re){Z=z[re];var ne=V.data,pe=ne.setBoundingBox,Le=re,ve=Z.T,J=new an;if(le(J,1,ve.X),le(J,2,ve.Y),le(J,3,ve.height),le(J,4,ve.width),le(J,5,ve.rotation),le(J,6,ve.W),ve=nn(J,Hr),pe.call(ne,Le,ve),Z.O)for(ne=0;ne<Z.O.length;++ne){J=Z.O[ne];var ce=!!J.visibility;pe=V.data,Le=pe.addNormalizedLandmark,ve=re,J=Object.assign(Object.assign({},J),{visibility:ce?J.visibility:0}),ce=new Bt,le(ce,1,J.x),le(ce,2,J.y),le(ce,3,J.z),J.visibility&&le(ce,4,J.visibility),J=nn(ce,Cr),Le.call(pe,ve,J)}if(Z.M)for(ne=0;ne<Z.M.length;++ne)pe=V.data,Le=pe.addClassification,ve=re,J=Z.M[ne],ce=new Tt,le(ce,2,J.score),J.index&&le(ce,1,J.index),J.label&&le(ce,3,J.label),J.displayName&&le(ce,4,J.displayName),J=nn(ce,br),Le.call(pe,ve,J)}V=V.data;break e;default:V={}}}switch(D=V,G=b.stream,b.type){case"video":g.pushTexture2d(Object.assign(Object.assign({},D),{stream:G,timestamp:d}));break;case"detections":Y=D,Y.stream=G,Y.timestamp=d,g.pushDetectionList(Y);break;default:throw Error("Unknown input config type: '"+b.type+"'")}}return u.i.send(g),O(W,u.C,4);case 4:g.delete(),W.g=0}})};function eo(t,o,u){var d,g,w,_,I,b,D,G,Y,W,z,V,Z,re;return v(function(ne){switch(ne.g){case 1:if(!u)return ne.return(o);for(d={},g=0,w=c(Object.keys(u)),_=w.next();!_.done;_=w.next())I=_.value,b=u[I],typeof b!="string"&&b.type==="texture"&&o[b.stream]!==void 0&&++g;1<g&&(t.G=!1),D=c(Object.keys(u)),_=D.next();case 2:if(_.done){ne.g=4;break}if(G=_.value,Y=u[G],typeof Y=="string")return Z=d,re=G,O(ne,to(t,G,o[Y]),14);if(W=o[Y.stream],Y.type==="detection_list"){if(W){for(var pe=W.getRectList(),Le=W.getLandmarksList(),ve=W.getClassificationsList(),J=[],ce=0;ce<pe.size();++ce){var je=zt(pe.get(ce),an,Fr);je={T:{X:Ie(je,1),Y:Ie(je,2),height:Ie(je,3),width:Ie(je,4),rotation:Ie(je,5,0),W:qe(je,6,0)},O:ut(Le.get(ce)),M:jr(zt(ve.get(ce),sn,Or))},J.push(je)}pe=J}else pe=[];d[G]=pe,ne.g=7;break}if(Y.type==="proto_list"){if(W){for(pe=Array(W.size()),Le=0;Le<W.size();Le++)pe[Le]=W.get(Le);W.delete()}else pe=[];d[G]=pe,ne.g=7;break}if(W===void 0){ne.g=3;break}if(Y.type==="float_list"){d[G]=W,ne.g=7;break}if(Y.type==="proto"){d[G]=W,ne.g=7;break}if(Y.type!=="texture")throw Error("Unknown output config type: '"+Y.type+"'");return z=t.s[G],z||(z=new ln(t.h,t.D),t.s[G]=z),O(ne,mi(z,W,t.G),13);case 13:V=ne.h,d[G]=V;case 7:Y.transform&&d[G]&&(d[G]=Y.transform(d[G])),ne.g=3;break;case 14:Z[re]=ne.h;case 3:_=D.next(),ne.g=2;break;case 4:return ne.return(d)}})}function to(t,o,u){var d;return v(function(g){return typeof u=="number"||u instanceof Uint8Array||u instanceof t.h.Uint8BlobList?g.return(u):u instanceof t.h.Texture2dDataOut?(d=t.s[o],d||(d=new ln(t.h,t.D),t.s[o]=d),g.return(mi(d,u,t.G))):g.return(void 0)})}function no(t,o){for(var u=o.name||"$",d=[].concat(h(o.wants)),g=new t.h.StringList,w=c(o.wants),_=w.next();!_.done;_=w.next())g.push_back(_.value);w=t.h.PacketListener.implement({onResults:function(I){for(var b={},D=0;D<o.wants.length;++D)b[d[D]]=I.get(D);var G=t.listeners[u];G&&(t.C=eo(t,b,o.outs).then(function(Y){Y=G(Y);for(var W=0;W<o.wants.length;++W){var z=b[d[W]];typeof z=="object"&&z.hasOwnProperty&&z.hasOwnProperty("delete")&&z.delete()}Y&&(t.C=Y)}))}}),t.i.attachMultiListener(g,w),g.delete()}a.onResults=function(t,o){this.listeners[o||"$"]=t},F("Solution",un),F("OptionType",{BOOL:0,NUMBER:1,Z:2,0:"BOOL",1:"NUMBER",2:"STRING"});function io(t){return t.map(ro)}function ro(t){t=zt(t,kt,kr);var o=t.getMesh();if(!o)return t;var u=new Float32Array(o.getVertexBufferList());o.getVertexBufferList=function(){return u};var d=new Uint32Array(o.getIndexBufferList());return o.getIndexBufferList=function(){return d},t}function vi(t){var o=this;t=t||{},this.g=new un({locateFile:t.locateFile,files:[{url:"holistic_solution_packed_assets_loader.js"},{simd:!1,url:"holistic_solution_wasm_bin.js"},{simd:!0,url:"holistic_solution_simd_wasm_bin.js"}],graph:{url:"holistic.binarypb"},inputs:{image:{type:"video",stream:"input_frames_gpu"}},listeners:[{wants:"left_hand_landmarks right_hand_landmarks face_landmarks pose_landmarks world_landmarks segmentation_mask image_transformed multi_face_geometry".split(" "),outs:{image:{type:"texture",stream:"image_transformed"},leftHandLandmarks:{type:"proto",stream:"left_hand_landmarks",transform:ut},rightHandLandmarks:{type:"proto",stream:"right_hand_landmarks",transform:ut},faceLandmarks:{type:"proto",stream:"face_landmarks",transform:ut},poseLandmarks:{type:"proto",stream:"pose_landmarks",transform:ut},ea:{type:"proto",stream:"world_landmarks",transform:ut},segmentationMask:{type:"texture",stream:"segmentation_mask"},multiFaceGeometry:{type:"proto_list",stream:"multi_face_geometry",transform:io}}}],options:{useCpuInference:{type:0,graphOptionXref:{calculatorType:"InferenceCalculator",fieldName:"use_cpu_inference"},default:"iPad Simulator;iPhone Simulator;iPod Simulator;iPad;iPhone;iPod".split(";").includes(navigator.platform)||navigator.userAgent.includes("Mac")&&"ontouchend"in document},enableFaceGeometry:{type:0,graphOptionXref:{calculatorName:"EnableFaceGeometryConstant",calculatorType:"ConstantSidePacketCalculator",fieldName:"bool_value"}},selfieMode:{type:0,graphOptionXref:{calculatorType:"GlScalerCalculator",calculatorIndex:1,fieldName:"flip_horizontal"}},modelComplexity:{type:1,default:1,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorModelComplexity",fieldName:"int_value"},onChange:function(u){var d,g,w,_;return v(function(I){if(I.g==1){switch(d="",u){case 1:d="pose_landmark_full.tflite";break;case 2:d="pose_landmark_heavy.tflite";break;default:d="pose_landmark_lite.tflite"}return g="third_party/mediapipe/modules/pose_landmark/"+d,w=o.g.locateFile(d,""),O(I,fetch(w),3)}return I.g!=2?O(I,I.h.arrayBuffer(),2):(_=I.h,o.g.overrideFile(g,_),O(I,o.g.reset(),0))})}},smoothLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothLandmarks",fieldName:"bool_value"}},enableSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorEnableSegmentation",fieldName:"bool_value"}},smoothSegmentation:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorSmoothSegmentation",fieldName:"bool_value"}},refineFaceLandmarks:{type:0,graphOptionXref:{calculatorType:"ConstantSidePacketCalculator",calculatorName:"ConstantSidePacketCalculatorRefineFaceLandmarks",fieldName:"bool_value"}},minDetectionConfidence:{type:1,graphOptionXref:{calculatorType:"TensorsToDetectionsCalculator",calculatorName:"holisticlandmarkgpu__poselandmarkgpu__posedetectiongpu__TensorsToDetectionsCalculator",fieldName:"min_score_thresh"}},minTrackingConfidence:{type:1,graphOptionXref:{calculatorType:"ThresholdingCalculator",calculatorName:"holisticlandmarkgpu__poselandmarkgpu__poselandmarkbyroigpu__tensorstoposelandmarksandsegmentation__ThresholdingCalculator",fieldName:"threshold"}},cameraNear:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"near"}},cameraFar:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"far"}},cameraVerticalFovDegrees:{type:1,graphOptionXref:{calculatorType:"FaceGeometryEnvGeneratorCalculator",fieldName:"vertical_fov_degrees"}}}})}a=vi.prototype,a.close=function(){return this.g.close(),Promise.resolve()},a.onResults=function(t){this.g.onResults(t)},a.initialize=function(){var t=this;return v(function(o){return O(o,t.g.initialize(),0)})},a.reset=function(){this.g.reset()},a.send=function(t){var o=this;return v(function(u){return O(u,o.g.send(t),0)})},a.setOptions=function(t){this.g.setOptions(t)},F("Holistic",vi),F("FACE_GEOMETRY",{Layout:{COLUMN_MAJOR:0,ROW_MAJOR:1,0:"COLUMN_MAJOR",1:"ROW_MAJOR"},PrimitiveType:{TRIANGLE:0,0:"TRIANGLE"},VertexType:{VERTEX_PT:0,0:"VERTEX_PT"},DEFAULT_CAMERA_PARAMS:{verticalFovDegrees:63,near:1,far:1e4}}),F("FACEMESH_LIPS",ui),F("FACEMESH_LEFT_EYE",ci),F("FACEMESH_LEFT_EYEBROW",hi),F("FACEMESH_LEFT_IRIS",[[474,475],[475,476],[476,477],[477,474]]),F("FACEMESH_RIGHT_EYE",di),F("FACEMESH_RIGHT_EYEBROW",fi),F("FACEMESH_RIGHT_IRIS",[[469,470],[470,471],[471,472],[472,469]]),F("FACEMESH_FACE_OVAL",pi),F("FACEMESH_CONTOURS",Gr),F("FACEMESH_TESSELATION",[[127,34],[34,139],[139,127],[11,0],[0,37],[37,11],[232,231],[231,120],[120,232],[72,37],[37,39],[39,72],[128,121],[121,47],[47,128],[232,121],[121,128],[128,232],[104,69],[69,67],[67,104],[175,171],[171,148],[148,175],[118,50],[50,101],[101,118],[73,39],[39,40],[40,73],[9,151],[151,108],[108,9],[48,115],[115,131],[131,48],[194,204],[204,211],[211,194],[74,40],[40,185],[185,74],[80,42],[42,183],[183,80],[40,92],[92,186],[186,40],[230,229],[229,118],[118,230],[202,212],[212,214],[214,202],[83,18],[18,17],[17,83],[76,61],[61,146],[146,76],[160,29],[29,30],[30,160],[56,157],[157,173],[173,56],[106,204],[204,194],[194,106],[135,214],[214,192],[192,135],[203,165],[165,98],[98,203],[21,71],[71,68],[68,21],[51,45],[45,4],[4,51],[144,24],[24,23],[23,144],[77,146],[146,91],[91,77],[205,50],[50,187],[187,205],[201,200],[200,18],[18,201],[91,106],[106,182],[182,91],[90,91],[91,181],[181,90],[85,84],[84,17],[17,85],[206,203],[203,36],[36,206],[148,171],[171,140],[140,148],[92,40],[40,39],[39,92],[193,189],[189,244],[244,193],[159,158],[158,28],[28,159],[247,246],[246,161],[161,247],[236,3],[3,196],[196,236],[54,68],[68,104],[104,54],[193,168],[168,8],[8,193],[117,228],[228,31],[31,117],[189,193],[193,55],[55,189],[98,97],[97,99],[99,98],[126,47],[47,100],[100,126],[166,79],[79,218],[218,166],[155,154],[154,26],[26,155],[209,49],[49,131],[131,209],[135,136],[136,150],[150,135],[47,126],[126,217],[217,47],[223,52],[52,53],[53,223],[45,51],[51,134],[134,45],[211,170],[170,140],[140,211],[67,69],[69,108],[108,67],[43,106],[106,91],[91,43],[230,119],[119,120],[120,230],[226,130],[130,247],[247,226],[63,53],[53,52],[52,63],[238,20],[20,242],[242,238],[46,70],[70,156],[156,46],[78,62],[62,96],[96,78],[46,53],[53,63],[63,46],[143,34],[34,227],[227,143],[123,117],[117,111],[111,123],[44,125],[125,19],[19,44],[236,134],[134,51],[51,236],[216,206],[206,205],[205,216],[154,153],[153,22],[22,154],[39,37],[37,167],[167,39],[200,201],[201,208],[208,200],[36,142],[142,100],[100,36],[57,212],[212,202],[202,57],[20,60],[60,99],[99,20],[28,158],[158,157],[157,28],[35,226],[226,113],[113,35],[160,159],[159,27],[27,160],[204,202],[202,210],[210,204],[113,225],[225,46],[46,113],[43,202],[202,204],[204,43],[62,76],[76,77],[77,62],[137,123],[123,116],[116,137],[41,38],[38,72],[72,41],[203,129],[129,142],[142,203],[64,98],[98,240],[240,64],[49,102],[102,64],[64,49],[41,73],[73,74],[74,41],[212,216],[216,207],[207,212],[42,74],[74,184],[184,42],[169,170],[170,211],[211,169],[170,149],[149,176],[176,170],[105,66],[66,69],[69,105],[122,6],[6,168],[168,122],[123,147],[147,187],[187,123],[96,77],[77,90],[90,96],[65,55],[55,107],[107,65],[89,90],[90,180],[180,89],[101,100],[100,120],[120,101],[63,105],[105,104],[104,63],[93,137],[137,227],[227,93],[15,86],[86,85],[85,15],[129,102],[102,49],[49,129],[14,87],[87,86],[86,14],[55,8],[8,9],[9,55],[100,47],[47,121],[121,100],[145,23],[23,22],[22,145],[88,89],[89,179],[179,88],[6,122],[122,196],[196,6],[88,95],[95,96],[96,88],[138,172],[172,136],[136,138],[215,58],[58,172],[172,215],[115,48],[48,219],[219,115],[42,80],[80,81],[81,42],[195,3],[3,51],[51,195],[43,146],[146,61],[61,43],[171,175],[175,199],[199,171],[81,82],[82,38],[38,81],[53,46],[46,225],[225,53],[144,163],[163,110],[110,144],[52,65],[65,66],[66,52],[229,228],[228,117],[117,229],[34,127],[127,234],[234,34],[107,108],[108,69],[69,107],[109,108],[108,151],[151,109],[48,64],[64,235],[235,48],[62,78],[78,191],[191,62],[129,209],[209,126],[126,129],[111,35],[35,143],[143,111],[117,123],[123,50],[50,117],[222,65],[65,52],[52,222],[19,125],[125,141],[141,19],[221,55],[55,65],[65,221],[3,195],[195,197],[197,3],[25,7],[7,33],[33,25],[220,237],[237,44],[44,220],[70,71],[71,139],[139,70],[122,193],[193,245],[245,122],[247,130],[130,33],[33,247],[71,21],[21,162],[162,71],[170,169],[169,150],[150,170],[188,174],[174,196],[196,188],[216,186],[186,92],[92,216],[2,97],[97,167],[167,2],[141,125],[125,241],[241,141],[164,167],[167,37],[37,164],[72,38],[38,12],[12,72],[38,82],[82,13],[13,38],[63,68],[68,71],[71,63],[226,35],[35,111],[111,226],[101,50],[50,205],[205,101],[206,92],[92,165],[165,206],[209,198],[198,217],[217,209],[165,167],[167,97],[97,165],[220,115],[115,218],[218,220],[133,112],[112,243],[243,133],[239,238],[238,241],[241,239],[214,135],[135,169],[169,214],[190,173],[173,133],[133,190],[171,208],[208,32],[32,171],[125,44],[44,237],[237,125],[86,87],[87,178],[178,86],[85,86],[86,179],[179,85],[84,85],[85,180],[180,84],[83,84],[84,181],[181,83],[201,83],[83,182],[182,201],[137,93],[93,132],[132,137],[76,62],[62,183],[183,76],[61,76],[76,184],[184,61],[57,61],[61,185],[185,57],[212,57],[57,186],[186,212],[214,207],[207,187],[187,214],[34,143],[143,156],[156,34],[79,239],[239,237],[237,79],[123,137],[137,177],[177,123],[44,1],[1,4],[4,44],[201,194],[194,32],[32,201],[64,102],[102,129],[129,64],[213,215],[215,138],[138,213],[59,166],[166,219],[219,59],[242,99],[99,97],[97,242],[2,94],[94,141],[141,2],[75,59],[59,235],[235,75],[24,110],[110,228],[228,24],[25,130],[130,226],[226,25],[23,24],[24,229],[229,23],[22,23],[23,230],[230,22],[26,22],[22,231],[231,26],[112,26],[26,232],[232,112],[189,190],[190,243],[243,189],[221,56],[56,190],[190,221],[28,56],[56,221],[221,28],[27,28],[28,222],[222,27],[29,27],[27,223],[223,29],[30,29],[29,224],[224,30],[247,30],[30,225],[225,247],[238,79],[79,20],[20,238],[166,59],[59,75],[75,166],[60,75],[75,240],[240,60],[147,177],[177,215],[215,147],[20,79],[79,166],[166,20],[187,147],[147,213],[213,187],[112,233],[233,244],[244,112],[233,128],[128,245],[245,233],[128,114],[114,188],[188,128],[114,217],[217,174],[174,114],[131,115],[115,220],[220,131],[217,198],[198,236],[236,217],[198,131],[131,134],[134,198],[177,132],[132,58],[58,177],[143,35],[35,124],[124,143],[110,163],[163,7],[7,110],[228,110],[110,25],[25,228],[356,389],[389,368],[368,356],[11,302],[302,267],[267,11],[452,350],[350,349],[349,452],[302,303],[303,269],[269,302],[357,343],[343,277],[277,357],[452,453],[453,357],[357,452],[333,332],[332,297],[297,333],[175,152],[152,377],[377,175],[347,348],[348,330],[330,347],[303,304],[304,270],[270,303],[9,336],[336,337],[337,9],[278,279],[279,360],[360,278],[418,262],[262,431],[431,418],[304,408],[408,409],[409,304],[310,415],[415,407],[407,310],[270,409],[409,410],[410,270],[450,348],[348,347],[347,450],[422,430],[430,434],[434,422],[313,314],[314,17],[17,313],[306,307],[307,375],[375,306],[387,388],[388,260],[260,387],[286,414],[414,398],[398,286],[335,406],[406,418],[418,335],[364,367],[367,416],[416,364],[423,358],[358,327],[327,423],[251,284],[284,298],[298,251],[281,5],[5,4],[4,281],[373,374],[374,253],[253,373],[307,320],[320,321],[321,307],[425,427],[427,411],[411,425],[421,313],[313,18],[18,421],[321,405],[405,406],[406,321],[320,404],[404,405],[405,320],[315,16],[16,17],[17,315],[426,425],[425,266],[266,426],[377,400],[400,369],[369,377],[322,391],[391,269],[269,322],[417,465],[465,464],[464,417],[386,257],[257,258],[258,386],[466,260],[260,388],[388,466],[456,399],[399,419],[419,456],[284,332],[332,333],[333,284],[417,285],[285,8],[8,417],[346,340],[340,261],[261,346],[413,441],[441,285],[285,413],[327,460],[460,328],[328,327],[355,371],[371,329],[329,355],[392,439],[439,438],[438,392],[382,341],[341,256],[256,382],[429,420],[420,360],[360,429],[364,394],[394,379],[379,364],[277,343],[343,437],[437,277],[443,444],[444,283],[283,443],[275,440],[440,363],[363,275],[431,262],[262,369],[369,431],[297,338],[338,337],[337,297],[273,375],[375,321],[321,273],[450,451],[451,349],[349,450],[446,342],[342,467],[467,446],[293,334],[334,282],[282,293],[458,461],[461,462],[462,458],[276,353],[353,383],[383,276],[308,324],[324,325],[325,308],[276,300],[300,293],[293,276],[372,345],[345,447],[447,372],[352,345],[345,340],[340,352],[274,1],[1,19],[19,274],[456,248],[248,281],[281,456],[436,427],[427,425],[425,436],[381,256],[256,252],[252,381],[269,391],[391,393],[393,269],[200,199],[199,428],[428,200],[266,330],[330,329],[329,266],[287,273],[273,422],[422,287],[250,462],[462,328],[328,250],[258,286],[286,384],[384,258],[265,353],[353,342],[342,265],[387,259],[259,257],[257,387],[424,431],[431,430],[430,424],[342,353],[353,276],[276,342],[273,335],[335,424],[424,273],[292,325],[325,307],[307,292],[366,447],[447,345],[345,366],[271,303],[303,302],[302,271],[423,266],[266,371],[371,423],[294,455],[455,460],[460,294],[279,278],[278,294],[294,279],[271,272],[272,304],[304,271],[432,434],[434,427],[427,432],[272,407],[407,408],[408,272],[394,430],[430,431],[431,394],[395,369],[369,400],[400,395],[334,333],[333,299],[299,334],[351,417],[417,168],[168,351],[352,280],[280,411],[411,352],[325,319],[319,320],[320,325],[295,296],[296,336],[336,295],[319,403],[403,404],[404,319],[330,348],[348,349],[349,330],[293,298],[298,333],[333,293],[323,454],[454,447],[447,323],[15,16],[16,315],[315,15],[358,429],[429,279],[279,358],[14,15],[15,316],[316,14],[285,336],[336,9],[9,285],[329,349],[349,350],[350,329],[374,380],[380,252],[252,374],[318,402],[402,403],[403,318],[6,197],[197,419],[419,6],[318,319],[319,325],[325,318],[367,364],[364,365],[365,367],[435,367],[367,397],[397,435],[344,438],[438,439],[439,344],[272,271],[271,311],[311,272],[195,5],[5,281],[281,195],[273,287],[287,291],[291,273],[396,428],[428,199],[199,396],[311,271],[271,268],[268,311],[283,444],[444,445],[445,283],[373,254],[254,339],[339,373],[282,334],[334,296],[296,282],[449,347],[347,346],[346,449],[264,447],[447,454],[454,264],[336,296],[296,299],[299,336],[338,10],[10,151],[151,338],[278,439],[439,455],[455,278],[292,407],[407,415],[415,292],[358,371],[371,355],[355,358],[340,345],[345,372],[372,340],[346,347],[347,280],[280,346],[442,443],[443,282],[282,442],[19,94],[94,370],[370,19],[441,442],[442,295],[295,441],[248,419],[419,197],[197,248],[263,255],[255,359],[359,263],[440,275],[275,274],[274,440],[300,383],[383,368],[368,300],[351,412],[412,465],[465,351],[263,467],[467,466],[466,263],[301,368],[368,389],[389,301],[395,378],[378,379],[379,395],[412,351],[351,419],[419,412],[436,426],[426,322],[322,436],[2,164],[164,393],[393,2],[370,462],[462,461],[461,370],[164,0],[0,267],[267,164],[302,11],[11,12],[12,302],[268,12],[12,13],[13,268],[293,300],[300,301],[301,293],[446,261],[261,340],[340,446],[330,266],[266,425],[425,330],[426,423],[423,391],[391,426],[429,355],[355,437],[437,429],[391,327],[327,326],[326,391],[440,457],[457,438],[438,440],[341,382],[382,362],[362,341],[459,457],[457,461],[461,459],[434,430],[430,394],[394,434],[414,463],[463,362],[362,414],[396,369],[369,262],[262,396],[354,461],[461,457],[457,354],[316,403],[403,402],[402,316],[315,404],[404,403],[403,315],[314,405],[405,404],[404,314],[313,406],[406,405],[405,313],[421,418],[418,406],[406,421],[366,401],[401,361],[361,366],[306,408],[408,407],[407,306],[291,409],[409,408],[408,291],[287,410],[410,409],[409,287],[432,436],[436,410],[410,432],[434,416],[416,411],[411,434],[264,368],[368,383],[383,264],[309,438],[438,457],[457,309],[352,376],[376,401],[401,352],[274,275],[275,4],[4,274],[421,428],[428,262],[262,421],[294,327],[327,358],[358,294],[433,416],[416,367],[367,433],[289,455],[455,439],[439,289],[462,370],[370,326],[326,462],[2,326],[326,370],[370,2],[305,460],[460,455],[455,305],[254,449],[449,448],[448,254],[255,261],[261,446],[446,255],[253,450],[450,449],[449,253],[252,451],[451,450],[450,252],[256,452],[452,451],[451,256],[341,453],[453,452],[452,341],[413,464],[464,463],[463,413],[441,413],[413,414],[414,441],[258,442],[442,441],[441,258],[257,443],[443,442],[442,257],[259,444],[444,443],[443,259],[260,445],[445,444],[444,260],[467,342],[342,445],[445,467],[459,458],[458,250],[250,459],[289,392],[392,290],[290,289],[290,328],[328,460],[460,290],[376,433],[433,435],[435,376],[250,290],[290,392],[392,250],[411,416],[416,433],[433,411],[341,463],[463,464],[464,341],[453,464],[464,465],[465,453],[357,465],[465,412],[412,357],[343,412],[412,399],[399,343],[360,363],[363,440],[440,360],[437,399],[399,456],[456,437],[420,456],[456,363],[363,420],[401,435],[435,288],[288,401],[372,383],[383,353],[353,372],[339,255],[255,249],[249,339],[448,261],[261,255],[255,448],[133,243],[243,190],[190,133],[133,155],[155,112],[112,133],[33,246],[246,247],[247,33],[33,130],[130,25],[25,33],[398,384],[384,286],[286,398],[362,398],[398,414],[414,362],[362,463],[463,341],[341,362],[263,359],[359,467],[467,263],[263,249],[249,255],[255,263],[466,467],[467,260],[260,466],[75,60],[60,166],[166,75],[238,239],[239,79],[79,238],[162,127],[127,139],[139,162],[72,11],[11,37],[37,72],[121,232],[232,120],[120,121],[73,72],[72,39],[39,73],[114,128],[128,47],[47,114],[233,232],[232,128],[128,233],[103,104],[104,67],[67,103],[152,175],[175,148],[148,152],[119,118],[118,101],[101,119],[74,73],[73,40],[40,74],[107,9],[9,108],[108,107],[49,48],[48,131],[131,49],[32,194],[194,211],[211,32],[184,74],[74,185],[185,184],[191,80],[80,183],[183,191],[185,40],[40,186],[186,185],[119,230],[230,118],[118,119],[210,202],[202,214],[214,210],[84,83],[83,17],[17,84],[77,76],[76,146],[146,77],[161,160],[160,30],[30,161],[190,56],[56,173],[173,190],[182,106],[106,194],[194,182],[138,135],[135,192],[192,138],[129,203],[203,98],[98,129],[54,21],[21,68],[68,54],[5,51],[51,4],[4,5],[145,144],[144,23],[23,145],[90,77],[77,91],[91,90],[207,205],[205,187],[187,207],[83,201],[201,18],[18,83],[181,91],[91,182],[182,181],[180,90],[90,181],[181,180],[16,85],[85,17],[17,16],[205,206],[206,36],[36,205],[176,148],[148,140],[140,176],[165,92],[92,39],[39,165],[245,193],[193,244],[244,245],[27,159],[159,28],[28,27],[30,247],[247,161],[161,30],[174,236],[236,196],[196,174],[103,54],[54,104],[104,103],[55,193],[193,8],[8,55],[111,117],[117,31],[31,111],[221,189],[189,55],[55,221],[240,98],[98,99],[99,240],[142,126],[126,100],[100,142],[219,166],[166,218],[218,219],[112,155],[155,26],[26,112],[198,209],[209,131],[131,198],[169,135],[135,150],[150,169],[114,47],[47,217],[217,114],[224,223],[223,53],[53,224],[220,45],[45,134],[134,220],[32,211],[211,140],[140,32],[109,67],[67,108],[108,109],[146,43],[43,91],[91,146],[231,230],[230,120],[120,231],[113,226],[226,247],[247,113],[105,63],[63,52],[52,105],[241,238],[238,242],[242,241],[124,46],[46,156],[156,124],[95,78],[78,96],[96,95],[70,46],[46,63],[63,70],[116,143],[143,227],[227,116],[116,123],[123,111],[111,116],[1,44],[44,19],[19,1],[3,236],[236,51],[51,3],[207,216],[216,205],[205,207],[26,154],[154,22],[22,26],[165,39],[39,167],[167,165],[199,200],[200,208],[208,199],[101,36],[36,100],[100,101],[43,57],[57,202],[202,43],[242,20],[20,99],[99,242],[56,28],[28,157],[157,56],[124,35],[35,113],[113,124],[29,160],[160,27],[27,29],[211,204],[204,210],[210,211],[124,113],[113,46],[46,124],[106,43],[43,204],[204,106],[96,62],[62,77],[77,96],[227,137],[137,116],[116,227],[73,41],[41,72],[72,73],[36,203],[203,142],[142,36],[235,64],[64,240],[240,235],[48,49],[49,64],[64,48],[42,41],[41,74],[74,42],[214,212],[212,207],[207,214],[183,42],[42,184],[184,183],[210,169],[169,211],[211,210],[140,170],[170,176],[176,140],[104,105],[105,69],[69,104],[193,122],[122,168],[168,193],[50,123],[123,187],[187,50],[89,96],[96,90],[90,89],[66,65],[65,107],[107,66],[179,89],[89,180],[180,179],[119,101],[101,120],[120,119],[68,63],[63,104],[104,68],[234,93],[93,227],[227,234],[16,15],[15,85],[85,16],[209,129],[129,49],[49,209],[15,14],[14,86],[86,15],[107,55],[55,9],[9,107],[120,100],[100,121],[121,120],[153,145],[145,22],[22,153],[178,88],[88,179],[179,178],[197,6],[6,196],[196,197],[89,88],[88,96],[96,89],[135,138],[138,136],[136,135],[138,215],[215,172],[172,138],[218,115],[115,219],[219,218],[41,42],[42,81],[81,41],[5,195],[195,51],[51,5],[57,43],[43,61],[61,57],[208,171],[171,199],[199,208],[41,81],[81,38],[38,41],[224,53],[53,225],[225,224],[24,144],[144,110],[110,24],[105,52],[52,66],[66,105],[118,229],[229,117],[117,118],[227,34],[34,234],[234,227],[66,107],[107,69],[69,66],[10,109],[109,151],[151,10],[219,48],[48,235],[235,219],[183,62],[62,191],[191,183],[142,129],[129,126],[126,142],[116,111],[111,143],[143,116],[118,117],[117,50],[50,118],[223,222],[222,52],[52,223],[94,19],[19,141],[141,94],[222,221],[221,65],[65,222],[196,3],[3,197],[197,196],[45,220],[220,44],[44,45],[156,70],[70,139],[139,156],[188,122],[122,245],[245,188],[139,71],[71,162],[162,139],[149,170],[170,150],[150,149],[122,188],[188,196],[196,122],[206,216],[216,92],[92,206],[164,2],[2,167],[167,164],[242,141],[141,241],[241,242],[0,164],[164,37],[37,0],[11,72],[72,12],[12,11],[12,38],[38,13],[13,12],[70,63],[63,71],[71,70],[31,226],[226,111],[111,31],[36,101],[101,205],[205,36],[203,206],[206,165],[165,203],[126,209],[209,217],[217,126],[98,165],[165,97],[97,98],[237,220],[220,218],[218,237],[237,239],[239,241],[241,237],[210,214],[214,169],[169,210],[140,171],[171,32],[32,140],[241,125],[125,237],[237,241],[179,86],[86,178],[178,179],[180,85],[85,179],[179,180],[181,84],[84,180],[180,181],[182,83],[83,181],[181,182],[194,201],[201,182],[182,194],[177,137],[137,132],[132,177],[184,76],[76,183],[183,184],[185,61],[61,184],[184,185],[186,57],[57,185],[185,186],[216,212],[212,186],[186,216],[192,214],[214,187],[187,192],[139,34],[34,156],[156,139],[218,79],[79,237],[237,218],[147,123],[123,177],[177,147],[45,44],[44,4],[4,45],[208,201],[201,32],[32,208],[98,64],[64,129],[129,98],[192,213],[213,138],[138,192],[235,59],[59,219],[219,235],[141,242],[242,97],[97,141],[97,2],[2,141],[141,97],[240,75],[75,235],[235,240],[229,24],[24,228],[228,229],[31,25],[25,226],[226,31],[230,23],[23,229],[229,230],[231,22],[22,230],[230,231],[232,26],[26,231],[231,232],[233,112],[112,232],[232,233],[244,189],[189,243],[243,244],[189,221],[221,190],[190,189],[222,28],[28,221],[221,222],[223,27],[27,222],[222,223],[224,29],[29,223],[223,224],[225,30],[30,224],[224,225],[113,247],[247,225],[225,113],[99,60],[60,240],[240,99],[213,147],[147,215],[215,213],[60,20],[20,166],[166,60],[192,187],[187,213],[213,192],[243,112],[112,244],[244,243],[244,233],[233,245],[245,244],[245,128],[128,188],[188,245],[188,114],[114,174],[174,188],[134,131],[131,220],[220,134],[174,217],[217,236],[236,174],[236,198],[198,134],[134,236],[215,177],[177,58],[58,215],[156,143],[143,124],[124,156],[25,110],[110,7],[7,25],[31,228],[228,25],[25,31],[264,356],[356,368],[368,264],[0,11],[11,267],[267,0],[451,452],[452,349],[349,451],[267,302],[302,269],[269,267],[350,357],[357,277],[277,350],[350,452],[452,357],[357,350],[299,333],[333,297],[297,299],[396,175],[175,377],[377,396],[280,347],[347,330],[330,280],[269,303],[303,270],[270,269],[151,9],[9,337],[337,151],[344,278],[278,360],[360,344],[424,418],[418,431],[431,424],[270,304],[304,409],[409,270],[272,310],[310,407],[407,272],[322,270],[270,410],[410,322],[449,450],[450,347],[347,449],[432,422],[422,434],[434,432],[18,313],[313,17],[17,18],[291,306],[306,375],[375,291],[259,387],[387,260],[260,259],[424,335],[335,418],[418,424],[434,364],[364,416],[416,434],[391,423],[423,327],[327,391],[301,251],[251,298],[298,301],[275,281],[281,4],[4,275],[254,373],[373,253],[253,254],[375,307],[307,321],[321,375],[280,425],[425,411],[411,280],[200,421],[421,18],[18,200],[335,321],[321,406],[406,335],[321,320],[320,405],[405,321],[314,315],[315,17],[17,314],[423,426],[426,266],[266,423],[396,377],[377,369],[369,396],[270,322],[322,269],[269,270],[413,417],[417,464],[464,413],[385,386],[386,258],[258,385],[248,456],[456,419],[419,248],[298,284],[284,333],[333,298],[168,417],[417,8],[8,168],[448,346],[346,261],[261,448],[417,413],[413,285],[285,417],[326,327],[327,328],[328,326],[277,355],[355,329],[329,277],[309,392],[392,438],[438,309],[381,382],[382,256],[256,381],[279,429],[429,360],[360,279],[365,364],[364,379],[379,365],[355,277],[277,437],[437,355],[282,443],[443,283],[283,282],[281,275],[275,363],[363,281],[395,431],[431,369],[369,395],[299,297],[297,337],[337,299],[335,273],[273,321],[321,335],[348,450],[450,349],[349,348],[359,446],[446,467],[467,359],[283,293],[293,282],[282,283],[250,458],[458,462],[462,250],[300,276],[276,383],[383,300],[292,308],[308,325],[325,292],[283,276],[276,293],[293,283],[264,372],[372,447],[447,264],[346,352],[352,340],[340,346],[354,274],[274,19],[19,354],[363,456],[456,281],[281,363],[426,436],[436,425],[425,426],[380,381],[381,252],[252,380],[267,269],[269,393],[393,267],[421,200],[200,428],[428,421],[371,266],[266,329],[329,371],[432,287],[287,422],[422,432],[290,250],[250,328],[328,290],[385,258],[258,384],[384,385],[446,265],[265,342],[342,446],[386,387],[387,257],[257,386],[422,424],[424,430],[430,422],[445,342],[342,276],[276,445],[422,273],[273,424],[424,422],[306,292],[292,307],[307,306],[352,366],[366,345],[345,352],[268,271],[271,302],[302,268],[358,423],[423,371],[371,358],[327,294],[294,460],[460,327],[331,279],[279,294],[294,331],[303,271],[271,304],[304,303],[436,432],[432,427],[427,436],[304,272],[272,408],[408,304],[395,394],[394,431],[431,395],[378,395],[395,400],[400,378],[296,334],[334,299],[299,296],[6,351],[351,168],[168,6],[376,352],[352,411],[411,376],[307,325],[325,320],[320,307],[285,295],[295,336],[336,285],[320,319],[319,404],[404,320],[329,330],[330,349],[349,329],[334,293],[293,333],[333,334],[366,323],[323,447],[447,366],[316,15],[15,315],[315,316],[331,358],[358,279],[279,331],[317,14],[14,316],[316,317],[8,285],[285,9],[9,8],[277,329],[329,350],[350,277],[253,374],[374,252],[252,253],[319,318],[318,403],[403,319],[351,6],[6,419],[419,351],[324,318],[318,325],[325,324],[397,367],[367,365],[365,397],[288,435],[435,397],[397,288],[278,344],[344,439],[439,278],[310,272],[272,311],[311,310],[248,195],[195,281],[281,248],[375,273],[273,291],[291,375],[175,396],[396,199],[199,175],[312,311],[311,268],[268,312],[276,283],[283,445],[445,276],[390,373],[373,339],[339,390],[295,282],[282,296],[296,295],[448,449],[449,346],[346,448],[356,264],[264,454],[454,356],[337,336],[336,299],[299,337],[337,338],[338,151],[151,337],[294,278],[278,455],[455,294],[308,292],[292,415],[415,308],[429,358],[358,355],[355,429],[265,340],[340,372],[372,265],[352,346],[346,280],[280,352],[295,442],[442,282],[282,295],[354,19],[19,370],[370,354],[285,441],[441,295],[295,285],[195,248],[248,197],[197,195],[457,440],[440,274],[274,457],[301,300],[300,368],[368,301],[417,351],[351,465],[465,417],[251,301],[301,389],[389,251],[394,395],[395,379],[379,394],[399,412],[412,419],[419,399],[410,436],[436,322],[322,410],[326,2],[2,393],[393,326],[354,370],[370,461],[461,354],[393,164],[164,267],[267,393],[268,302],[302,12],[12,268],[312,268],[268,13],[13,312],[298,293],[293,301],[301,298],[265,446],[446,340],[340,265],[280,330],[330,425],[425,280],[322,426],[426,391],[391,322],[420,429],[429,437],[437,420],[393,391],[391,326],[326,393],[344,440],[440,438],[438,344],[458,459],[459,461],[461,458],[364,434],[434,394],[394,364],[428,396],[396,262],[262,428],[274,354],[354,457],[457,274],[317,316],[316,402],[402,317],[316,315],[315,403],[403,316],[315,314],[314,404],[404,315],[314,313],[313,405],[405,314],[313,421],[421,406],[406,313],[323,366],[366,361],[361,323],[292,306],[306,407],[407,292],[306,291],[291,408],[408,306],[291,287],[287,409],[409,291],[287,432],[432,410],[410,287],[427,434],[434,411],[411,427],[372,264],[264,383],[383,372],[459,309],[309,457],[457,459],[366,352],[352,401],[401,366],[1,274],[274,4],[4,1],[418,421],[421,262],[262,418],[331,294],[294,358],[358,331],[435,433],[433,367],[367,435],[392,289],[289,439],[439,392],[328,462],[462,326],[326,328],[94,2],[2,370],[370,94],[289,305],[305,455],[455,289],[339,254],[254,448],[448,339],[359,255],[255,446],[446,359],[254,253],[253,449],[449,254],[253,252],[252,450],[450,253],[252,256],[256,451],[451,252],[256,341],[341,452],[452,256],[414,413],[413,463],[463,414],[286,441],[441,414],[414,286],[286,258],[258,441],[441,286],[258,257],[257,442],[442,258],[257,259],[259,443],[443,257],[259,260],[260,444],[444,259],[260,467],[467,445],[445,260],[309,459],[459,250],[250,309],[305,289],[289,290],[290,305],[305,290],[290,460],[460,305],[401,376],[376,435],[435,401],[309,250],[250,392],[392,309],[376,411],[411,433],[433,376],[453,341],[341,464],[464,453],[357,453],[453,465],[465,357],[343,357],[357,412],[412,343],[437,343],[343,399],[399,437],[344,360],[360,440],[440,344],[420,437],[437,456],[456,420],[360,420],[420,363],[363,360],[361,401],[401,288],[288,361],[265,372],[372,353],[353,265],[390,339],[339,249],[249,390],[339,448],[448,255],[255,339]]),F("HAND_CONNECTIONS",[[0,1],[1,2],[2,3],[3,4],[0,5],[5,6],[6,7],[7,8],[5,9],[9,10],[10,11],[11,12],[9,13],[13,14],[14,15],[15,16],[13,17],[0,17],[17,18],[18,19],[19,20]]),F("POSE_CONNECTIONS",[[0,1],[1,2],[2,3],[3,7],[0,4],[4,5],[5,6],[6,8],[9,10],[11,12],[11,13],[13,15],[15,17],[15,19],[15,21],[17,19],[12,14],[14,16],[16,18],[16,20],[16,22],[18,20],[11,23],[12,24],[23,24],[23,25],[24,26],[25,27],[26,28],[27,29],[28,30],[29,31],[30,32],[27,31],[28,32]]),F("POSE_LANDMARKS",{NOSE:0,LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,LEFT_EAR:7,RIGHT_EAR:8,LEFT_RIGHT:9,RIGHT_LEFT:10,LEFT_SHOULDER:11,RIGHT_SHOULDER:12,LEFT_ELBOW:13,RIGHT_ELBOW:14,LEFT_WRIST:15,RIGHT_WRIST:16,LEFT_PINKY:17,RIGHT_PINKY:18,LEFT_INDEX:19,RIGHT_INDEX:20,LEFT_THUMB:21,RIGHT_THUMB:22,LEFT_HIP:23,RIGHT_HIP:24,LEFT_KNEE:25,RIGHT_KNEE:26,LEFT_ANKLE:27,RIGHT_ANKLE:28,LEFT_HEEL:29,RIGHT_HEEL:30,LEFT_FOOT_INDEX:31,RIGHT_FOOT_INDEX:32}),F("POSE_LANDMARKS_LEFT",{LEFT_EYE_INNER:1,LEFT_EYE:2,LEFT_EYE_OUTER:3,LEFT_EAR:7,LEFT_RIGHT:9,LEFT_SHOULDER:11,LEFT_ELBOW:13,LEFT_WRIST:15,LEFT_PINKY:17,LEFT_INDEX:19,LEFT_THUMB:21,LEFT_HIP:23,LEFT_KNEE:25,LEFT_ANKLE:27,LEFT_HEEL:29,LEFT_FOOT_INDEX:31}),F("POSE_LANDMARKS_RIGHT",{RIGHT_EYE_INNER:4,RIGHT_EYE:5,RIGHT_EYE_OUTER:6,RIGHT_EAR:8,RIGHT_LEFT:10,RIGHT_SHOULDER:12,RIGHT_ELBOW:14,RIGHT_WRIST:16,RIGHT_PINKY:18,RIGHT_INDEX:20,RIGHT_THUMB:22,RIGHT_HIP:24,RIGHT_KNEE:26,RIGHT_ANKLE:28,RIGHT_HEEL:30,RIGHT_FOOT_INDEX:32}),F("POSE_LANDMARKS_NEUTRAL",{NOSE:0}),F("matrixDataToMatrix",function(t){for(var o=t.getCols(),u=t.getRows(),d=t.getPackedDataList(),g=[],w=0;w<u;w++)g.push(Array(o));for(w=0;w<u;w++)for(var _=0;_<o;_++){var I=t.getLayout()===1?w*o+_:_*u+w;g[w][_]=d[I]}return g}),F("VERSION","0.5.1635989137")}).call(Be);var ts={};(function(){function a(v){var A=0;return function(){return A<v.length?{done:!1,value:v[A++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(v,A,H){return v==Array.prototype||v==Object.prototype||(v[A]=H.value),v};function n(v){v=[typeof globalThis=="object"&&globalThis,v,typeof window=="object"&&window,typeof self=="object"&&self,typeof Be=="object"&&Be];for(var A=0;A<v.length;++A){var H=v[A];if(H&&H.Math==Math)return H}throw Error("Cannot find global object")}var i=n(this);function r(v,A){if(A)e:{var H=i;v=v.split(".");for(var U=0;U<v.length-1;U++){var F=v[U];if(!(F in H))break e;H=H[F]}v=v[v.length-1],U=H[v],A=A(U),A!=U&&A!=null&&e(H,v,{configurable:!0,writable:!0,value:A})}}r("Symbol",function(v){function A(te){if(this instanceof A)throw new TypeError("Symbol is not a constructor");return new H(U+(te||"")+"_"+F++,te)}function H(te,P){this.g=te,e(this,"description",{configurable:!0,writable:!0,value:P})}if(v)return v;H.prototype.toString=function(){return this.g};var U="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",F=0;return A}),r("Symbol.iterator",function(v){if(v)return v;v=Symbol("Symbol.iterator");for(var A="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),H=0;H<A.length;H++){var U=i[A[H]];typeof U=="function"&&typeof U.prototype[v]!="function"&&e(U.prototype,v,{configurable:!0,writable:!0,value:function(){return s(a(this))}})}return v});function s(v){return v={next:v},v[Symbol.iterator]=function(){return this},v}function l(v){var A=typeof Symbol!="undefined"&&Symbol.iterator&&v[Symbol.iterator];return A?A.call(v):{next:a(v)}}function c(){this.i=!1,this.g=null,this.o=void 0,this.j=1,this.m=0,this.h=null}function h(v){if(v.i)throw new TypeError("Generator is already running");v.i=!0}c.prototype.l=function(v){this.o=v};function f(v,A){v.h={F:A,G:!0},v.j=v.m}c.prototype.return=function(v){this.h={return:v},this.j=this.m};function m(v){this.g=new c,this.h=v}function p(v,A){h(v.g);var H=v.g.g;return H?L(v,"return"in H?H.return:function(U){return{value:U,done:!0}},A,v.g.return):(v.g.return(A),x(v))}function L(v,A,H,U){try{var F=A.call(v.g.g,H);if(!(F instanceof Object))throw new TypeError("Iterator result "+F+" is not an object");if(!F.done)return v.g.i=!1,F;var te=F.value}catch(P){return v.g.g=null,f(v.g,P),x(v)}return v.g.g=null,U.call(v.g,te),x(v)}function x(v){for(;v.g.j;)try{var A=v.h(v.g);if(A)return v.g.i=!1,{value:A.value,done:!1}}catch(H){v.g.o=void 0,f(v.g,H)}if(v.g.i=!1,v.g.h){if(A=v.g.h,v.g.h=null,A.G)throw A.F;return{value:A.return,done:!0}}return{value:void 0,done:!0}}function y(v){this.next=function(A){return h(v.g),v.g.g?A=L(v,v.g.g.next,A,v.g.l):(v.g.l(A),A=x(v)),A},this.throw=function(A){return h(v.g),v.g.g?A=L(v,v.g.g.throw,A,v.g.l):(f(v.g,A),A=x(v)),A},this.return=function(A){return p(v,A)},this[Symbol.iterator]=function(){return this}}function E(v){function A(U){return v.next(U)}function H(U){return v.throw(U)}return new Promise(function(U,F){function te(P){P.done?U(P.value):Promise.resolve(P.value).then(A,H).then(te,F)}te(v.next())})}r("Promise",function(v){function A(P){this.h=0,this.i=void 0,this.g=[],this.o=!1;var B=this.j();try{P(B.resolve,B.reject)}catch(X){B.reject(X)}}function H(){this.g=null}function U(P){return P instanceof A?P:new A(function(B){B(P)})}if(v)return v;H.prototype.h=function(P){if(this.g==null){this.g=[];var B=this;this.i(function(){B.l()})}this.g.push(P)};var F=i.setTimeout;H.prototype.i=function(P){F(P,0)},H.prototype.l=function(){for(;this.g&&this.g.length;){var P=this.g;this.g=[];for(var B=0;B<P.length;++B){var X=P[B];P[B]=null;try{X()}catch(ee){this.j(ee)}}}this.g=null},H.prototype.j=function(P){this.i(function(){throw P})},A.prototype.j=function(){function P(ee){return function(me){X||(X=!0,ee.call(B,me))}}var B=this,X=!1;return{resolve:P(this.A),reject:P(this.l)}},A.prototype.A=function(P){if(P===this)this.l(new TypeError("A Promise cannot resolve to itself"));else if(P instanceof A)this.C(P);else{e:switch(typeof P){case"object":var B=P!=null;break e;case"function":B=!0;break e;default:B=!1}B?this.v(P):this.m(P)}},A.prototype.v=function(P){var B=void 0;try{B=P.then}catch(X){this.l(X);return}typeof B=="function"?this.D(B,P):this.m(P)},A.prototype.l=function(P){this.u(2,P)},A.prototype.m=function(P){this.u(1,P)},A.prototype.u=function(P,B){if(this.h!=0)throw Error("Cannot settle("+P+", "+B+"): Promise already settled in state"+this.h);this.h=P,this.i=B,this.h===2&&this.B(),this.H()},A.prototype.B=function(){var P=this;F(function(){if(P.I()){var B=i.console;typeof B!="undefined"&&B.error(P.i)}},1)},A.prototype.I=function(){if(this.o)return!1;var P=i.CustomEvent,B=i.Event,X=i.dispatchEvent;return typeof X=="undefined"?!0:(typeof P=="function"?P=new P("unhandledrejection",{cancelable:!0}):typeof B=="function"?P=new B("unhandledrejection",{cancelable:!0}):(P=i.document.createEvent("CustomEvent"),P.initCustomEvent("unhandledrejection",!1,!0,P)),P.promise=this,P.reason=this.i,X(P))},A.prototype.H=function(){if(this.g!=null){for(var P=0;P<this.g.length;++P)te.h(this.g[P]);this.g=null}};var te=new H;return A.prototype.C=function(P){var B=this.j();P.s(B.resolve,B.reject)},A.prototype.D=function(P,B){var X=this.j();try{P.call(B,X.resolve,X.reject)}catch(ee){X.reject(ee)}},A.prototype.then=function(P,B){function X(Te,Ne){return typeof Te=="function"?function(rt){try{ee(Te(rt))}catch(ot){me(ot)}}:Ne}var ee,me,yt=new A(function(Te,Ne){ee=Te,me=Ne});return this.s(X(P,ee),X(B,me)),yt},A.prototype.catch=function(P){return this.then(void 0,P)},A.prototype.s=function(P,B){function X(){switch(ee.h){case 1:P(ee.i);break;case 2:B(ee.i);break;default:throw Error("Unexpected state: "+ee.h)}}var ee=this;this.g==null?te.h(X):this.g.push(X),this.o=!0},A.resolve=U,A.reject=function(P){return new A(function(B,X){X(P)})},A.race=function(P){return new A(function(B,X){for(var ee=l(P),me=ee.next();!me.done;me=ee.next())U(me.value).s(B,X)})},A.all=function(P){var B=l(P),X=B.next();return X.done?U([]):new A(function(ee,me){function yt(rt){return function(ot){Te[rt]=ot,Ne--,Ne==0&&ee(Te)}}var Te=[],Ne=0;do Te.push(void 0),Ne++,U(X.value).s(yt(Te.length-1),me),X=B.next();while(!X.done)})},A});var M=typeof Object.assign=="function"?Object.assign:function(v,A){for(var H=1;H<arguments.length;H++){var U=arguments[H];if(U)for(var F in U)Object.prototype.hasOwnProperty.call(U,F)&&(v[F]=U[F])}return v};r("Object.assign",function(v){return v||M});var S=this||self,R={facingMode:"user",width:640,height:480};function O(v,A){this.video=v,this.i=0,this.h=Object.assign(Object.assign({},R),A)}O.prototype.stop=function(){var v=this,A,H,U,F;return E(new y(new m(function(te){if(v.g){for(A=v.g.getTracks(),H=l(A),U=H.next();!U.done;U=H.next())F=U.value,F.stop();v.g=void 0}te.j=0})))},O.prototype.start=function(){var v=this,A;return E(new y(new m(function(H){return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia||alert("No navigator.mediaDevices.getUserMedia exists."),A=v.h,H.return(navigator.mediaDevices.getUserMedia({video:{facingMode:A.facingMode,width:A.width,height:A.height}}).then(function(U){$(v,U)}).catch(function(U){var F="Failed to acquire camera feed: "+U;throw console.error(F),alert(F),U}))})))};function k(v){window.requestAnimationFrame(function(){se(v)})}function $(v,A){v.g=A,v.video.srcObject=A,v.video.onloadedmetadata=function(){v.video.play(),k(v)}}function se(v){var A=null;v.video.paused||v.video.currentTime===v.i||(v.i=v.video.currentTime,A=v.h.onFrame()),A?A.then(function(){k(v)}):k(v)}var C=["Camera"],N=S;C[0]in N||typeof N.execScript=="undefined"||N.execScript("var "+C[0]);for(var j;C.length&&(j=C.shift());)C.length||O===void 0?N[j]&&N[j]!==Object.prototype[j]?N=N[j]:N=N[j]={}:N[j]=O}).call(Be);var We={};(function(){function a(y){var E=0;return function(){return E<y.length?{done:!1,value:y[E++]}:{done:!0}}}var e=typeof Object.defineProperties=="function"?Object.defineProperty:function(y,E,M){return y==Array.prototype||y==Object.prototype||(y[E]=M.value),y};function n(y){y=[typeof globalThis=="object"&&globalThis,y,typeof window=="object"&&window,typeof self=="object"&&self,typeof Be=="object"&&Be];for(var E=0;E<y.length;++E){var M=y[E];if(M&&M.Math==Math)return M}throw Error("Cannot find global object")}var i=n(this);function r(y,E){if(E)e:{var M=i;y=y.split(".");for(var S=0;S<y.length-1;S++){var R=y[S];if(!(R in M))break e;M=M[R]}y=y[y.length-1],S=M[y],E=E(S),E!=S&&E!=null&&e(M,y,{configurable:!0,writable:!0,value:E})}}function s(y){var E=typeof Symbol!="undefined"&&Symbol.iterator&&y[Symbol.iterator];return E?E.call(y):{next:a(y)}}var l=typeof Object.assign=="function"?Object.assign:function(y,E){for(var M=1;M<arguments.length;M++){var S=arguments[M];if(S)for(var R in S)Object.prototype.hasOwnProperty.call(S,R)&&(y[R]=S[R])}return y};r("Object.assign",function(y){return y||l}),r("Array.prototype.fill",function(y){return y||function(E,M,S){var R=this.length||0;for(0>M&&(M=Math.max(0,R+M)),(S==null||S>R)&&(S=R),S=Number(S),0>S&&(S=Math.max(0,R+S)),M=Number(M||0);M<S;M++)this[M]=E;return this}});function c(y){return y||Array.prototype.fill}r("Int8Array.prototype.fill",c),r("Uint8Array.prototype.fill",c),r("Uint8ClampedArray.prototype.fill",c),r("Int16Array.prototype.fill",c),r("Uint16Array.prototype.fill",c),r("Int32Array.prototype.fill",c),r("Uint32Array.prototype.fill",c),r("Float32Array.prototype.fill",c),r("Float64Array.prototype.fill",c);var h=this||self;function f(y,E){y=y.split(".");var M=h;y[0]in M||typeof M.execScript=="undefined"||M.execScript("var "+y[0]);for(var S;y.length&&(S=y.shift());)y.length||E===void 0?M[S]&&M[S]!==Object.prototype[S]?M=M[S]:M=M[S]={}:M[S]=E}var m={color:"white",lineWidth:4,radius:6,visibilityMin:.5};function p(y){return y=y||{},Object.assign(Object.assign(Object.assign({},m),{fillColor:y.color}),y)}function L(y,E){return y instanceof Function?y(E):y}function x(y,E,M){return Math.max(Math.min(E,M),Math.min(Math.max(E,M),y))}f("clamp",x),f("drawLandmarks",function(y,E,M){if(E){M=p(M),y.save();var S=y.canvas,R=0;E=s(E);for(var O=E.next();!O.done;O=E.next())if(O=O.value,O!==void 0&&(O.visibility===void 0||O.visibility>M.visibilityMin)){y.fillStyle=L(M.fillColor,{index:R,from:O}),y.strokeStyle=L(M.color,{index:R,from:O}),y.lineWidth=L(M.lineWidth,{index:R,from:O});var k=new Path2D;k.arc(O.x*S.width,O.y*S.height,L(M.radius,{index:R,from:O}),0,2*Math.PI),y.fill(k),y.stroke(k),++R}y.restore()}}),f("drawConnectors",function(y,E,M,S){if(E&&M){S=p(S),y.save();var R=y.canvas,O=0;M=s(M);for(var k=M.next();!k.done;k=M.next()){var $=k.value;y.beginPath(),k=E[$[0]],$=E[$[1]],k&&$&&(k.visibility===void 0||k.visibility>S.visibilityMin)&&($.visibility===void 0||$.visibility>S.visibilityMin)&&(y.strokeStyle=L(S.color,{index:O,from:k,to:$}),y.lineWidth=L(S.lineWidth,{index:O,from:k,to:$}),y.moveTo(k.x*R.width,k.y*R.height),y.lineTo($.x*R.width,$.y*R.height)),++O,y.stroke()}y.restore()}}),f("drawRectangle",function(y,E,M){M=p(M),y.save();var S=y.canvas;y.beginPath(),y.lineWidth=L(M.lineWidth,{}),y.strokeStyle=L(M.color,{}),y.fillStyle=L(M.fillColor,{}),y.translate(E.xCenter*S.width,E.yCenter*S.height),y.rotate(E.rotation*Math.PI/180),y.rect(-E.width/2*S.width,-E.height/2*S.height,E.width*S.width,E.height*S.height),y.translate(-E.xCenter*S.width,-E.yCenter*S.height),y.stroke(),y.fill(),y.restore()}),f("lerp",function(y,E,M,S,R){return x(S*(1-(y-E)/(M-E))+R*(1-(M-y)/(M-E)),S,R)})}).call(Be);class ns extends oo{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(n){return new ss(n)}),this.register(function(n){return new ds(n)}),this.register(function(n){return new fs(n)}),this.register(function(n){return new as(n)}),this.register(function(n){return new ls(n)}),this.register(function(n){return new us(n)}),this.register(function(n){return new cs(n)}),this.register(function(n){return new hs(n)}),this.register(function(n){return new rs(n)}),this.register(function(n){return new ps(n)})}load(e,n,i,r){const s=this;let l;this.resourcePath!==""?l=this.resourcePath:this.path!==""?l=this.path:l=tt.extractUrlBase(e),this.manager.itemStart(e);const c=function(f){r?r(f):console.error(f),s.manager.itemError(e),s.manager.itemEnd(e)},h=new ki(this.manager);h.setPath(this.path),h.setResponseType("arraybuffer"),h.setRequestHeader(this.requestHeader),h.setWithCredentials(this.withCredentials),h.load(e,function(f){try{s.parse(f,l,function(m){n(m),s.manager.itemEnd(e)},c)}catch(m){c(m)}},i,c)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,n,i,r){let s;const l={},c={};if(typeof e=="string")s=e;else if(tt.decodeText(new Uint8Array(e,0,4))===cr){try{l[K.KHR_BINARY_GLTF]=new gs(e)}catch(p){r&&r(p);return}s=l[K.KHR_BINARY_GLTF].content}else s=tt.decodeText(new Uint8Array(e));const h=JSON.parse(s);if(h.asset===void 0||h.asset.version[0]<2){r&&r(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const f=new As(h,{path:n||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});f.fileLoader.setRequestHeader(this.requestHeader);for(let m=0;m<this.pluginCallbacks.length;m++){const p=this.pluginCallbacks[m](f);c[p.name]=p,l[p.name]=!0}if(h.extensionsUsed)for(let m=0;m<h.extensionsUsed.length;++m){const p=h.extensionsUsed[m],L=h.extensionsRequired||[];switch(p){case K.KHR_MATERIALS_UNLIT:l[p]=new os;break;case K.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:l[p]=new vs;break;case K.KHR_DRACO_MESH_COMPRESSION:l[p]=new ms(h,this.dracoLoader);break;case K.KHR_TEXTURE_TRANSFORM:l[p]=new ys;break;case K.KHR_MESH_QUANTIZATION:l[p]=new _s;break;default:L.indexOf(p)>=0&&c[p]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+p+'".')}}f.setExtensions(l),f.setPlugins(c),f.parse(i,r)}parseAsync(e,n){const i=this;return new Promise(function(r,s){i.parse(e,n,r,s)})}}function is(){let a={};return{get:function(e){return a[e]},add:function(e,n){a[e]=n},remove:function(e){delete a[e]},removeAll:function(){a={}}}}const K={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class rs{constructor(e){this.parser=e,this.name=K.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,n=this.parser.json.nodes||[];for(let i=0,r=n.length;i<r;i++){const s=n[i];s.extensions&&s.extensions[this.name]&&s.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,s.extensions[this.name].light)}}_loadLight(e){const n=this.parser,i="light:"+e;let r=n.cache.get(i);if(r)return r;const s=n.json,h=((s.extensions&&s.extensions[this.name]||{}).lights||[])[e];let f;const m=new fe(16777215);h.color!==void 0&&m.fromArray(h.color);const p=h.range!==void 0?h.range:0;switch(h.type){case"directional":f=new Gi(m),f.target.position.set(0,0,-1),f.add(f.target);break;case"point":f=new ao(m),f.distance=p;break;case"spot":f=new so(m),f.distance=p,h.spot=h.spot||{},h.spot.innerConeAngle=h.spot.innerConeAngle!==void 0?h.spot.innerConeAngle:0,h.spot.outerConeAngle=h.spot.outerConeAngle!==void 0?h.spot.outerConeAngle:Math.PI/4,f.angle=h.spot.outerConeAngle,f.penumbra=1-h.spot.innerConeAngle/h.spot.outerConeAngle,f.target.position.set(0,0,-1),f.add(f.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+h.type)}return f.position.set(0,0,0),f.decay=2,h.intensity!==void 0&&(f.intensity=h.intensity),f.name=n.createUniqueName(h.name||"light_"+e),r=Promise.resolve(f),n.cache.add(i,r),r}createNodeAttachment(e){const n=this,i=this.parser,s=i.json.nodes[e],c=(s.extensions&&s.extensions[this.name]||{}).light;return c===void 0?null:this._loadLight(c).then(function(h){return i._getNodeRef(n.cache,c,h)})}}class os{constructor(){this.name=K.KHR_MATERIALS_UNLIT}getMaterialType(){return Xe}extendParams(e,n,i){const r=[];e.color=new fe(1,1,1),e.opacity=1;const s=n.pbrMetallicRoughness;if(s){if(Array.isArray(s.baseColorFactor)){const l=s.baseColorFactor;e.color.fromArray(l),e.opacity=l[3]}s.baseColorTexture!==void 0&&r.push(i.assignTexture(e,"map",s.baseColorTexture))}return Promise.all(r)}}class ss{constructor(e){this.parser=e,this.name=K.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:mt}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],l=r.extensions[this.name];if(l.clearcoatFactor!==void 0&&(n.clearcoat=l.clearcoatFactor),l.clearcoatTexture!==void 0&&s.push(i.assignTexture(n,"clearcoatMap",l.clearcoatTexture)),l.clearcoatRoughnessFactor!==void 0&&(n.clearcoatRoughness=l.clearcoatRoughnessFactor),l.clearcoatRoughnessTexture!==void 0&&s.push(i.assignTexture(n,"clearcoatRoughnessMap",l.clearcoatRoughnessTexture)),l.clearcoatNormalTexture!==void 0&&(s.push(i.assignTexture(n,"clearcoatNormalMap",l.clearcoatNormalTexture)),l.clearcoatNormalTexture.scale!==void 0)){const c=l.clearcoatNormalTexture.scale;n.clearcoatNormalScale=new it(c,c)}return Promise.all(s)}}class as{constructor(e){this.parser=e,this.name=K.KHR_MATERIALS_SHEEN}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:mt}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[];n.sheenColor=new fe(0,0,0),n.sheenRoughness=0,n.sheen=1;const l=r.extensions[this.name];return l.sheenColorFactor!==void 0&&n.sheenColor.fromArray(l.sheenColorFactor),l.sheenRoughnessFactor!==void 0&&(n.sheenRoughness=l.sheenRoughnessFactor),l.sheenColorTexture!==void 0&&s.push(i.assignTexture(n,"sheenColorMap",l.sheenColorTexture)),l.sheenRoughnessTexture!==void 0&&s.push(i.assignTexture(n,"sheenRoughnessMap",l.sheenRoughnessTexture)),Promise.all(s)}}class ls{constructor(e){this.parser=e,this.name=K.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:mt}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],l=r.extensions[this.name];return l.transmissionFactor!==void 0&&(n.transmission=l.transmissionFactor),l.transmissionTexture!==void 0&&s.push(i.assignTexture(n,"transmissionMap",l.transmissionTexture)),Promise.all(s)}}class us{constructor(e){this.parser=e,this.name=K.KHR_MATERIALS_VOLUME}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:mt}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],l=r.extensions[this.name];n.thickness=l.thicknessFactor!==void 0?l.thicknessFactor:0,l.thicknessTexture!==void 0&&s.push(i.assignTexture(n,"thicknessMap",l.thicknessTexture)),n.attenuationDistance=l.attenuationDistance||0;const c=l.attenuationColor||[1,1,1];return n.attenuationColor=new fe(c[0],c[1],c[2]),Promise.all(s)}}class cs{constructor(e){this.parser=e,this.name=K.KHR_MATERIALS_IOR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:mt}extendMaterialParams(e,n){const r=this.parser.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=r.extensions[this.name];return n.ior=s.ior!==void 0?s.ior:1.5,Promise.resolve()}}class hs{constructor(e){this.parser=e,this.name=K.KHR_MATERIALS_SPECULAR}getMaterialType(e){const i=this.parser.json.materials[e];return!i.extensions||!i.extensions[this.name]?null:mt}extendMaterialParams(e,n){const i=this.parser,r=i.json.materials[e];if(!r.extensions||!r.extensions[this.name])return Promise.resolve();const s=[],l=r.extensions[this.name];n.specularIntensity=l.specularFactor!==void 0?l.specularFactor:1,l.specularTexture!==void 0&&s.push(i.assignTexture(n,"specularIntensityMap",l.specularTexture));const c=l.specularColorFactor||[1,1,1];return n.specularColor=new fe(c[0],c[1],c[2]),l.specularColorTexture!==void 0&&s.push(i.assignTexture(n,"specularColorMap",l.specularColorTexture).then(function(h){h.encoding=Ae})),Promise.all(s)}}class ds{constructor(e){this.parser=e,this.name=K.KHR_TEXTURE_BASISU}loadTexture(e){const n=this.parser,i=n.json,r=i.textures[e];if(!r.extensions||!r.extensions[this.name])return null;const s=r.extensions[this.name],l=n.options.ktx2Loader;if(!l){if(i.extensionsRequired&&i.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return n.loadTextureImage(e,s.source,l)}}class fs{constructor(e){this.parser=e,this.name=K.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const n=this.name,i=this.parser,r=i.json,s=r.textures[e];if(!s.extensions||!s.extensions[n])return null;const l=s.extensions[n],c=r.images[l.source];let h=i.textureLoader;if(c.uri){const f=i.options.manager.getHandler(c.uri);f!==null&&(h=f)}return this.detectSupport().then(function(f){if(f)return i.loadTextureImage(e,c,h);if(r.extensionsRequired&&r.extensionsRequired.indexOf(n)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return i.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const n=new Image;n.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",n.onload=n.onerror=function(){e(n.height===1)}})),this.isSupported}}class ps{constructor(e){this.name=K.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const n=this.parser.json,i=n.bufferViews[e];if(i.extensions&&i.extensions[this.name]){const r=i.extensions[this.name],s=this.parser.getDependency("buffer",r.buffer),l=this.parser.options.meshoptDecoder;if(!l||!l.supported){if(n.extensionsRequired&&n.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([s,l.ready]).then(function(c){const h=r.byteOffset||0,f=r.byteLength||0,m=r.count,p=r.byteStride,L=new ArrayBuffer(m*p),x=new Uint8Array(c[0],h,f);return l.decodeGltfBuffer(new Uint8Array(L),m,p,x,r.mode,r.filter),L})}else return null}}const cr="glTF",Lt=12,Ai={JSON:1313821514,BIN:5130562};class gs{constructor(e){this.name=K.KHR_BINARY_GLTF,this.content=null,this.body=null;const n=new DataView(e,0,Lt);if(this.header={magic:tt.decodeText(new Uint8Array(e.slice(0,4))),version:n.getUint32(4,!0),length:n.getUint32(8,!0)},this.header.magic!==cr)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const i=this.header.length-Lt,r=new DataView(e,Lt);let s=0;for(;s<i;){const l=r.getUint32(s,!0);s+=4;const c=r.getUint32(s,!0);if(s+=4,c===Ai.JSON){const h=new Uint8Array(e,Lt+s,l);this.content=tt.decodeText(h)}else if(c===Ai.BIN){const h=Lt+s;this.body=e.slice(h,h+l)}s+=l}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class ms{constructor(e,n){if(!n)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=K.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=n,this.dracoLoader.preload()}decodePrimitive(e,n){const i=this.json,r=this.dracoLoader,s=e.extensions[this.name].bufferView,l=e.extensions[this.name].attributes,c={},h={},f={};for(const m in l){const p=xn[m]||m.toLowerCase();c[p]=l[m]}for(const m in e.attributes){const p=xn[m]||m.toLowerCase();if(l[m]!==void 0){const L=i.accessors[e.attributes[m]],x=Pt[L.componentType];f[p]=x,h[p]=L.normalized===!0}}return n.getDependency("bufferView",s).then(function(m){return new Promise(function(p){r.decodeDracoFile(m,function(L){for(const x in L.attributes){const y=L.attributes[x],E=h[x];E!==void 0&&(y.normalized=E)}p(L)},c,f)})})}}class ys{constructor(){this.name=K.KHR_TEXTURE_TRANSFORM}extendTexture(e,n){return n.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),n.offset===void 0&&n.rotation===void 0&&n.scale===void 0||(e=e.clone(),n.offset!==void 0&&e.offset.fromArray(n.offset),n.rotation!==void 0&&(e.rotation=n.rotation),n.scale!==void 0&&e.repeat.fromArray(n.scale),e.needsUpdate=!0),e}}class _n extends Ln{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const n=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),i=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),r=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),s=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),l=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),c={specular:{value:new fe().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=c,this.onBeforeCompile=function(h){for(const f in c)h.uniforms[f]=c[f];h.fragmentShader=h.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",n).replace("#include <metalnessmap_pars_fragment>",i).replace("#include <roughnessmap_fragment>",r).replace("#include <metalnessmap_fragment>",s).replace("#include <lights_physical_fragment>",l)},Object.defineProperties(this,{specular:{get:function(){return c.specular.value},set:function(h){c.specular.value=h}},specularMap:{get:function(){return c.specularMap.value},set:function(h){c.specularMap.value=h,h?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return c.glossiness.value},set:function(h){c.glossiness.value=h}},glossinessMap:{get:function(){return c.glossinessMap.value},set:function(h){c.glossinessMap.value=h,h?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class vs{constructor(){this.name=K.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"]}getMaterialType(){return _n}extendParams(e,n,i){const r=n.extensions[this.name];e.color=new fe(1,1,1),e.opacity=1;const s=[];if(Array.isArray(r.diffuseFactor)){const l=r.diffuseFactor;e.color.fromArray(l),e.opacity=l[3]}if(r.diffuseTexture!==void 0&&s.push(i.assignTexture(e,"map",r.diffuseTexture)),e.emissive=new fe(0,0,0),e.glossiness=r.glossinessFactor!==void 0?r.glossinessFactor:1,e.specular=new fe(1,1,1),Array.isArray(r.specularFactor)&&e.specular.fromArray(r.specularFactor),r.specularGlossinessTexture!==void 0){const l=r.specularGlossinessTexture;s.push(i.assignTexture(e,"glossinessMap",l)),s.push(i.assignTexture(e,"specularMap",l))}return Promise.all(s)}createMaterial(e){const n=new _n(e);return n.fog=!0,n.color=e.color,n.map=e.map===void 0?null:e.map,n.lightMap=null,n.lightMapIntensity=1,n.aoMap=e.aoMap===void 0?null:e.aoMap,n.aoMapIntensity=1,n.emissive=e.emissive,n.emissiveIntensity=1,n.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,n.bumpMap=e.bumpMap===void 0?null:e.bumpMap,n.bumpScale=1,n.normalMap=e.normalMap===void 0?null:e.normalMap,n.normalMapType=ji,e.normalScale&&(n.normalScale=e.normalScale),n.displacementMap=null,n.displacementScale=1,n.displacementBias=0,n.specularMap=e.specularMap===void 0?null:e.specularMap,n.specular=e.specular,n.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,n.glossiness=e.glossiness,n.alphaMap=null,n.envMap=e.envMap===void 0?null:e.envMap,n.envMapIntensity=1,n.refractionRatio=.98,n}}class _s{constructor(){this.name=K.KHR_MESH_QUANTIZATION}}class nt extends lo{constructor(e,n,i,r){super(e,n,i,r)}copySampleValue_(e){const n=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r*3+r;for(let l=0;l!==r;l++)n[l]=i[s+l];return n}}nt.prototype.beforeStart_=nt.prototype.copySampleValue_;nt.prototype.afterEnd_=nt.prototype.copySampleValue_;nt.prototype.interpolate_=function(a,e,n,i){const r=this.resultBuffer,s=this.sampleValues,l=this.valueSize,c=l*2,h=l*3,f=i-e,m=(n-e)/f,p=m*m,L=p*m,x=a*h,y=x-h,E=-2*L+3*p,M=L-p,S=1-E,R=M-p+m;for(let O=0;O!==l;O++){const k=s[y+O+l],$=s[y+O+c]*f,se=s[x+O+l],C=s[x+O]*f;r[O]=S*k+R*$+E*se+M*C}return r};const xs=new Ce;class Ts extends nt{interpolate_(e,n,i,r){const s=super.interpolate_(e,n,i,r);return xs.fromArray(s).normalize().toArray(s),s}}const He={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},Pt={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},bi={9728:uo,9729:Wi,9984:co,9985:ho,9986:fo,9987:Vi},Ii={33071:po,33648:go,10497:yn},Oi={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},xn={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},Ve={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Es={CUBICSPLINE:void 0,LINEAR:Xi,STEP:mo},fn={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Ls(a){return a.DefaultMaterial===void 0&&(a.DefaultMaterial=new Ln({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:vn})),a.DefaultMaterial}function wt(a,e,n){for(const i in n.extensions)a[i]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[i]=n.extensions[i])}function Qe(a,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(a.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function ws(a,e,n){let i=!1,r=!1,s=!1;for(let f=0,m=e.length;f<m;f++){const p=e[f];if(p.POSITION!==void 0&&(i=!0),p.NORMAL!==void 0&&(r=!0),p.COLOR_0!==void 0&&(s=!0),i&&r&&s)break}if(!i&&!r&&!s)return Promise.resolve(a);const l=[],c=[],h=[];for(let f=0,m=e.length;f<m;f++){const p=e[f];if(i){const L=p.POSITION!==void 0?n.getDependency("accessor",p.POSITION):a.attributes.position;l.push(L)}if(r){const L=p.NORMAL!==void 0?n.getDependency("accessor",p.NORMAL):a.attributes.normal;c.push(L)}if(s){const L=p.COLOR_0!==void 0?n.getDependency("accessor",p.COLOR_0):a.attributes.color;h.push(L)}}return Promise.all([Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(f){const m=f[0],p=f[1],L=f[2];return i&&(a.morphAttributes.position=m),r&&(a.morphAttributes.normal=p),s&&(a.morphAttributes.color=L),a.morphTargetsRelative=!0,a})}function Rs(a,e){if(a.updateMorphTargets(),e.weights!==void 0)for(let n=0,i=e.weights.length;n<i;n++)a.morphTargetInfluences[n]=e.weights[n];if(e.extras&&Array.isArray(e.extras.targetNames)){const n=e.extras.targetNames;if(a.morphTargetInfluences.length===n.length){a.morphTargetDictionary={};for(let i=0,r=n.length;i<r;i++)a.morphTargetDictionary[n[i]]=i}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function Ms(a){const e=a.extensions&&a.extensions[K.KHR_DRACO_MESH_COMPRESSION];let n;return e?n="draco:"+e.bufferView+":"+e.indices+":"+Pi(e.attributes):n=a.indices+":"+Pi(a.attributes)+":"+a.mode,n}function Pi(a){let e="";const n=Object.keys(a).sort();for(let i=0,r=n.length;i<r;i++)e+=n[i]+":"+a[n[i]]+";";return e}function Tn(a){switch(a){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function Ss(a){return a.search(/\.jpe?g($|\?)/i)>0||a.search(/^data\:image\/jpeg/)===0?"image/jpeg":a.search(/\.webp($|\?)/i)>0||a.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class As{constructor(e={},n={}){this.json=e,this.extensions={},this.plugins={},this.options=n,this.cache=new is,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={},typeof createImageBitmap!="undefined"&&/Firefox|^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!1?this.textureLoader=new yo(this.options.manager):this.textureLoader=new vo(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new ki(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,n){const i=this,r=this.json,s=this.extensions;this.cache.removeAll(),this._invokeAll(function(l){return l._markDefs&&l._markDefs()}),Promise.all(this._invokeAll(function(l){return l.beforeRoot&&l.beforeRoot()})).then(function(){return Promise.all([i.getDependencies("scene"),i.getDependencies("animation"),i.getDependencies("camera")])}).then(function(l){const c={scene:l[0][r.scene||0],scenes:l[0],animations:l[1],cameras:l[2],asset:r.asset,parser:i,userData:{}};wt(s,c,r),Qe(c,r),Promise.all(i._invokeAll(function(h){return h.afterRoot&&h.afterRoot(c)})).then(function(){e(c)})}).catch(n)}_markDefs(){const e=this.json.nodes||[],n=this.json.skins||[],i=this.json.meshes||[];for(let r=0,s=n.length;r<s;r++){const l=n[r].joints;for(let c=0,h=l.length;c<h;c++)e[l[c]].isBone=!0}for(let r=0,s=e.length;r<s;r++){const l=e[r];l.mesh!==void 0&&(this._addNodeRef(this.meshCache,l.mesh),l.skin!==void 0&&(i[l.mesh].isSkinnedMesh=!0)),l.camera!==void 0&&this._addNodeRef(this.cameraCache,l.camera)}}_addNodeRef(e,n){n!==void 0&&(e.refs[n]===void 0&&(e.refs[n]=e.uses[n]=0),e.refs[n]++)}_getNodeRef(e,n,i){if(e.refs[n]<=1)return i;const r=i.clone(),s=(l,c)=>{const h=this.associations.get(l);h!=null&&this.associations.set(c,h);for(const[f,m]of l.children.entries())s(m,c.children[f])};return s(i,r),r.name+="_instance_"+e.uses[n]++,r}_invokeOne(e){const n=Object.values(this.plugins);n.push(this);for(let i=0;i<n.length;i++){const r=e(n[i]);if(r)return r}return null}_invokeAll(e){const n=Object.values(this.plugins);n.unshift(this);const i=[];for(let r=0;r<n.length;r++){const s=e(n[r]);s&&i.push(s)}return i}getDependency(e,n){const i=e+":"+n;let r=this.cache.get(i);if(!r){switch(e){case"scene":r=this.loadScene(n);break;case"node":r=this.loadNode(n);break;case"mesh":r=this._invokeOne(function(s){return s.loadMesh&&s.loadMesh(n)});break;case"accessor":r=this.loadAccessor(n);break;case"bufferView":r=this._invokeOne(function(s){return s.loadBufferView&&s.loadBufferView(n)});break;case"buffer":r=this.loadBuffer(n);break;case"material":r=this._invokeOne(function(s){return s.loadMaterial&&s.loadMaterial(n)});break;case"texture":r=this._invokeOne(function(s){return s.loadTexture&&s.loadTexture(n)});break;case"skin":r=this.loadSkin(n);break;case"animation":r=this.loadAnimation(n);break;case"camera":r=this.loadCamera(n);break;default:throw new Error("Unknown type: "+e)}this.cache.add(i,r)}return r}getDependencies(e){let n=this.cache.get(e);if(!n){const i=this,r=this.json[e+(e==="mesh"?"es":"s")]||[];n=Promise.all(r.map(function(s,l){return i.getDependency(e,l)})),this.cache.add(e,n)}return n}loadBuffer(e){const n=this.json.buffers[e],i=this.fileLoader;if(n.type&&n.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+n.type+" buffer type is not supported.");if(n.uri===void 0&&e===0)return Promise.resolve(this.extensions[K.KHR_BINARY_GLTF].body);const r=this.options;return new Promise(function(s,l){i.load(tt.resolveURL(n.uri,r.path),s,void 0,function(){l(new Error('THREE.GLTFLoader: Failed to load buffer "'+n.uri+'".'))})})}loadBufferView(e){const n=this.json.bufferViews[e];return this.getDependency("buffer",n.buffer).then(function(i){const r=n.byteLength||0,s=n.byteOffset||0;return i.slice(s,s+r)})}loadAccessor(e){const n=this,i=this.json,r=this.json.accessors[e];if(r.bufferView===void 0&&r.sparse===void 0)return Promise.resolve(null);const s=[];return r.bufferView!==void 0?s.push(this.getDependency("bufferView",r.bufferView)):s.push(null),r.sparse!==void 0&&(s.push(this.getDependency("bufferView",r.sparse.indices.bufferView)),s.push(this.getDependency("bufferView",r.sparse.values.bufferView))),Promise.all(s).then(function(l){const c=l[0],h=Oi[r.type],f=Pt[r.componentType],m=f.BYTES_PER_ELEMENT,p=m*h,L=r.byteOffset||0,x=r.bufferView!==void 0?i.bufferViews[r.bufferView].byteStride:void 0,y=r.normalized===!0;let E,M;if(x&&x!==p){const S=Math.floor(L/x),R="InterleavedBuffer:"+r.bufferView+":"+r.componentType+":"+S+":"+r.count;let O=n.cache.get(R);O||(E=new f(c,S*x,r.count*x/m),O=new _o(E,x/m),n.cache.add(R,O)),M=new xo(O,h,L%x/m,y)}else c===null?E=new f(r.count*h):E=new f(c,L,r.count*h),M=new St(E,h,y);if(r.sparse!==void 0){const S=Oi.SCALAR,R=Pt[r.sparse.indices.componentType],O=r.sparse.indices.byteOffset||0,k=r.sparse.values.byteOffset||0,$=new R(l[1],O,r.sparse.count*S),se=new f(l[2],k,r.sparse.count*h);c!==null&&(M=new St(M.array.slice(),M.itemSize,M.normalized));for(let C=0,N=$.length;C<N;C++){const j=$[C];if(M.setX(j,se[C*h]),h>=2&&M.setY(j,se[C*h+1]),h>=3&&M.setZ(j,se[C*h+2]),h>=4&&M.setW(j,se[C*h+3]),h>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return M})}loadTexture(e){const n=this.json,i=this.options,s=n.textures[e].source,l=n.images[s];let c=this.textureLoader;if(l.uri){const h=i.manager.getHandler(l.uri);h!==null&&(c=h)}return this.loadTextureImage(e,s,c)}loadTextureImage(e,n,i){const r=this,s=this.json,l=s.textures[e],c=s.images[n],h=(c.uri||c.bufferView)+":"+l.sampler;if(this.textureCache[h])return this.textureCache[h];const f=this.loadImageSource(n,i).then(function(m){m.flipY=!1,l.name&&(m.name=l.name);const L=(s.samplers||{})[l.sampler]||{};return m.magFilter=bi[L.magFilter]||Wi,m.minFilter=bi[L.minFilter]||Vi,m.wrapS=Ii[L.wrapS]||yn,m.wrapT=Ii[L.wrapT]||yn,r.associations.set(m,{textures:e}),m}).catch(function(){return null});return this.textureCache[h]=f,f}loadImageSource(e,n){const i=this,r=this.json,s=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(function(p){return p.clone()}).catch(function(p){throw p});const l=r.images[e],c=self.URL||self.webkitURL;let h=l.uri||"",f=!1;if(l.bufferView!==void 0)h=i.getDependency("bufferView",l.bufferView).then(function(p){f=!0;const L=new Blob([p],{type:l.mimeType});return h=c.createObjectURL(L),h});else if(l.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const m=Promise.resolve(h).then(function(p){return new Promise(function(L,x){let y=L;n.isImageBitmapLoader===!0&&(y=function(E){const M=new xi(E);M.needsUpdate=!0,L(M)}),n.load(tt.resolveURL(p,s.path),y,void 0,x)})}).then(function(p){return f===!0&&c.revokeObjectURL(h),p.userData.mimeType=l.mimeType||Ss(l.uri),p}).catch(function(p){throw console.error("THREE.GLTFLoader: Couldn't load texture",h),p});return this.sourceCache[e]=m,m}assignTexture(e,n,i){const r=this;return this.getDependency("texture",i.index).then(function(s){if(i.texCoord!==void 0&&i.texCoord!=0&&!(n==="aoMap"&&i.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+i.texCoord+" for texture "+n+" not yet supported."),r.extensions[K.KHR_TEXTURE_TRANSFORM]){const l=i.extensions!==void 0?i.extensions[K.KHR_TEXTURE_TRANSFORM]:void 0;if(l){const c=r.associations.get(s);s=r.extensions[K.KHR_TEXTURE_TRANSFORM].extendTexture(s,l),r.associations.set(s,c)}}return e[n]=s,s})}assignFinalMaterial(e){const n=e.geometry;let i=e.material;const r=n.attributes.tangent===void 0,s=n.attributes.color!==void 0,l=n.attributes.normal===void 0;if(e.isPoints){const c="PointsMaterial:"+i.uuid;let h=this.cache.get(c);h||(h=new To,hn.prototype.copy.call(h,i),h.color.copy(i.color),h.map=i.map,h.sizeAttenuation=!1,this.cache.add(c,h)),i=h}else if(e.isLine){const c="LineBasicMaterial:"+i.uuid;let h=this.cache.get(c);h||(h=new Eo,hn.prototype.copy.call(h,i),h.color.copy(i.color),this.cache.add(c,h)),i=h}if(r||s||l){let c="ClonedMaterial:"+i.uuid+":";i.isGLTFSpecularGlossinessMaterial&&(c+="specular-glossiness:"),r&&(c+="derivative-tangents:"),s&&(c+="vertex-colors:"),l&&(c+="flat-shading:");let h=this.cache.get(c);h||(h=i.clone(),s&&(h.vertexColors=!0),l&&(h.flatShading=!0),r&&(h.normalScale&&(h.normalScale.y*=-1),h.clearcoatNormalScale&&(h.clearcoatNormalScale.y*=-1)),this.cache.add(c,h),this.associations.set(h,this.associations.get(i))),i=h}i.aoMap&&n.attributes.uv2===void 0&&n.attributes.uv!==void 0&&n.setAttribute("uv2",n.attributes.uv),e.material=i}getMaterialType(){return Ln}loadMaterial(e){const n=this,i=this.json,r=this.extensions,s=i.materials[e];let l;const c={},h=s.extensions||{},f=[];if(h[K.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const p=r[K.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];l=p.getMaterialType(),f.push(p.extendParams(c,s,n))}else if(h[K.KHR_MATERIALS_UNLIT]){const p=r[K.KHR_MATERIALS_UNLIT];l=p.getMaterialType(),f.push(p.extendParams(c,s,n))}else{const p=s.pbrMetallicRoughness||{};if(c.color=new fe(1,1,1),c.opacity=1,Array.isArray(p.baseColorFactor)){const L=p.baseColorFactor;c.color.fromArray(L),c.opacity=L[3]}p.baseColorTexture!==void 0&&f.push(n.assignTexture(c,"map",p.baseColorTexture)),c.metalness=p.metallicFactor!==void 0?p.metallicFactor:1,c.roughness=p.roughnessFactor!==void 0?p.roughnessFactor:1,p.metallicRoughnessTexture!==void 0&&(f.push(n.assignTexture(c,"metalnessMap",p.metallicRoughnessTexture)),f.push(n.assignTexture(c,"roughnessMap",p.metallicRoughnessTexture))),l=this._invokeOne(function(L){return L.getMaterialType&&L.getMaterialType(e)}),f.push(Promise.all(this._invokeAll(function(L){return L.extendMaterialParams&&L.extendMaterialParams(e,c)})))}s.doubleSided===!0&&(c.side=Wt);const m=s.alphaMode||fn.OPAQUE;if(m===fn.BLEND?(c.transparent=!0,c.depthWrite=!1):(c.transparent=!1,m===fn.MASK&&(c.alphaTest=s.alphaCutoff!==void 0?s.alphaCutoff:.5)),s.normalTexture!==void 0&&l!==Xe&&(f.push(n.assignTexture(c,"normalMap",s.normalTexture)),c.normalScale=new it(1,1),s.normalTexture.scale!==void 0)){const p=s.normalTexture.scale;c.normalScale.set(p,p)}return s.occlusionTexture!==void 0&&l!==Xe&&(f.push(n.assignTexture(c,"aoMap",s.occlusionTexture)),s.occlusionTexture.strength!==void 0&&(c.aoMapIntensity=s.occlusionTexture.strength)),s.emissiveFactor!==void 0&&l!==Xe&&(c.emissive=new fe().fromArray(s.emissiveFactor)),s.emissiveTexture!==void 0&&l!==Xe&&f.push(n.assignTexture(c,"emissiveMap",s.emissiveTexture)),Promise.all(f).then(function(){let p;return l===_n?p=r[K.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(c):p=new l(c),s.name&&(p.name=s.name),p.map&&(p.map.encoding=Ae),p.emissiveMap&&(p.emissiveMap.encoding=Ae),p.sheenColorMap&&(p.sheenColorMap.encoding=Ae),p.specularColorMap&&(p.specularColorMap.encoding=Ae),p.specularMap&&(p.specularMap.encoding=Ae),Qe(p,s),n.associations.set(p,{materials:e}),s.extensions&&wt(r,p,s),p})}createUniqueName(e){const n=Lo.sanitizeNodeName(e||"");let i=n;for(let r=1;this.nodeNamesUsed[i];++r)i=n+"_"+r;return this.nodeNamesUsed[i]=!0,i}loadGeometries(e){const n=this,i=this.extensions,r=this.primitiveCache;function s(c){return i[K.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(c,n).then(function(h){return Ci(h,c,n)})}const l=[];for(let c=0,h=e.length;c<h;c++){const f=e[c],m=Ms(f),p=r[m];if(p)l.push(p.promise);else{let L;f.extensions&&f.extensions[K.KHR_DRACO_MESH_COMPRESSION]?L=s(f):L=Ci(new Yi,f,n),r[m]={primitive:f,promise:L},l.push(L)}}return Promise.all(l)}loadMesh(e){const n=this,i=this.json,r=this.extensions,s=i.meshes[e],l=s.primitives,c=[];for(let h=0,f=l.length;h<f;h++){const m=l[h].material===void 0?Ls(this.cache):this.getDependency("material",l[h].material);c.push(m)}return c.push(n.loadGeometries(l)),Promise.all(c).then(function(h){const f=h.slice(0,h.length-1),m=h[h.length-1],p=[];for(let x=0,y=m.length;x<y;x++){const E=m[x],M=l[x];let S;const R=f[x];if(M.mode===He.TRIANGLES||M.mode===He.TRIANGLE_STRIP||M.mode===He.TRIANGLE_FAN||M.mode===void 0)S=s.isSkinnedMesh===!0?new Ki(E,R):new Kt(E,R),S.isSkinnedMesh===!0&&!S.geometry.attributes.skinWeight.normalized&&S.normalizeSkinWeights(),M.mode===He.TRIANGLE_STRIP?S.geometry=Di(S.geometry,wo):M.mode===He.TRIANGLE_FAN&&(S.geometry=Di(S.geometry,qi));else if(M.mode===He.LINES)S=new Ro(E,R);else if(M.mode===He.LINE_STRIP)S=new Mo(E,R);else if(M.mode===He.LINE_LOOP)S=new So(E,R);else if(M.mode===He.POINTS)S=new Ao(E,R);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+M.mode);Object.keys(S.geometry.morphAttributes).length>0&&Rs(S,s),S.name=n.createUniqueName(s.name||"mesh_"+e),Qe(S,s),M.extensions&&wt(r,S,M),n.assignFinalMaterial(S),p.push(S)}for(let x=0,y=p.length;x<y;x++)n.associations.set(p[x],{meshes:e,primitives:x});if(p.length===1)return p[0];const L=new dn;n.associations.set(L,{meshes:e});for(let x=0,y=p.length;x<y;x++)L.add(p[x]);return L})}loadCamera(e){let n;const i=this.json.cameras[e],r=i[i.type];if(!r){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return i.type==="perspective"?n=new Zi(bo.radToDeg(r.yfov),r.aspectRatio||1,r.znear||1,r.zfar||2e6):i.type==="orthographic"&&(n=new $i(-r.xmag,r.xmag,r.ymag,-r.ymag,r.znear,r.zfar)),i.name&&(n.name=this.createUniqueName(i.name)),Qe(n,i),Promise.resolve(n)}loadSkin(e){const n=this.json.skins[e],i={joints:n.joints};return n.inverseBindMatrices===void 0?Promise.resolve(i):this.getDependency("accessor",n.inverseBindMatrices).then(function(r){return i.inverseBindMatrices=r,i})}loadAnimation(e){const i=this.json.animations[e],r=[],s=[],l=[],c=[],h=[];for(let f=0,m=i.channels.length;f<m;f++){const p=i.channels[f],L=i.samplers[p.sampler],x=p.target,y=x.node!==void 0?x.node:x.id,E=i.parameters!==void 0?i.parameters[L.input]:L.input,M=i.parameters!==void 0?i.parameters[L.output]:L.output;r.push(this.getDependency("node",y)),s.push(this.getDependency("accessor",E)),l.push(this.getDependency("accessor",M)),c.push(L),h.push(x)}return Promise.all([Promise.all(r),Promise.all(s),Promise.all(l),Promise.all(c),Promise.all(h)]).then(function(f){const m=f[0],p=f[1],L=f[2],x=f[3],y=f[4],E=[];for(let S=0,R=m.length;S<R;S++){const O=m[S],k=p[S],$=L[S],se=x[S],C=y[S];if(O===void 0)continue;O.updateMatrix(),O.matrixAutoUpdate=!0;let N;switch(Ve[C.path]){case Ve.weights:N=Oo;break;case Ve.rotation:N=_i;break;case Ve.position:case Ve.scale:default:N=Io;break}const j=O.name?O.name:O.uuid,v=se.interpolation!==void 0?Es[se.interpolation]:Xi,A=[];Ve[C.path]===Ve.weights?O.traverse(function(U){U.morphTargetInfluences&&A.push(U.name?U.name:U.uuid)}):A.push(j);let H=$.array;if($.normalized){const U=Tn(H.constructor),F=new Float32Array(H.length);for(let te=0,P=H.length;te<P;te++)F[te]=H[te]*U;H=F}for(let U=0,F=A.length;U<F;U++){const te=new N(A[U]+"."+Ve[C.path],k.array,H,v);se.interpolation==="CUBICSPLINE"&&(te.createInterpolant=function(B){const X=this instanceof _i?Ts:nt;return new X(this.times,this.values,this.getValueSize()/3,B)},te.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),E.push(te)}}const M=i.name?i.name:"animation_"+e;return new Po(M,void 0,E)})}createNodeMesh(e){const n=this.json,i=this,r=n.nodes[e];return r.mesh===void 0?null:i.getDependency("mesh",r.mesh).then(function(s){const l=i._getNodeRef(i.meshCache,r.mesh,s);return r.weights!==void 0&&l.traverse(function(c){if(!!c.isMesh)for(let h=0,f=r.weights.length;h<f;h++)c.morphTargetInfluences[h]=r.weights[h]}),l})}loadNode(e){const n=this.json,i=this.extensions,r=this,s=n.nodes[e],l=s.name?r.createUniqueName(s.name):"";return function(){const c=[],h=r._invokeOne(function(f){return f.createNodeMesh&&f.createNodeMesh(e)});return h&&c.push(h),s.camera!==void 0&&c.push(r.getDependency("camera",s.camera).then(function(f){return r._getNodeRef(r.cameraCache,s.camera,f)})),r._invokeAll(function(f){return f.createNodeAttachment&&f.createNodeAttachment(e)}).forEach(function(f){c.push(f)}),Promise.all(c)}().then(function(c){let h;if(s.isBone===!0?h=new Co:c.length>1?h=new dn:c.length===1?h=c[0]:h=new Ji,h!==c[0])for(let f=0,m=c.length;f<m;f++)h.add(c[f]);if(s.name&&(h.userData.name=s.name,h.name=l),Qe(h,s),s.extensions&&wt(i,h,s),s.matrix!==void 0){const f=new De;f.fromArray(s.matrix),h.applyMatrix4(f)}else s.translation!==void 0&&h.position.fromArray(s.translation),s.rotation!==void 0&&h.quaternion.fromArray(s.rotation),s.scale!==void 0&&h.scale.fromArray(s.scale);return r.associations.has(h)||r.associations.set(h,{}),r.associations.get(h).nodes=e,h})}loadScene(e){const n=this.json,i=this.extensions,r=this.json.scenes[e],s=this,l=new dn;r.name&&(l.name=s.createUniqueName(r.name)),Qe(l,r),r.extensions&&wt(i,l,r);const c=r.nodes||[],h=[];for(let f=0,m=c.length;f<m;f++)h.push(hr(c[f],l,n,s));return Promise.all(h).then(function(){const f=m=>{const p=new Map;for(const[L,x]of s.associations)(L instanceof hn||L instanceof xi)&&p.set(L,x);return m.traverse(L=>{const x=s.associations.get(L);x!=null&&p.set(L,x)}),p};return s.associations=f(l),l})}}function hr(a,e,n,i){const r=n.nodes[a];return i.getDependency("node",a).then(function(s){if(r.skin===void 0)return s;let l;return i.getDependency("skin",r.skin).then(function(c){l=c;const h=[];for(let f=0,m=l.joints.length;f<m;f++)h.push(i.getDependency("node",l.joints[f]));return Promise.all(h)}).then(function(c){return s.traverse(function(h){if(!h.isMesh)return;const f=[],m=[];for(let p=0,L=c.length;p<L;p++){const x=c[p];if(x){f.push(x);const y=new De;l.inverseBindMatrices!==void 0&&y.fromArray(l.inverseBindMatrices.array,p*16),m.push(y)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',l.joints[p])}h.bind(new wn(f,m),h.matrixWorld)}),s})}).then(function(s){e.add(s);const l=[];if(r.children){const c=r.children;for(let h=0,f=c.length;h<f;h++){const m=c[h];l.push(hr(m,s,n,i))}}return Promise.all(l)})}function bs(a,e,n){const i=e.attributes,r=new Do;if(i.POSITION!==void 0){const c=n.json.accessors[i.POSITION],h=c.min,f=c.max;if(h!==void 0&&f!==void 0){if(r.set(new q(h[0],h[1],h[2]),new q(f[0],f[1],f[2])),c.normalized){const m=Tn(Pt[c.componentType]);r.min.multiplyScalar(m),r.max.multiplyScalar(m)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const s=e.targets;if(s!==void 0){const c=new q,h=new q;for(let f=0,m=s.length;f<m;f++){const p=s[f];if(p.POSITION!==void 0){const L=n.json.accessors[p.POSITION],x=L.min,y=L.max;if(x!==void 0&&y!==void 0){if(h.setX(Math.max(Math.abs(x[0]),Math.abs(y[0]))),h.setY(Math.max(Math.abs(x[1]),Math.abs(y[1]))),h.setZ(Math.max(Math.abs(x[2]),Math.abs(y[2]))),L.normalized){const E=Tn(Pt[L.componentType]);h.multiplyScalar(E)}c.max(h)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}r.expandByVector(c)}a.boundingBox=r;const l=new No;r.getCenter(l.center),l.radius=r.min.distanceTo(r.max)/2,a.boundingSphere=l}function Ci(a,e,n){const i=e.attributes,r=[];function s(l,c){return n.getDependency("accessor",l).then(function(h){a.setAttribute(c,h)})}for(const l in i){const c=xn[l]||l.toLowerCase();c in a.attributes||r.push(s(i[l],c))}if(e.indices!==void 0&&!a.index){const l=n.getDependency("accessor",e.indices).then(function(c){a.setIndex(c)});r.push(l)}return Qe(a,e),bs(a,e,n),Promise.all(r).then(function(){return e.targets!==void 0?ws(a,e.targets,n):a})}function Di(a,e){let n=a.getIndex();if(n===null){const l=[],c=a.getAttribute("position");if(c!==void 0){for(let h=0;h<c.count;h++)l.push(h);a.setIndex(l),n=a.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),a}const i=n.count-2,r=[];if(e===qi)for(let l=1;l<=i;l++)r.push(n.getX(0)),r.push(n.getX(l)),r.push(n.getX(l+1));else for(let l=0;l<i;l++)l%2===0?(r.push(n.getX(l)),r.push(n.getX(l+1)),r.push(n.getX(l+2))):(r.push(n.getX(l+2)),r.push(n.getX(l+1)),r.push(n.getX(l)));r.length/3!==i&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const s=a.clone();return s.setIndex(r),s}/*! (c) 2019-2021 pixiv Inc. - https://github.com/pixiv/three-vrm/blob/release/LICENSE *//*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function ue(a,e,n,i){return new(n||(n=Promise))(function(r,s){function l(f){try{h(i.next(f))}catch(m){s(m)}}function c(f){try{h(i.throw(f))}catch(m){s(m)}}function h(f){var m;f.done?r(f.value):(m=f.value,m instanceof n?m:new n(function(p){p(m)})).then(l,c)}h((i=i.apply(a,e||[])).next())})}function Ni(a){Object.keys(a).forEach(e=>{const n=a[e];n!=null&&n.isTexture&&n.dispose()}),a.dispose()}function Is(a){const e=a.geometry;e&&e.dispose();const n=a.material;n&&(Array.isArray(n)?n.forEach(i=>Ni(i)):n&&Ni(n))}var ge;(function(a){a[a.NUMBER=0]="NUMBER",a[a.VECTOR2=1]="VECTOR2",a[a.VECTOR3=2]="VECTOR3",a[a.VECTOR4=3]="VECTOR4",a[a.COLOR=4]="COLOR"})(ge||(ge={}));const Os=new it,Ps=new q,Cs=new xe,Ds=new fe;class Ns extends Ji{constructor(e){super(),this.weight=0,this.isBinary=!1,this._binds=[],this._materialValues=[],this.name=`BlendShapeController_${e}`,this.type="BlendShapeController",this.visible=!1}addBind(e){const n=e.weight/100;this._binds.push({meshes:e.meshes,morphTargetIndex:e.morphTargetIndex,weight:n})}addMaterialValue(e){const n=e.material,i=e.propertyName;let r,s,l,c,h=n[i];h&&(h=e.defaultValue||h,h.isVector2?(r=ge.VECTOR2,s=h.clone(),l=new it().fromArray(e.targetValue),c=l.clone().sub(s)):h.isVector3?(r=ge.VECTOR3,s=h.clone(),l=new q().fromArray(e.targetValue),c=l.clone().sub(s)):h.isVector4?(r=ge.VECTOR4,s=h.clone(),l=new xe().fromArray([e.targetValue[2],e.targetValue[3],e.targetValue[0],e.targetValue[1]]),c=l.clone().sub(s)):h.isColor?(r=ge.COLOR,s=h.clone(),l=new fe().fromArray(e.targetValue),c=l.clone().sub(s)):(r=ge.NUMBER,s=h,l=e.targetValue[0],c=l-s),this._materialValues.push({material:n,propertyName:i,defaultValue:s,targetValue:l,deltaValue:c,type:r}))}applyWeight(){const e=this.isBinary?this.weight<.5?0:1:this.weight;this._binds.forEach(n=>{n.meshes.forEach(i=>{i.morphTargetInfluences&&(i.morphTargetInfluences[n.morphTargetIndex]+=e*n.weight)})}),this._materialValues.forEach(n=>{if(n.material[n.propertyName]!==void 0){if(n.type===ge.NUMBER){const i=n.deltaValue;n.material[n.propertyName]+=i*e}else if(n.type===ge.VECTOR2){const i=n.deltaValue;n.material[n.propertyName].add(Os.copy(i).multiplyScalar(e))}else if(n.type===ge.VECTOR3){const i=n.deltaValue;n.material[n.propertyName].add(Ps.copy(i).multiplyScalar(e))}else if(n.type===ge.VECTOR4){const i=n.deltaValue;n.material[n.propertyName].add(Cs.copy(i).multiplyScalar(e))}else if(n.type===ge.COLOR){const i=n.deltaValue;n.material[n.propertyName].add(Ds.copy(i).multiplyScalar(e))}typeof n.material.shouldApplyUniforms=="boolean"&&(n.material.shouldApplyUniforms=!0)}})}clearAppliedWeight(){this._binds.forEach(e=>{e.meshes.forEach(n=>{n.morphTargetInfluences&&(n.morphTargetInfluences[e.morphTargetIndex]=0)})}),this._materialValues.forEach(e=>{if(e.material[e.propertyName]!==void 0){if(e.type===ge.NUMBER){const n=e.defaultValue;e.material[e.propertyName]=n}else if(e.type===ge.VECTOR2){const n=e.defaultValue;e.material[e.propertyName].copy(n)}else if(e.type===ge.VECTOR3){const n=e.defaultValue;e.material[e.propertyName].copy(n)}else if(e.type===ge.VECTOR4){const n=e.defaultValue;e.material[e.propertyName].copy(n)}else if(e.type===ge.COLOR){const n=e.defaultValue;e.material[e.propertyName].copy(n)}typeof e.material.shouldApplyUniforms=="boolean"&&(e.material.shouldApplyUniforms=!0)}})}}var ae;function dr(a,e,n){const i=a.parser.json.nodes[e].mesh;if(i==null)return null;const r=a.parser.json.meshes[i].primitives.length,s=[];return n.traverse(l=>{s.length<r&&l.isMesh&&s.push(l)}),s}function fr(a){return ue(this,void 0,void 0,function*(){const e=yield a.parser.getDependencies("node"),n=new Map;return e.forEach((i,r)=>{const s=dr(a,r,i);s!=null&&n.set(r,s)}),n})}function Us(a){return a[0]!=="_"?(console.warn(`renameMaterialProperty: Given property name "${a}" might be invalid`),a):(a=a.substring(1),/[A-Z]/.test(a[0])?a[0].toLowerCase()+a.substring(1):(console.warn(`renameMaterialProperty: Given property name "${a}" might be invalid`),a))}(function(a){var e,n,i,r,s,l;(e=a.BlendShapePresetName||(a.BlendShapePresetName={})).A="a",e.Angry="angry",e.Blink="blink",e.BlinkL="blink_l",e.BlinkR="blink_r",e.E="e",e.Fun="fun",e.I="i",e.Joy="joy",e.Lookdown="lookdown",e.Lookleft="lookleft",e.Lookright="lookright",e.Lookup="lookup",e.Neutral="neutral",e.O="o",e.Sorrow="sorrow",e.U="u",e.Unknown="unknown",(n=a.FirstPersonLookAtTypeName||(a.FirstPersonLookAtTypeName={})).BlendShape="BlendShape",n.Bone="Bone",(i=a.HumanoidBoneName||(a.HumanoidBoneName={})).Chest="chest",i.Head="head",i.Hips="hips",i.Jaw="jaw",i.LeftEye="leftEye",i.LeftFoot="leftFoot",i.LeftHand="leftHand",i.LeftIndexDistal="leftIndexDistal",i.LeftIndexIntermediate="leftIndexIntermediate",i.LeftIndexProximal="leftIndexProximal",i.LeftLittleDistal="leftLittleDistal",i.LeftLittleIntermediate="leftLittleIntermediate",i.LeftLittleProximal="leftLittleProximal",i.LeftLowerArm="leftLowerArm",i.LeftLowerLeg="leftLowerLeg",i.LeftMiddleDistal="leftMiddleDistal",i.LeftMiddleIntermediate="leftMiddleIntermediate",i.LeftMiddleProximal="leftMiddleProximal",i.LeftRingDistal="leftRingDistal",i.LeftRingIntermediate="leftRingIntermediate",i.LeftRingProximal="leftRingProximal",i.LeftShoulder="leftShoulder",i.LeftThumbDistal="leftThumbDistal",i.LeftThumbIntermediate="leftThumbIntermediate",i.LeftThumbProximal="leftThumbProximal",i.LeftToes="leftToes",i.LeftUpperArm="leftUpperArm",i.LeftUpperLeg="leftUpperLeg",i.Neck="neck",i.RightEye="rightEye",i.RightFoot="rightFoot",i.RightHand="rightHand",i.RightIndexDistal="rightIndexDistal",i.RightIndexIntermediate="rightIndexIntermediate",i.RightIndexProximal="rightIndexProximal",i.RightLittleDistal="rightLittleDistal",i.RightLittleIntermediate="rightLittleIntermediate",i.RightLittleProximal="rightLittleProximal",i.RightLowerArm="rightLowerArm",i.RightLowerLeg="rightLowerLeg",i.RightMiddleDistal="rightMiddleDistal",i.RightMiddleIntermediate="rightMiddleIntermediate",i.RightMiddleProximal="rightMiddleProximal",i.RightRingDistal="rightRingDistal",i.RightRingIntermediate="rightRingIntermediate",i.RightRingProximal="rightRingProximal",i.RightShoulder="rightShoulder",i.RightThumbDistal="rightThumbDistal",i.RightThumbIntermediate="rightThumbIntermediate",i.RightThumbProximal="rightThumbProximal",i.RightToes="rightToes",i.RightUpperArm="rightUpperArm",i.RightUpperLeg="rightUpperLeg",i.Spine="spine",i.UpperChest="upperChest",(r=a.MetaAllowedUserName||(a.MetaAllowedUserName={})).Everyone="Everyone",r.ExplicitlyLicensedPerson="ExplicitlyLicensedPerson",r.OnlyAuthor="OnlyAuthor",(s=a.MetaUssageName||(a.MetaUssageName={})).Allow="Allow",s.Disallow="Disallow",(l=a.MetaLicenseName||(a.MetaLicenseName={})).Cc0="CC0",l.CcBy="CC_BY",l.CcByNc="CC_BY_NC",l.CcByNcNd="CC_BY_NC_ND",l.CcByNcSa="CC_BY_NC_SA",l.CcByNd="CC_BY_ND",l.CcBySa="CC_BY_SA",l.Other="Other",l.RedistributionProhibited="Redistribution_Prohibited"})(ae||(ae={}));const Hs=new q,Fs=new q;function Yt(a,e){return a.matrixWorld.decompose(Hs,e,Fs),e}new Ce;class zs{constructor(){this._blendShapeGroups={},this._blendShapePresetMap={},this._unknownGroupNames=[]}get expressions(){return Object.keys(this._blendShapeGroups)}get blendShapePresetMap(){return this._blendShapePresetMap}get unknownGroupNames(){return this._unknownGroupNames}getBlendShapeGroup(e){const n=this._blendShapePresetMap[e],i=n?this._blendShapeGroups[n]:this._blendShapeGroups[e];if(i)return i;console.warn(`no blend shape found by ${e}`)}registerBlendShapeGroup(e,n,i){this._blendShapeGroups[e]=i,n?this._blendShapePresetMap[n]=e:this._unknownGroupNames.push(e)}getValue(e){var n;const i=this.getBlendShapeGroup(e);return(n=i==null?void 0:i.weight)!==null&&n!==void 0?n:null}setValue(e,n){const i=this.getBlendShapeGroup(e);var r;i&&(i.weight=(r=n,Math.max(Math.min(r,1),0)))}getBlendShapeTrackName(e){const n=this.getBlendShapeGroup(e);return n?`${n.name}.weight`:null}update(){Object.keys(this._blendShapeGroups).forEach(e=>{this._blendShapeGroups[e].clearAppliedWeight()}),Object.keys(this._blendShapeGroups).forEach(e=>{this._blendShapeGroups[e].applyWeight()})}}class Bs{import(e){var n;return ue(this,void 0,void 0,function*(){const i=(n=e.parser.json.extensions)===null||n===void 0?void 0:n.VRM;if(!i)return null;const r=i.blendShapeMaster;if(!r)return null;const s=new zs,l=r.blendShapeGroups;if(!l)return s;const c={};return yield Promise.all(l.map(h=>ue(this,void 0,void 0,function*(){const f=h.name;if(f===void 0)return void console.warn("VRMBlendShapeImporter: One of blendShapeGroups has no name");let m;h.presetName&&h.presetName!==ae.BlendShapePresetName.Unknown&&!c[h.presetName]&&(m=h.presetName,c[h.presetName]=f);const p=new Ns(f);e.scene.add(p),p.isBinary=h.isBinary||!1,h.binds&&h.binds.forEach(x=>ue(this,void 0,void 0,function*(){if(x.mesh===void 0||x.index===void 0)return;const y=[];e.parser.json.nodes.forEach((M,S)=>{M.mesh===x.mesh&&y.push(S)});const E=x.index;yield Promise.all(y.map(M=>ue(this,void 0,void 0,function*(){var S;const R=yield function(O,k){return ue(this,void 0,void 0,function*(){const $=yield O.parser.getDependency("node",k);return dr(O,k,$)})}(e,M);R.every(O=>Array.isArray(O.morphTargetInfluences)&&E<O.morphTargetInfluences.length)?p.addBind({meshes:R,morphTargetIndex:E,weight:(S=x.weight)!==null&&S!==void 0?S:100}):console.warn(`VRMBlendShapeImporter: ${h.name} attempts to index ${E}th morph but not found.`)})))}));const L=h.materialValues;L&&L.forEach(x=>{if(x.materialName===void 0||x.propertyName===void 0||x.targetValue===void 0)return;const y=[];e.scene.traverse(E=>{if(E.material){const M=E.material;Array.isArray(M)?y.push(...M.filter(S=>S.name===x.materialName&&y.indexOf(S)===-1)):M.name===x.materialName&&y.indexOf(M)===-1&&y.push(M)}}),y.forEach(E=>{p.addMaterialValue({material:E,propertyName:Us(x.propertyName),targetValue:x.targetValue})})}),s.registerBlendShapeGroup(f,m,p)}))),s})}}const ks=Object.freeze(new q(0,0,-1)),Gs=new Ce;var ze;(function(a){a[a.Auto=0]="Auto",a[a.Both=1]="Both",a[a.ThirdPersonOnly=2]="ThirdPersonOnly",a[a.FirstPersonOnly=3]="FirstPersonOnly"})(ze||(ze={}));class Mn{constructor(e,n){this.firstPersonFlag=Mn._parseFirstPersonFlag(e),this.primitives=n}static _parseFirstPersonFlag(e){switch(e){case"Both":return ze.Both;case"ThirdPersonOnly":return ze.ThirdPersonOnly;case"FirstPersonOnly":return ze.FirstPersonOnly;default:return ze.Auto}}}class Ke{constructor(e,n,i){this._meshAnnotations=[],this._firstPersonOnlyLayer=Ke._DEFAULT_FIRSTPERSON_ONLY_LAYER,this._thirdPersonOnlyLayer=Ke._DEFAULT_THIRDPERSON_ONLY_LAYER,this._initialized=!1,this._firstPersonBone=e,this._firstPersonBoneOffset=n,this._meshAnnotations=i}get firstPersonBone(){return this._firstPersonBone}get meshAnnotations(){return this._meshAnnotations}getFirstPersonWorldDirection(e){return e.copy(ks).applyQuaternion(Yt(this._firstPersonBone,Gs))}get firstPersonOnlyLayer(){return this._firstPersonOnlyLayer}get thirdPersonOnlyLayer(){return this._thirdPersonOnlyLayer}getFirstPersonBoneOffset(e){return e.copy(this._firstPersonBoneOffset)}getFirstPersonWorldPosition(e){const n=this._firstPersonBoneOffset,i=new xe(n.x,n.y,n.z,1);return i.applyMatrix4(this._firstPersonBone.matrixWorld),e.set(i.x,i.y,i.z)}setup({firstPersonOnlyLayer:e=Ke._DEFAULT_FIRSTPERSON_ONLY_LAYER,thirdPersonOnlyLayer:n=Ke._DEFAULT_THIRDPERSON_ONLY_LAYER}={}){this._initialized||(this._initialized=!0,this._firstPersonOnlyLayer=e,this._thirdPersonOnlyLayer=n,this._meshAnnotations.forEach(i=>{i.firstPersonFlag===ze.FirstPersonOnly?i.primitives.forEach(r=>{r.layers.set(this._firstPersonOnlyLayer)}):i.firstPersonFlag===ze.ThirdPersonOnly?i.primitives.forEach(r=>{r.layers.set(this._thirdPersonOnlyLayer)}):i.firstPersonFlag===ze.Auto&&this._createHeadlessModel(i.primitives)}))}_excludeTriangles(e,n,i,r){let s=0;if(n!=null&&n.length>0)for(let l=0;l<e.length;l+=3){const c=e[l],h=e[l+1],f=e[l+2],m=n[c],p=i[c];if(m[0]>0&&r.includes(p[0])||m[1]>0&&r.includes(p[1])||m[2]>0&&r.includes(p[2])||m[3]>0&&r.includes(p[3]))continue;const L=n[h],x=i[h];if(L[0]>0&&r.includes(x[0])||L[1]>0&&r.includes(x[1])||L[2]>0&&r.includes(x[2])||L[3]>0&&r.includes(x[3]))continue;const y=n[f],E=i[f];y[0]>0&&r.includes(E[0])||y[1]>0&&r.includes(E[1])||y[2]>0&&r.includes(E[2])||y[3]>0&&r.includes(E[3])||(e[s++]=c,e[s++]=h,e[s++]=f)}return s}_createErasedMesh(e,n){const i=new Ki(e.geometry.clone(),e.material);i.name=`${e.name}(erase)`,i.frustumCulled=e.frustumCulled,i.layers.set(this._firstPersonOnlyLayer);const r=i.geometry,s=r.getAttribute("skinIndex").array,l=[];for(let x=0;x<s.length;x+=4)l.push([s[x],s[x+1],s[x+2],s[x+3]]);const c=r.getAttribute("skinWeight").array,h=[];for(let x=0;x<c.length;x+=4)h.push([c[x],c[x+1],c[x+2],c[x+3]]);const f=r.getIndex();if(!f)throw new Error("The geometry doesn't have an index buffer");const m=Array.from(f.array),p=this._excludeTriangles(m,h,l,n),L=[];for(let x=0;x<p;x++)L[x]=m[x];return r.setIndex(L),e.onBeforeRender&&(i.onBeforeRender=e.onBeforeRender),i.bind(new wn(e.skeleton.bones,e.skeleton.boneInverses),new De),i}_createHeadlessModelForSkinnedMesh(e,n){const i=[];if(n.skeleton.bones.forEach((s,l)=>{this._isEraseTarget(s)&&i.push(l)}),!i.length)return n.layers.enable(this._thirdPersonOnlyLayer),void n.layers.enable(this._firstPersonOnlyLayer);n.layers.set(this._thirdPersonOnlyLayer);const r=this._createErasedMesh(n,i);e.add(r)}_createHeadlessModel(e){e.forEach(n=>{if(n.type==="SkinnedMesh"){const i=n;this._createHeadlessModelForSkinnedMesh(i.parent,i)}else this._isEraseTarget(n)&&n.layers.set(this._thirdPersonOnlyLayer)})}_isEraseTarget(e){return e===this._firstPersonBone||!!e.parent&&this._isEraseTarget(e.parent)}}Ke._DEFAULT_FIRSTPERSON_ONLY_LAYER=9,Ke._DEFAULT_THIRDPERSON_ONLY_LAYER=10;class js{import(e,n){var i;return ue(this,void 0,void 0,function*(){const r=(i=e.parser.json.extensions)===null||i===void 0?void 0:i.VRM;if(!r)return null;const s=r.firstPerson;if(!s)return null;const l=s.firstPersonBone;let c;if(c=l===void 0||l===-1?n.getBoneNode(ae.HumanoidBoneName.Head):yield e.parser.getDependency("node",l),!c)return console.warn("VRMFirstPersonImporter: Could not find firstPersonBone of the VRM"),null;const h=s.firstPersonBoneOffset?new q(s.firstPersonBoneOffset.x,s.firstPersonBoneOffset.y,-s.firstPersonBoneOffset.z):new q(0,.06,0),f=[],m=yield fr(e);return Array.from(m.entries()).forEach(([p,L])=>{const x=e.parser.json.nodes[p],y=s.meshAnnotations?s.meshAnnotations.find(E=>E.mesh===x.mesh):void 0;f.push(new Mn(y==null?void 0:y.firstPersonFlag,L))}),new Ke(c,h,f)})}}class Ws{constructor(e,n){this.node=e,this.humanLimit=n}}function pr(a){return a.invert?a.invert():a.inverse(),a}const Rt=new q,Mt=new Ce;class Vs{constructor(e,n){this.restPose={},this.humanBones=this._createHumanBones(e),this.humanDescription=n,this.restPose=this.getPose()}getPose(){const e={};return Object.keys(this.humanBones).forEach(n=>{const i=this.getBoneNode(n);if(!i||e[n])return;Rt.set(0,0,0),Mt.identity();const r=this.restPose[n];r!=null&&r.position&&Rt.fromArray(r.position).negate(),r!=null&&r.rotation&&pr(Mt.fromArray(r.rotation)),Rt.add(i.position),Mt.premultiply(i.quaternion),e[n]={position:Rt.toArray(),rotation:Mt.toArray()}},{}),e}setPose(e){Object.keys(e).forEach(n=>{const i=e[n],r=this.getBoneNode(n);if(!r)return;const s=this.restPose[n];s&&(i.position&&(r.position.fromArray(i.position),s.position&&r.position.add(Rt.fromArray(s.position))),i.rotation&&(r.quaternion.fromArray(i.rotation),s.rotation&&r.quaternion.multiply(Mt.fromArray(s.rotation))))})}resetPose(){Object.entries(this.restPose).forEach(([e,n])=>{const i=this.getBoneNode(e);i&&(n!=null&&n.position&&i.position.fromArray(n.position),n!=null&&n.rotation&&i.quaternion.fromArray(n.rotation))})}getBone(e){var n;return(n=this.humanBones[e][0])!==null&&n!==void 0?n:void 0}getBones(e){var n;return(n=this.humanBones[e])!==null&&n!==void 0?n:[]}getBoneNode(e){var n,i;return(i=(n=this.humanBones[e][0])===null||n===void 0?void 0:n.node)!==null&&i!==void 0?i:null}getBoneNodes(e){var n,i;return(i=(n=this.humanBones[e])===null||n===void 0?void 0:n.map(r=>r.node))!==null&&i!==void 0?i:[]}_createHumanBones(e){const n=Object.values(ae.HumanoidBoneName).reduce((i,r)=>(i[r]=[],i),{});return e.forEach(i=>{n[i.name].push(i.bone)}),n}}class Xs{import(e){var n;return ue(this,void 0,void 0,function*(){const i=(n=e.parser.json.extensions)===null||n===void 0?void 0:n.VRM;if(!i)return null;const r=i.humanoid;if(!r)return null;const s=[];r.humanBones&&(yield Promise.all(r.humanBones.map(c=>ue(this,void 0,void 0,function*(){if(!c.bone||c.node==null)return;const h=yield e.parser.getDependency("node",c.node);s.push({name:c.bone,bone:new Ws(h,{axisLength:c.axisLength,center:c.center&&new q(c.center.x,c.center.y,c.center.z),max:c.max&&new q(c.max.x,c.max.y,c.max.z),min:c.min&&new q(c.min.x,c.min.y,c.min.z),useDefaultValues:c.useDefaultValues})})}))));const l={armStretch:r.armStretch,legStretch:r.legStretch,upperArmTwist:r.upperArmTwist,lowerArmTwist:r.lowerArmTwist,upperLegTwist:r.upperLegTwist,lowerLegTwist:r.lowerLegTwist,feetSpacing:r.feetSpacing,hasTranslationDoF:r.hasTranslationDoF};return new Vs(s,l)})}}class Ui{constructor(e,n,i){this.curve=[0,0,0,1,1,1,1,0],this.curveXRangeDegree=90,this.curveYRangeDegree=10,e!==void 0&&(this.curveXRangeDegree=e),n!==void 0&&(this.curveYRangeDegree=n),i!==void 0&&(this.curve=i)}map(e){const n=Math.min(Math.max(e,0),this.curveXRangeDegree)/this.curveXRangeDegree;return this.curveYRangeDegree*((i,r)=>{if(i.length<8)throw new Error("evaluateCurve: Invalid curve detected! (Array length must be 8 at least)");if(i.length%4!=0)throw new Error("evaluateCurve: Invalid curve detected! (Array length must be multiples of 4");let s;for(s=0;;s++){if(i.length<=4*s)return i[4*s-3];if(r<=i[4*s])break}const l=s-1;if(l<0)return i[4*l+5];const c=i[4*l],h=(r-c)/(i[4*s]-c);return((f,m,p,L,x)=>{const y=x*x*x,E=x*x;return f+(m-f)*(-2*y+3*E)+p*(y-2*E+x)+L*(y-E)})(i[4*l+1],i[4*s+1],i[4*l+3],i[4*s+2],h)})(this.curve,n)}}class gr{}class Ys extends gr{constructor(e,n,i,r){super(),this.type=ae.FirstPersonLookAtTypeName.BlendShape,this._curveHorizontal=n,this._curveVerticalDown=i,this._curveVerticalUp=r,this._blendShapeProxy=e}name(){return ae.FirstPersonLookAtTypeName.BlendShape}lookAt(e){const n=e.x,i=e.y;n<0?(this._blendShapeProxy.setValue(ae.BlendShapePresetName.Lookup,0),this._blendShapeProxy.setValue(ae.BlendShapePresetName.Lookdown,this._curveVerticalDown.map(-n))):(this._blendShapeProxy.setValue(ae.BlendShapePresetName.Lookdown,0),this._blendShapeProxy.setValue(ae.BlendShapePresetName.Lookup,this._curveVerticalUp.map(n))),i<0?(this._blendShapeProxy.setValue(ae.BlendShapePresetName.Lookleft,0),this._blendShapeProxy.setValue(ae.BlendShapePresetName.Lookright,this._curveHorizontal.map(-i))):(this._blendShapeProxy.setValue(ae.BlendShapePresetName.Lookright,0),this._blendShapeProxy.setValue(ae.BlendShapePresetName.Lookleft,this._curveHorizontal.map(i)))}}const Ks=Object.freeze(new q(0,0,-1)),qs=new q,Zs=new q,$s=new q,Hi=new Ce;class Ct{constructor(e,n){this.autoUpdate=!0,this._euler=new At(0,0,0,Ct.EULER_ORDER),this.firstPerson=e,this.applyer=n}getLookAtWorldDirection(e){const n=Yt(this.firstPerson.firstPersonBone,Hi);return e.copy(Ks).applyEuler(this._euler).applyQuaternion(n)}lookAt(e){this._calcEuler(this._euler,e),this.applyer&&this.applyer.lookAt(this._euler)}update(e){this.target&&this.autoUpdate&&(this.lookAt(this.target.getWorldPosition(qs)),this.applyer&&this.applyer.lookAt(this._euler))}_calcEuler(e,n){const i=this.firstPerson.getFirstPersonWorldPosition(Zs),r=$s.copy(n).sub(i).normalize();return r.applyQuaternion(pr(Yt(this.firstPerson.firstPersonBone,Hi))),e.x=Math.atan2(r.y,Math.sqrt(r.x*r.x+r.z*r.z)),e.y=Math.atan2(-r.x,-r.z),e}}Ct.EULER_ORDER="YXZ";const dt=new At(0,0,0,Ct.EULER_ORDER);class Js extends gr{constructor(e,n,i,r,s){super(),this.type=ae.FirstPersonLookAtTypeName.Bone,this._curveHorizontalInner=n,this._curveHorizontalOuter=i,this._curveVerticalDown=r,this._curveVerticalUp=s,this._leftEye=e.getBoneNode(ae.HumanoidBoneName.LeftEye),this._rightEye=e.getBoneNode(ae.HumanoidBoneName.RightEye)}lookAt(e){const n=e.x,i=e.y;this._leftEye&&(dt.x=n<0?-this._curveVerticalDown.map(-n):this._curveVerticalUp.map(n),dt.y=i<0?-this._curveHorizontalInner.map(-i):this._curveHorizontalOuter.map(i),this._leftEye.quaternion.setFromEuler(dt)),this._rightEye&&(dt.x=n<0?-this._curveVerticalDown.map(-n):this._curveVerticalUp.map(n),dt.y=i<0?-this._curveHorizontalOuter.map(-i):this._curveHorizontalInner.map(i),this._rightEye.quaternion.setFromEuler(dt))}}const pn=Math.PI/180;class Qs{import(e,n,i,r){var s;const l=(s=e.parser.json.extensions)===null||s===void 0?void 0:s.VRM;if(!l)return null;const c=l.firstPerson;if(!c)return null;const h=this._importApplyer(c,i,r);return new Ct(n,h||void 0)}_importApplyer(e,n,i){const r=e.lookAtHorizontalInner,s=e.lookAtHorizontalOuter,l=e.lookAtVerticalDown,c=e.lookAtVerticalUp;switch(e.lookAtTypeName){case ae.FirstPersonLookAtTypeName.Bone:return r===void 0||s===void 0||l===void 0||c===void 0?null:new Js(i,this._importCurveMapperBone(r),this._importCurveMapperBone(s),this._importCurveMapperBone(l),this._importCurveMapperBone(c));case ae.FirstPersonLookAtTypeName.BlendShape:return s===void 0||l===void 0||c===void 0?null:new Ys(n,this._importCurveMapperBlendShape(s),this._importCurveMapperBlendShape(l),this._importCurveMapperBlendShape(c));default:return null}}_importCurveMapperBone(e){return new Ui(typeof e.xRange=="number"?pn*e.xRange:void 0,typeof e.yRange=="number"?pn*e.yRange:void 0,e.curve)}_importCurveMapperBlendShape(e){return new Ui(typeof e.xRange=="number"?pn*e.xRange:void 0,e.yRange,e.curve)}}var Fi=`// #define PHONG

#ifdef BLENDMODE_CUTOUT
  uniform float cutoff;
#endif

uniform vec3 color;
uniform float colorAlpha;
uniform vec3 shadeColor;
#ifdef USE_SHADETEXTURE
  uniform sampler2D shadeTexture;
#endif

uniform float receiveShadowRate;
#ifdef USE_RECEIVESHADOWTEXTURE
  uniform sampler2D receiveShadowTexture;
#endif

uniform float shadingGradeRate;
#ifdef USE_SHADINGGRADETEXTURE
  uniform sampler2D shadingGradeTexture;
#endif

uniform float shadeShift;
uniform float shadeToony;
uniform float lightColorAttenuation;
uniform float indirectLightIntensity;

#ifdef USE_RIMTEXTURE
  uniform sampler2D rimTexture;
#endif
uniform vec3 rimColor;
uniform float rimLightingMix;
uniform float rimFresnelPower;
uniform float rimLift;

#ifdef USE_SPHEREADD
  uniform sampler2D sphereAdd;
#endif

uniform vec3 emissionColor;

uniform vec3 outlineColor;
uniform float outlineLightingMix;

#ifdef USE_UVANIMMASKTEXTURE
  uniform sampler2D uvAnimMaskTexture;
#endif

uniform float uvAnimOffsetX;
uniform float uvAnimOffsetY;
uniform float uvAnimTheta;

#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>

// #include <uv_pars_fragment>
#if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
  varying vec2 vUv;
#endif

#include <uv2_pars_fragment>
#include <map_pars_fragment>
// #include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
// #include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
// #include <envmap_common_pars_fragment>
// #include <envmap_pars_fragment>
// #include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>

// #include <bsdfs>
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
    return RECIPROCAL_PI * diffuseColor;
}

#include <lights_pars_begin>

// #include <lights_phong_pars_fragment>
varying vec3 vViewPosition;

#ifndef FLAT_SHADED
  varying vec3 vNormal;
#endif

struct MToonMaterial {
  vec3 diffuseColor;
  vec3 shadeColor;
  float shadingGrade;
  float receiveShadow;
};

#define Material_LightProbeLOD( material ) (0)

#include <shadowmap_pars_fragment>
// #include <bumpmap_pars_fragment>

// #include <normalmap_pars_fragment>
#ifdef USE_NORMALMAP

  uniform sampler2D normalMap;
  uniform vec2 normalScale;

#endif

#ifdef OBJECTSPACE_NORMALMAP

  uniform mat3 normalMatrix;

#endif

#if ! defined ( USE_TANGENT ) && defined ( TANGENTSPACE_NORMALMAP )

  // Per-Pixel Tangent Space Normal Mapping
  // http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html

  // three-vrm specific change: it requires \`uv\` as an input in order to support uv scrolls

  // Temporary compat against shader change @ Three.js r126
  // See: #21205, #21307, #21299
  #if THREE_VRM_THREE_REVISION >= 126

    vec3 perturbNormal2Arb( vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {

      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
      vec2 st0 = dFdx( uv.st );
      vec2 st1 = dFdy( uv.st );

      vec3 N = normalize( surf_norm );

      vec3 q1perp = cross( q1, N );
      vec3 q0perp = cross( N, q0 );

      vec3 T = q1perp * st0.x + q0perp * st1.x;
      vec3 B = q1perp * st0.y + q0perp * st1.y;

      // three-vrm specific change: Workaround for the issue that happens when delta of uv = 0.0
      // TODO: Is this still required? Or shall I make a PR about it?
      if ( length( T ) == 0.0 || length( B ) == 0.0 ) {
        return surf_norm;
      }

      float det = max( dot( T, T ), dot( B, B ) );
      float scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );

      return normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );

    }

  #else

    vec3 perturbNormal2Arb( vec2 uv, vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {

      // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

      vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
      vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
      vec2 st0 = dFdx( uv.st );
      vec2 st1 = dFdy( uv.st );

      float scale = sign( st1.t * st0.s - st0.t * st1.s ); // we do not care about the magnitude

      vec3 S = ( q0 * st1.t - q1 * st0.t ) * scale;
      vec3 T = ( - q0 * st1.s + q1 * st0.s ) * scale;

      // three-vrm specific change: Workaround for the issue that happens when delta of uv = 0.0
      // TODO: Is this still required? Or shall I make a PR about it?

      if ( length( S ) == 0.0 || length( T ) == 0.0 ) {
        return surf_norm;
      }

      S = normalize( S );
      T = normalize( T );
      vec3 N = normalize( surf_norm );

      #ifdef DOUBLE_SIDED

        // Workaround for Adreno GPUs gl_FrontFacing bug. See #15850 and #10331

        bool frontFacing = dot( cross( S, T ), N ) > 0.0;

        mapN.xy *= ( float( frontFacing ) * 2.0 - 1.0 );

      #else

        mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );

      #endif

      mat3 tsn = mat3( S, T, N );
      return normalize( tsn * mapN );

    }

  #endif

#endif

// #include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

// == lighting stuff ===========================================================
float getLightIntensity(
  const in IncidentLight directLight,
  const in GeometricContext geometry,
  const in float shadow,
  const in float shadingGrade
) {
  float lightIntensity = dot( geometry.normal, directLight.direction );
  lightIntensity = 0.5 + 0.5 * lightIntensity;
  lightIntensity = lightIntensity * shadow;
  lightIntensity = lightIntensity * shadingGrade;
  lightIntensity = lightIntensity * 2.0 - 1.0;
  return shadeToony == 1.0
    ? step( shadeShift, lightIntensity )
    : smoothstep( shadeShift, shadeShift + ( 1.0 - shadeToony ), lightIntensity );
}

vec3 getLighting( const in vec3 lightColor ) {
  vec3 lighting = lightColor;
  lighting = mix(
    lighting,
    vec3( max( 0.001, max( lighting.x, max( lighting.y, lighting.z ) ) ) ),
    lightColorAttenuation
  );

  #if THREE_VRM_THREE_REVISION < 132
    #ifndef PHYSICALLY_CORRECT_LIGHTS
      lighting *= PI;
    #endif
  #endif

  return lighting;
}

vec3 getDiffuse(
  const in MToonMaterial material,
  const in float lightIntensity,
  const in vec3 lighting
) {
  #ifdef DEBUG_LITSHADERATE
    return vec3( BRDF_Lambert( lightIntensity * lighting ) );
  #endif

  return lighting * BRDF_Lambert( mix( material.shadeColor, material.diffuseColor, lightIntensity ) );
}

// == post correction ==========================================================
void postCorrection() {
  #include <tonemapping_fragment>
  #include <encodings_fragment>
  #include <fog_fragment>
  #include <premultiplied_alpha_fragment>
  #include <dithering_fragment>
}

// == main procedure ===========================================================
void main() {
  #include <clipping_planes_fragment>

  vec2 uv = vec2(0.5, 0.5);

  #if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
    uv = vUv;

    float uvAnimMask = 1.0;
    #ifdef USE_UVANIMMASKTEXTURE
      uvAnimMask = texture2D( uvAnimMaskTexture, uv ).x;
    #endif

    uv = uv + vec2( uvAnimOffsetX, uvAnimOffsetY ) * uvAnimMask;
    float uvRotCos = cos( uvAnimTheta * uvAnimMask );
    float uvRotSin = sin( uvAnimTheta * uvAnimMask );
    uv = mat2( uvRotCos, uvRotSin, -uvRotSin, uvRotCos ) * ( uv - 0.5 ) + 0.5;
  #endif

  #ifdef DEBUG_UV
    gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
    #if ( defined( MTOON_USE_UV ) && !defined( MTOON_UVS_VERTEX_ONLY ) )
      gl_FragColor = vec4( uv, 0.0, 1.0 );
    #endif
    return;
  #endif

  vec4 diffuseColor = vec4( color, colorAlpha );
  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
  vec3 totalEmissiveRadiance = emissionColor;

  #include <logdepthbuf_fragment>

  // #include <map_fragment>
  #ifdef USE_MAP
    #if THREE_VRM_THREE_REVISION >= 137
      vec4 sampledDiffuseColor = texture2D( map, uv );
      #ifdef DECODE_VIDEO_TEXTURE
        sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
      #endif
      diffuseColor *= sampledDiffuseColor;
    #else
      // COMPAT: pre-r137
      diffuseColor *= mapTexelToLinear( texture2D( map, uv ) );
    #endif
  #endif

  #include <color_fragment>
  // #include <alphamap_fragment>

  // -- MToon: alpha -----------------------------------------------------------
  // #include <alphatest_fragment>
  #ifdef BLENDMODE_CUTOUT
    if ( diffuseColor.a <= cutoff ) { discard; }
    diffuseColor.a = 1.0;
  #endif

  #ifdef BLENDMODE_OPAQUE
    diffuseColor.a = 1.0;
  #endif

  #if defined( OUTLINE ) && defined( OUTLINE_COLOR_FIXED ) // omitting DebugMode
    gl_FragColor = vec4( outlineColor, diffuseColor.a );
    postCorrection();
    return;
  #endif

  // #include <specularmap_fragment>
  #include <normal_fragment_begin>

  #ifdef OUTLINE
    normal *= -1.0;
  #endif

  // #include <normal_fragment_maps>

  #ifdef OBJECTSPACE_NORMALMAP

    normal = texture2D( normalMap, uv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals

    #ifdef FLIP_SIDED

      normal = - normal;

    #endif

    #ifdef DOUBLE_SIDED

      // Temporary compat against shader change @ Three.js r126
      // See: #21205, #21307, #21299
      #if THREE_VRM_THREE_REVISION >= 126

        normal = normal * faceDirection;

      #else

        normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );

      #endif

    #endif

    normal = normalize( normalMatrix * normal );

  #elif defined( TANGENTSPACE_NORMALMAP )

    vec3 mapN = texture2D( normalMap, uv ).xyz * 2.0 - 1.0;
    mapN.xy *= normalScale;

    #ifdef USE_TANGENT

      normal = normalize( vTBN * mapN );

    #else

      // Temporary compat against shader change @ Three.js r126
      // See: #21205, #21307, #21299
      #if THREE_VRM_THREE_REVISION >= 126

        normal = perturbNormal2Arb( uv, -vViewPosition, normal, mapN, faceDirection );

      #else

        normal = perturbNormal2Arb( uv, -vViewPosition, normal, mapN );

      #endif

    #endif

  #endif

  // #include <emissivemap_fragment>
  #ifdef USE_EMISSIVEMAP
    #if THREE_VRM_THREE_REVISION >= 137
      totalEmissiveRadiance *= texture2D( emissiveMap, uv ).rgb;
    #else
      // COMPAT: pre-r137
      totalEmissiveRadiance *= emissiveMapTexelToLinear( texture2D( emissiveMap, uv ) ).rgb;
    #endif
  #endif

  #ifdef DEBUG_NORMAL
    gl_FragColor = vec4( 0.5 + 0.5 * normal, 1.0 );
    return;
  #endif

  // -- MToon: lighting --------------------------------------------------------
  // accumulation
  // #include <lights_phong_fragment>
  MToonMaterial material;

  material.diffuseColor = diffuseColor.rgb;

  material.shadeColor = shadeColor;
  #ifdef USE_SHADETEXTURE
    #if THREE_VRM_THREE_REVISION >= 137
      material.shadeColor *= texture2D( shadeTexture, uv ).rgb;
    #else
      // COMPAT: pre-r137
      material.shadeColor *= shadeTextureTexelToLinear( texture2D( shadeTexture, uv ) ).rgb;
    #endif
  #endif

  material.shadingGrade = 1.0;
  #ifdef USE_SHADINGGRADETEXTURE
    material.shadingGrade = 1.0 - shadingGradeRate * ( 1.0 - texture2D( shadingGradeTexture, uv ).r );
  #endif

  material.receiveShadow = receiveShadowRate;
  #ifdef USE_RECEIVESHADOWTEXTURE
    material.receiveShadow *= texture2D( receiveShadowTexture, uv ).a;
  #endif

  // #include <lights_fragment_begin>
  GeometricContext geometry;

  geometry.position = - vViewPosition;
  geometry.normal = normal;
  geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );

  IncidentLight directLight;
  vec3 lightingSum = vec3( 0.0 );

  // since these variables will be used in unrolled loop, we have to define in prior
  float atten, shadow, lightIntensity;
  vec3 lighting;

  #if ( NUM_POINT_LIGHTS > 0 )
    PointLight pointLight;

    #if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
    PointLightShadow pointLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
      pointLight = pointLights[ i ];

      #if THREE_VRM_THREE_REVISION >= 132
        getPointLightInfo( pointLight, geometry, directLight );
      #else
        getPointDirectLightIrradiance( pointLight, geometry, directLight );
      #endif

      atten = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
      pointLightShadow = pointLightShadows[ i ];
      atten = all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
      #endif

      shadow = 1.0 - material.receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );
      lightIntensity = getLightIntensity( directLight, geometry, shadow, material.shadingGrade );
      lighting = getLighting( directLight.color );
      reflectedLight.directDiffuse += getDiffuse( material, lightIntensity, lighting );
      lightingSum += lighting;
    }
    #pragma unroll_loop_end
  #endif

  #if ( NUM_SPOT_LIGHTS > 0 )
    SpotLight spotLight;

    #if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
    SpotLightShadow spotLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
      spotLight = spotLights[ i ];

      #if THREE_VRM_THREE_REVISION >= 132
        getSpotLightInfo( spotLight, geometry, directLight );
      #else
        getSpotDirectLightIrradiance( spotLight, geometry, directLight );
      #endif

      atten = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
      spotLightShadow = spotLightShadows[ i ];
      atten = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
      #endif

      shadow = 1.0 - material.receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );
      lightIntensity = getLightIntensity( directLight, geometry, shadow, material.shadingGrade );
      lighting = getLighting( directLight.color );
      reflectedLight.directDiffuse += getDiffuse( material, lightIntensity, lighting );
      lightingSum += lighting;
    }
    #pragma unroll_loop_end
  #endif

  #if ( NUM_DIR_LIGHTS > 0 )
    DirectionalLight directionalLight;

    #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
    DirectionalLightShadow directionalLightShadow;
    #endif

    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
      directionalLight = directionalLights[ i ];

      #if THREE_VRM_THREE_REVISION >= 132
        getDirectionalLightInfo( directionalLight, geometry, directLight );
      #else
        getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
      #endif

      atten = 1.0;
      #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
      directionalLightShadow = directionalLightShadows[ i ];
      atten = all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
      #endif

      shadow = 1.0 - material.receiveShadow * ( 1.0 - ( 0.5 + 0.5 * atten ) );
      lightIntensity = getLightIntensity( directLight, geometry, shadow, material.shadingGrade );
      lighting = getLighting( directLight.color );
      reflectedLight.directDiffuse += getDiffuse( material, lightIntensity, lighting );
      lightingSum += lighting;
    }
    #pragma unroll_loop_end
  #endif

  // #if defined( RE_IndirectDiffuse )
  vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
  #if THREE_VRM_THREE_REVISION >= 133
    irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
  #else
    irradiance += getLightProbeIrradiance( lightProbe, geometry );
  #endif
  #if ( NUM_HEMI_LIGHTS > 0 )
    #pragma unroll_loop_start
    for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
      #if THREE_VRM_THREE_REVISION >= 133
        irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
      #else
        irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
      #endif
    }
    #pragma unroll_loop_end
  #endif
  // #endif

  // #include <lights_fragment_maps>
  #ifdef USE_LIGHTMAP
    vec4 lightMapTexel = texture2D( lightMap, vUv2 );
    #if THREE_VRM_THREE_REVISION >= 137
      vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
    #else
      // COMPAT: pre-r137
      vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
    #endif
    #ifndef PHYSICALLY_CORRECT_LIGHTS
      lightMapIrradiance *= PI;
    #endif
    irradiance += lightMapIrradiance;
  #endif

  // #include <lights_fragment_end>
  // RE_IndirectDiffuse here
  reflectedLight.indirectDiffuse += indirectLightIntensity * irradiance * BRDF_Lambert( material.diffuseColor );

  // modulation
  #include <aomap_fragment>

  vec3 col = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;

  // The "comment out if you want to PBR absolutely" line
  #ifndef DEBUG_LITSHADERATE
    col = min(col, material.diffuseColor);
  #endif

  #if defined( OUTLINE ) && defined( OUTLINE_COLOR_MIXED )
    gl_FragColor = vec4(
      outlineColor.rgb * mix( vec3( 1.0 ), col, outlineLightingMix ),
      diffuseColor.a
    );
    postCorrection();
    return;
  #endif

  #ifdef DEBUG_LITSHADERATE
    gl_FragColor = vec4( col, diffuseColor.a );
    postCorrection();
    return;
  #endif

  // -- MToon: parametric rim lighting -----------------------------------------
  vec3 viewDir = normalize( vViewPosition );
  vec3 rimMix = mix( vec3( 1.0 ), lightingSum + indirectLightIntensity * irradiance, rimLightingMix );
  vec3 rim = rimColor * pow( saturate( 1.0 - dot( viewDir, normal ) + rimLift ), rimFresnelPower );
  #ifdef USE_RIMTEXTURE
    #if THREE_VRM_THREE_REVISION >= 137
      rim *= texture2D( rimTexture, uv ).rgb;
    #else
      // COMPAT: pre-r137
      rim *= rimTextureTexelToLinear( texture2D( rimTexture, uv ) ).rgb;
    #endif
  #endif
  col += rim;

  // -- MToon: additive matcap -------------------------------------------------
  #ifdef USE_SPHEREADD
    {
      vec3 x = normalize( vec3( viewDir.z, 0.0, -viewDir.x ) );
      vec3 y = cross( viewDir, x ); // guaranteed to be normalized
      vec2 sphereUv = 0.5 + 0.5 * vec2( dot( x, normal ), -dot( y, normal ) );
      #if THREE_VRM_THREE_REVISION >= 137
        vec3 matcap = texture2D( sphereAdd, sphereUv ).xyz;
      #else
        // COMPAT: pre-r137
        vec3 matcap = sphereAddTexelToLinear( texture2D( sphereAdd, sphereUv ) ).xyz;
      #endif
      col += matcap;
    }
  #endif

  // -- MToon: Emission --------------------------------------------------------
  col += totalEmissiveRadiance;

  // #include <envmap_fragment>

  // -- Almost done! -----------------------------------------------------------
  gl_FragColor = vec4( col, diffuseColor.a );
  postCorrection();
}`;const gn=(a,e)=>{const n=(i=>{if(parseInt(Fe,10)>=136)switch(i){case Ye:return["Linear","( value )"];case Ae:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",i),["Linear","( value )"]}else switch(i){case Ye:return["Linear","( value )"];case Ae:return["sRGB","( value )"];case 3002:return["RGBE","( value )"];case 3004:return["RGBM","( value, 7.0 )"];case 3005:return["RGBM","( value, 16.0 )"];case 3006:return["RGBD","( value, 256.0 )"];case 3007:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+i)}})(e);return"vec4 "+a+"( vec4 value ) { return "+n[0]+"ToLinear"+n[1]+"; }"},ea=2*Math.PI;var Oe,pt,It,gt,Pe;(function(a){a[a.Off=0]="Off",a[a.Front=1]="Front",a[a.Back=2]="Back"})(Oe||(Oe={})),function(a){a[a.None=0]="None",a[a.Normal=1]="Normal",a[a.LitShadeRate=2]="LitShadeRate",a[a.UV=3]="UV"}(pt||(pt={})),function(a){a[a.FixedColor=0]="FixedColor",a[a.MixedLighting=1]="MixedLighting"}(It||(It={})),function(a){a[a.None=0]="None",a[a.WorldCoordinates=1]="WorldCoordinates",a[a.ScreenCoordinates=2]="ScreenCoordinates"}(gt||(gt={})),function(a){a[a.Opaque=0]="Opaque",a[a.Cutout=1]="Cutout",a[a.Transparent=2]="Transparent",a[a.TransparentWithZWrite=3]="TransparentWithZWrite"}(Pe||(Pe={}));class zi extends er{constructor(e={}){super(),this.isMToonMaterial=!0,this.cutoff=.5,this.color=new xe(1,1,1,1),this.shadeColor=new xe(.97,.81,.86,1),this.map=null,this.mainTex_ST=new xe(0,0,1,1),this.shadeTexture=null,this.normalMap=null,this.normalMapType=ji,this.normalScale=new it(1,1),this.receiveShadowRate=1,this.receiveShadowTexture=null,this.shadingGradeRate=1,this.shadingGradeTexture=null,this.shadeShift=0,this.shadeToony=.9,this.lightColorAttenuation=0,this.indirectLightIntensity=.1,this.rimTexture=null,this.rimColor=new xe(0,0,0,1),this.rimLightingMix=0,this.rimFresnelPower=1,this.rimLift=0,this.sphereAdd=null,this.emissionColor=new xe(0,0,0,1),this.emissiveMap=null,this.outlineWidthTexture=null,this.outlineWidth=.5,this.outlineScaledMaxDistance=1,this.outlineColor=new xe(0,0,0,1),this.outlineLightingMix=1,this.uvAnimMaskTexture=null,this.uvAnimScrollX=0,this.uvAnimScrollY=0,this.uvAnimRotation=0,this.shouldApplyUniforms=!0,this._debugMode=pt.None,this._blendMode=Pe.Opaque,this._outlineWidthMode=gt.None,this._outlineColorMode=It.FixedColor,this._cullMode=Oe.Back,this._outlineCullMode=Oe.Front,this._isOutline=!1,this._uvAnimOffsetX=0,this._uvAnimOffsetY=0,this._uvAnimPhase=0,this.encoding=e.encoding||Ye,this.encoding!==Ye&&this.encoding!==Ae&&console.warn("The specified color encoding does not work properly with MToonMaterial. You might want to use THREE.sRGBEncoding instead."),["mToonVersion","shadeTexture_ST","bumpMap_ST","receiveShadowTexture_ST","shadingGradeTexture_ST","rimTexture_ST","sphereAdd_ST","emissionMap_ST","outlineWidthTexture_ST","uvAnimMaskTexture_ST","srcBlend","dstBlend"].forEach(n=>{e[n]!==void 0&&delete e[n]}),e.fog=!0,e.lights=!0,e.clipping=!0,parseInt(Fe,10)<129&&(e.skinning=e.skinning||!1),parseInt(Fe,10)<131&&(e.morphTargets=e.morphTargets||!1,e.morphNormals=e.morphNormals||!1),e.uniforms=tr.merge([et.common,et.normalmap,et.emissivemap,et.fog,et.lights,{cutoff:{value:.5},color:{value:new fe(1,1,1)},colorAlpha:{value:1},shadeColor:{value:new fe(.97,.81,.86)},mainTex_ST:{value:new xe(0,0,1,1)},shadeTexture:{value:null},receiveShadowRate:{value:1},receiveShadowTexture:{value:null},shadingGradeRate:{value:1},shadingGradeTexture:{value:null},shadeShift:{value:0},shadeToony:{value:.9},lightColorAttenuation:{value:0},indirectLightIntensity:{value:.1},rimTexture:{value:null},rimColor:{value:new fe(0,0,0)},rimLightingMix:{value:0},rimFresnelPower:{value:1},rimLift:{value:0},sphereAdd:{value:null},emissionColor:{value:new fe(0,0,0)},outlineWidthTexture:{value:null},outlineWidth:{value:.5},outlineScaledMaxDistance:{value:1},outlineColor:{value:new fe(0,0,0)},outlineLightingMix:{value:1},uvAnimMaskTexture:{value:null},uvAnimOffsetX:{value:0},uvAnimOffsetY:{value:0},uvAnimTheta:{value:0}}]),this.setValues(e),this._updateShaderCode(),this._applyUniforms()}get mainTex(){return this.map}set mainTex(e){this.map=e}get bumpMap(){return this.normalMap}set bumpMap(e){this.normalMap=e}get bumpScale(){return this.normalScale.x}set bumpScale(e){this.normalScale.set(e,e)}get emissionMap(){return this.emissiveMap}set emissionMap(e){this.emissiveMap=e}get blendMode(){return this._blendMode}set blendMode(e){this._blendMode=e,this.depthWrite=this._blendMode!==Pe.Transparent,this.transparent=this._blendMode===Pe.Transparent||this._blendMode===Pe.TransparentWithZWrite,this._updateShaderCode()}get debugMode(){return this._debugMode}set debugMode(e){this._debugMode=e,this._updateShaderCode()}get outlineWidthMode(){return this._outlineWidthMode}set outlineWidthMode(e){this._outlineWidthMode=e,this._updateShaderCode()}get outlineColorMode(){return this._outlineColorMode}set outlineColorMode(e){this._outlineColorMode=e,this._updateShaderCode()}get cullMode(){return this._cullMode}set cullMode(e){this._cullMode=e,this._updateCullFace()}get outlineCullMode(){return this._outlineCullMode}set outlineCullMode(e){this._outlineCullMode=e,this._updateCullFace()}get zWrite(){return this.depthWrite?1:0}set zWrite(e){this.depthWrite=.5<=e}get isOutline(){return this._isOutline}set isOutline(e){this._isOutline=e,this._updateShaderCode(),this._updateCullFace()}updateVRMMaterials(e){this._uvAnimOffsetX=this._uvAnimOffsetX+e*this.uvAnimScrollX,this._uvAnimOffsetY=this._uvAnimOffsetY-e*this.uvAnimScrollY,this._uvAnimPhase=this._uvAnimPhase+e*this.uvAnimRotation,this._applyUniforms()}copy(e){return super.copy(e),this.cutoff=e.cutoff,this.color.copy(e.color),this.shadeColor.copy(e.shadeColor),this.map=e.map,this.mainTex_ST.copy(e.mainTex_ST),this.shadeTexture=e.shadeTexture,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(this.normalScale),this.receiveShadowRate=e.receiveShadowRate,this.receiveShadowTexture=e.receiveShadowTexture,this.shadingGradeRate=e.shadingGradeRate,this.shadingGradeTexture=e.shadingGradeTexture,this.shadeShift=e.shadeShift,this.shadeToony=e.shadeToony,this.lightColorAttenuation=e.lightColorAttenuation,this.indirectLightIntensity=e.indirectLightIntensity,this.rimTexture=e.rimTexture,this.rimColor.copy(e.rimColor),this.rimLightingMix=e.rimLightingMix,this.rimFresnelPower=e.rimFresnelPower,this.rimLift=e.rimLift,this.sphereAdd=e.sphereAdd,this.emissionColor.copy(e.emissionColor),this.emissiveMap=e.emissiveMap,this.outlineWidthTexture=e.outlineWidthTexture,this.outlineWidth=e.outlineWidth,this.outlineScaledMaxDistance=e.outlineScaledMaxDistance,this.outlineColor.copy(e.outlineColor),this.outlineLightingMix=e.outlineLightingMix,this.uvAnimMaskTexture=e.uvAnimMaskTexture,this.uvAnimScrollX=e.uvAnimScrollX,this.uvAnimScrollY=e.uvAnimScrollY,this.uvAnimRotation=e.uvAnimRotation,this.debugMode=e.debugMode,this.blendMode=e.blendMode,this.outlineWidthMode=e.outlineWidthMode,this.outlineColorMode=e.outlineColorMode,this.cullMode=e.cullMode,this.outlineCullMode=e.outlineCullMode,this.isOutline=e.isOutline,this}_applyUniforms(){this.uniforms.uvAnimOffsetX.value=this._uvAnimOffsetX,this.uniforms.uvAnimOffsetY.value=this._uvAnimOffsetY,this.uniforms.uvAnimTheta.value=ea*this._uvAnimPhase,this.shouldApplyUniforms&&(this.shouldApplyUniforms=!1,this.uniforms.cutoff.value=this.cutoff,this.uniforms.color.value.setRGB(this.color.x,this.color.y,this.color.z),this.uniforms.colorAlpha.value=this.color.w,this.uniforms.shadeColor.value.setRGB(this.shadeColor.x,this.shadeColor.y,this.shadeColor.z),this.uniforms.map.value=this.map,this.uniforms.mainTex_ST.value.copy(this.mainTex_ST),this.uniforms.shadeTexture.value=this.shadeTexture,this.uniforms.normalMap.value=this.normalMap,this.uniforms.normalScale.value.copy(this.normalScale),this.uniforms.receiveShadowRate.value=this.receiveShadowRate,this.uniforms.receiveShadowTexture.value=this.receiveShadowTexture,this.uniforms.shadingGradeRate.value=this.shadingGradeRate,this.uniforms.shadingGradeTexture.value=this.shadingGradeTexture,this.uniforms.shadeShift.value=this.shadeShift,this.uniforms.shadeToony.value=this.shadeToony,this.uniforms.lightColorAttenuation.value=this.lightColorAttenuation,this.uniforms.indirectLightIntensity.value=this.indirectLightIntensity,this.uniforms.rimTexture.value=this.rimTexture,this.uniforms.rimColor.value.setRGB(this.rimColor.x,this.rimColor.y,this.rimColor.z),this.uniforms.rimLightingMix.value=this.rimLightingMix,this.uniforms.rimFresnelPower.value=this.rimFresnelPower,this.uniforms.rimLift.value=this.rimLift,this.uniforms.sphereAdd.value=this.sphereAdd,this.uniforms.emissionColor.value.setRGB(this.emissionColor.x,this.emissionColor.y,this.emissionColor.z),this.uniforms.emissiveMap.value=this.emissiveMap,this.uniforms.outlineWidthTexture.value=this.outlineWidthTexture,this.uniforms.outlineWidth.value=this.outlineWidth,this.uniforms.outlineScaledMaxDistance.value=this.outlineScaledMaxDistance,this.uniforms.outlineColor.value.setRGB(this.outlineColor.x,this.outlineColor.y,this.outlineColor.z),this.uniforms.outlineLightingMix.value=this.outlineLightingMix,this.uniforms.uvAnimMaskTexture.value=this.uvAnimMaskTexture,this.encoding===Ae&&(this.uniforms.color.value.convertSRGBToLinear(),this.uniforms.shadeColor.value.convertSRGBToLinear(),this.uniforms.rimColor.value.convertSRGBToLinear(),this.uniforms.emissionColor.value.convertSRGBToLinear(),this.uniforms.outlineColor.value.convertSRGBToLinear()),this._updateCullFace())}_updateShaderCode(){const e=this.outlineWidthTexture!==null,n=this.map!==null||this.shadeTexture!==null||this.receiveShadowTexture!==null||this.shadingGradeTexture!==null||this.rimTexture!==null||this.uvAnimMaskTexture!==null;if(this.defines={THREE_VRM_THREE_REVISION:parseInt(Fe,10),OUTLINE:this._isOutline,BLENDMODE_OPAQUE:this._blendMode===Pe.Opaque,BLENDMODE_CUTOUT:this._blendMode===Pe.Cutout,BLENDMODE_TRANSPARENT:this._blendMode===Pe.Transparent||this._blendMode===Pe.TransparentWithZWrite,MTOON_USE_UV:e||n,MTOON_UVS_VERTEX_ONLY:e&&!n,USE_SHADETEXTURE:this.shadeTexture!==null,USE_RECEIVESHADOWTEXTURE:this.receiveShadowTexture!==null,USE_SHADINGGRADETEXTURE:this.shadingGradeTexture!==null,USE_RIMTEXTURE:this.rimTexture!==null,USE_SPHEREADD:this.sphereAdd!==null,USE_OUTLINEWIDTHTEXTURE:this.outlineWidthTexture!==null,USE_UVANIMMASKTEXTURE:this.uvAnimMaskTexture!==null,DEBUG_NORMAL:this._debugMode===pt.Normal,DEBUG_LITSHADERATE:this._debugMode===pt.LitShadeRate,DEBUG_UV:this._debugMode===pt.UV,OUTLINE_WIDTH_WORLD:this._outlineWidthMode===gt.WorldCoordinates,OUTLINE_WIDTH_SCREEN:this._outlineWidthMode===gt.ScreenCoordinates,OUTLINE_COLOR_FIXED:this._outlineColorMode===It.FixedColor,OUTLINE_COLOR_MIXED:this._outlineColorMode===It.MixedLighting},this.vertexShader=`// #define PHONG

varying vec3 vViewPosition;

#ifndef FLAT_SHADED
  varying vec3 vNormal;
#endif

#include <common>

// #include <uv_pars_vertex>
#ifdef MTOON_USE_UV
  #ifdef MTOON_UVS_VERTEX_ONLY
    vec2 vUv;
  #else
    varying vec2 vUv;
  #endif

  uniform vec4 mainTex_ST;
#endif

#include <uv2_pars_vertex>
// #include <displacementmap_pars_vertex>
// #include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

#ifdef USE_OUTLINEWIDTHTEXTURE
  uniform sampler2D outlineWidthTexture;
#endif

uniform float outlineWidth;
uniform float outlineScaledMaxDistance;

void main() {

  // #include <uv_vertex>
  #ifdef MTOON_USE_UV
    vUv = uv;
    vUv.y = 1.0 - vUv.y; // uv.y is opposite from UniVRM's
    vUv = mainTex_ST.st + mainTex_ST.pq * vUv;
    vUv.y = 1.0 - vUv.y; // reverting the previous flip
  #endif

  #include <uv2_vertex>
  #include <color_vertex>

  #include <beginnormal_vertex>
  #include <morphnormal_vertex>
  #include <skinbase_vertex>
  #include <skinnormal_vertex>

  // we need this to compute the outline properly
  objectNormal = normalize( objectNormal );

  #include <defaultnormal_vertex>

  #ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED
    vNormal = normalize( transformedNormal );
  #endif

  #include <begin_vertex>

  #include <morphtarget_vertex>
  #include <skinning_vertex>
  // #include <displacementmap_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>
  #include <clipping_planes_vertex>

  vViewPosition = - mvPosition.xyz;

  float outlineTex = 1.0;

  #ifdef OUTLINE
    #ifdef USE_OUTLINEWIDTHTEXTURE
      outlineTex = texture2D( outlineWidthTexture, vUv ).r;
    #endif

    #ifdef OUTLINE_WIDTH_WORLD
      float worldNormalLength = length( transformedNormal );
      vec3 outlineOffset = 0.01 * outlineWidth * outlineTex * worldNormalLength * objectNormal;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( outlineOffset + transformed, 1.0 );
    #endif

    #ifdef OUTLINE_WIDTH_SCREEN
      vec3 clipNormal = ( projectionMatrix * modelViewMatrix * vec4( objectNormal, 0.0 ) ).xyz;
      vec2 projectedNormal = normalize( clipNormal.xy );
      projectedNormal *= min( gl_Position.w, outlineScaledMaxDistance );
      projectedNormal.x *= projectionMatrix[ 0 ].x / projectionMatrix[ 1 ].y;
      gl_Position.xy += 0.01 * outlineWidth * outlineTex * projectedNormal.xy;
    #endif

    gl_Position.z += 1E-6 * gl_Position.w; // anti-artifact magic
  #endif

  #include <worldpos_vertex>
  // #include <envmap_vertex>
  #include <shadowmap_vertex>
  #include <fog_vertex>

}`,this.fragmentShader=Fi,parseInt(Fe,10)<137){const i=(this.shadeTexture!==null?gn("shadeTextureTexelToLinear",this.shadeTexture.encoding)+`
`:"")+(this.sphereAdd!==null?gn("sphereAddTexelToLinear",this.sphereAdd.encoding)+`
`:"")+(this.rimTexture!==null?gn("rimTextureTexelToLinear",this.rimTexture.encoding)+`
`:"");this.fragmentShader=i+Fi}this.needsUpdate=!0}_updateCullFace(){this.isOutline?this.outlineCullMode===Oe.Off?this.side=Wt:this.outlineCullMode===Oe.Front?this.side=Ti:this.outlineCullMode===Oe.Back&&(this.side=vn):this.cullMode===Oe.Off?this.side=Wt:this.cullMode===Oe.Front?this.side=Ti:this.cullMode===Oe.Back&&(this.side=vn)}}var _e;(function(a){a[a.Opaque=0]="Opaque",a[a.Cutout=1]="Cutout",a[a.Transparent=2]="Transparent",a[a.TransparentWithZWrite=3]="TransparentWithZWrite"})(_e||(_e={}));class Gt extends er{constructor(e){super(),this.isVRMUnlitMaterial=!0,this.cutoff=.5,this.map=null,this.mainTex_ST=new xe(0,0,1,1),this._renderType=_e.Opaque,this.shouldApplyUniforms=!0,e===void 0&&(e={}),e.fog=!0,e.clipping=!0,parseInt(Fe,10)<129&&(e.skinning=e.skinning||!1),parseInt(Fe,10)<131&&(e.morphTargets=e.morphTargets||!1,e.morphNormals=e.morphNormals||!1),e.uniforms=tr.merge([et.common,et.fog,{cutoff:{value:.5},mainTex_ST:{value:new xe(0,0,1,1)}}]),this.setValues(e),this._updateShaderCode(),this._applyUniforms()}get mainTex(){return this.map}set mainTex(e){this.map=e}get renderType(){return this._renderType}set renderType(e){this._renderType=e,this.depthWrite=this._renderType!==_e.Transparent,this.transparent=this._renderType===_e.Transparent||this._renderType===_e.TransparentWithZWrite,this._updateShaderCode()}updateVRMMaterials(e){this._applyUniforms()}copy(e){return super.copy(e),this.cutoff=e.cutoff,this.map=e.map,this.mainTex_ST.copy(e.mainTex_ST),this.renderType=e.renderType,this}_applyUniforms(){this.shouldApplyUniforms&&(this.shouldApplyUniforms=!1,this.uniforms.cutoff.value=this.cutoff,this.uniforms.map.value=this.map,this.uniforms.mainTex_ST.value.copy(this.mainTex_ST))}_updateShaderCode(){this.defines={RENDERTYPE_OPAQUE:this._renderType===_e.Opaque,RENDERTYPE_CUTOUT:this._renderType===_e.Cutout,RENDERTYPE_TRANSPARENT:this._renderType===_e.Transparent||this._renderType===_e.TransparentWithZWrite},this.vertexShader=`#include <common>

// #include <uv_pars_vertex>
#ifdef USE_MAP
  varying vec2 vUv;
  uniform vec4 mainTex_ST;
#endif

#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>

void main() {

  // #include <uv_vertex>
  #ifdef USE_MAP
    vUv = vec2( mainTex_ST.p * uv.x + mainTex_ST.s, mainTex_ST.q * uv.y + mainTex_ST.t );
  #endif

  #include <uv2_vertex>
  #include <color_vertex>
  #include <skinbase_vertex>

  #ifdef USE_ENVMAP

  #include <beginnormal_vertex>
  #include <morphnormal_vertex>
  #include <skinnormal_vertex>
  #include <defaultnormal_vertex>

  #endif

  #include <begin_vertex>
  #include <morphtarget_vertex>
  #include <skinning_vertex>
  #include <project_vertex>
  #include <logdepthbuf_vertex>

  #include <worldpos_vertex>
  #include <clipping_planes_vertex>
  #include <envmap_vertex>
  #include <fog_vertex>

}`,this.fragmentShader=`#ifdef RENDERTYPE_CUTOUT
  uniform float cutoff;
#endif

#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
// #include <alphamap_pars_fragment>
// #include <aomap_pars_fragment>
// #include <lightmap_pars_fragment>
// #include <envmap_pars_fragment>
#include <fog_pars_fragment>
// #include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>

// == main procedure ===========================================================
void main() {
  #include <clipping_planes_fragment>

  vec4 diffuseColor = vec4( 1.0 );

  #include <logdepthbuf_fragment>

  #include <map_fragment>
  #include <color_fragment>
  // #include <alphamap_fragment>

  // MToon: alpha
  // #include <alphatest_fragment>
  #ifdef RENDERTYPE_CUTOUT
    if ( diffuseColor.a <= cutoff ) { discard; }
    diffuseColor.a = 1.0;
  #endif

  #ifdef RENDERTYPE_OPAQUE
    diffuseColor.a = 1.0;
  #endif

  // #include <specularmap_fragment>

  ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );

  // accumulation (baked indirect lighting only)
  #ifdef USE_LIGHTMAP
    reflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;
  #else
    reflectedLight.indirectDiffuse += vec3( 1.0 );
  #endif

  // modulation
  // #include <aomap_fragment>

  reflectedLight.indirectDiffuse *= diffuseColor.rgb;
  vec3 outgoingLight = reflectedLight.indirectDiffuse;

  // #include <envmap_fragment>

  gl_FragColor = vec4( outgoingLight, diffuseColor.a );

  #include <premultiplied_alpha_fragment>
  #include <tonemapping_fragment>
  #include <encodings_fragment>
  #include <fog_fragment>
}`,this.needsUpdate=!0}}class ta{constructor(e={}){this._encoding=e.encoding||Ye,this._encoding!==Ye&&this._encoding!==Ae&&console.warn("The specified color encoding might not work properly with VRMMaterialImporter. You might want to use THREE.sRGBEncoding instead."),this._requestEnvMap=e.requestEnvMap}convertGLTFMaterials(e){var n;return ue(this,void 0,void 0,function*(){const i=(n=e.parser.json.extensions)===null||n===void 0?void 0:n.VRM;if(!i)return null;const r=i.materialProperties;if(!r)return null;const s=yield fr(e),l={},c=[];return yield Promise.all(Array.from(s.entries()).map(([h,f])=>ue(this,void 0,void 0,function*(){const m=e.parser.json.nodes[h],p=e.parser.json.meshes[m.mesh];yield Promise.all(f.map((L,x)=>ue(this,void 0,void 0,function*(){const y=p.primitives[x];if(!y)return;const E=L.geometry,M=E.index?E.index.count:E.attributes.position.count/3;Array.isArray(L.material)||(L.material=[L.material],E.addGroup(0,M,0));const S=y.material;let R,O=r[S];O||(console.warn(`VRMMaterialImporter: There are no material definition for material #${S} on VRM extension.`),O={shader:"VRM_USE_GLTFSHADER"}),l[S]?R=l[S]:(R=yield this.createVRMMaterials(L.material[0],O,e),l[S]=R,c.push(R.surface),R.outline&&c.push(R.outline)),L.material[0]=R.surface,this._requestEnvMap&&R.surface.isMeshStandardMaterial&&this._requestEnvMap().then(k=>{R.surface.envMap=k,R.surface.needsUpdate=!0}),L.renderOrder=O.renderQueue||2e3,R.outline&&(L.material[1]=R.outline,E.addGroup(0,M,1))})))}))),c})}createVRMMaterials(e,n,i){return ue(this,void 0,void 0,function*(){let r,s;if(n.shader==="VRM/MToon"){const l=yield this._extractMaterialProperties(e,n,i);["srcBlend","dstBlend","isFirstSetup"].forEach(c=>{l[c]!==void 0&&delete l[c]}),["mainTex","shadeTexture","emissionMap","sphereAdd","rimTexture"].forEach(c=>{l[c]!==void 0&&(l[c].encoding=this._encoding)}),l.encoding=this._encoding,r=new zi(l),l.outlineWidthMode!==gt.None&&(l.isOutline=!0,s=new zi(l))}else if(n.shader==="VRM/UnlitTexture"){const l=yield this._extractMaterialProperties(e,n,i);l.renderType=_e.Opaque,r=new Gt(l)}else if(n.shader==="VRM/UnlitCutout"){const l=yield this._extractMaterialProperties(e,n,i);l.renderType=_e.Cutout,r=new Gt(l)}else if(n.shader==="VRM/UnlitTransparent"){const l=yield this._extractMaterialProperties(e,n,i);l.renderType=_e.Transparent,r=new Gt(l)}else if(n.shader==="VRM/UnlitTransparentZWrite"){const l=yield this._extractMaterialProperties(e,n,i);l.renderType=_e.TransparentWithZWrite,r=new Gt(l)}else n.shader!=="VRM_USE_GLTFSHADER"&&console.warn(`Unknown shader detected: "${n.shader}"`),r=this._convertGLTFMaterial(e.clone());return r.name=e.name,r.userData=JSON.parse(JSON.stringify(e.userData)),r.userData.vrmMaterialProperties=n,s&&(s.name=e.name+" (Outline)",s.userData=JSON.parse(JSON.stringify(e.userData)),s.userData.vrmMaterialProperties=n),{surface:r,outline:s}})}_renameMaterialProperty(e){return e[0]!=="_"?(console.warn(`VRMMaterials: Given property name "${e}" might be invalid`),e):(e=e.substring(1),/[A-Z]/.test(e[0])?e[0].toLowerCase()+e.substring(1):(console.warn(`VRMMaterials: Given property name "${e}" might be invalid`),e))}_convertGLTFMaterial(e){if(e.isMeshStandardMaterial){const n=e;n.map&&(n.map.encoding=this._encoding),n.emissiveMap&&(n.emissiveMap.encoding=this._encoding),this._encoding===Ye&&(n.color.convertLinearToSRGB(),n.emissive.convertLinearToSRGB())}if(e.isMeshBasicMaterial){const n=e;n.map&&(n.map.encoding=this._encoding),this._encoding===Ye&&n.color.convertLinearToSRGB()}return e}_extractMaterialProperties(e,n,i){const r=[],s={};if(n.textureProperties)for(const l of Object.keys(n.textureProperties)){const c=this._renameMaterialProperty(l),h=n.textureProperties[l];r.push(i.parser.getDependency("texture",h).then(f=>{s[c]=f}))}if(n.floatProperties)for(const l of Object.keys(n.floatProperties)){const c=this._renameMaterialProperty(l);s[c]=n.floatProperties[l]}if(n.vectorProperties)for(const l of Object.keys(n.vectorProperties)){let c=this._renameMaterialProperty(l);["_MainTex","_ShadeTexture","_BumpMap","_ReceiveShadowTexture","_ShadingGradeTexture","_RimTexture","_SphereAdd","_EmissionMap","_OutlineWidthTexture","_UvAnimMaskTexture"].some(h=>l===h)&&(c+="_ST"),s[c]=new xe(...n.vectorProperties[l])}return parseInt(Fe,10)<129&&(s.skinning=e.skinning||!1),parseInt(Fe,10)<131&&(s.morphTargets=e.morphTargets||!1,s.morphNormals=e.morphNormals||!1),Promise.all(r).then(()=>s)}}class na{constructor(e){var n;this.ignoreTexture=(n=e==null?void 0:e.ignoreTexture)!==null&&n!==void 0&&n}import(e){var n;return ue(this,void 0,void 0,function*(){const i=(n=e.parser.json.extensions)===null||n===void 0?void 0:n.VRM;if(!i)return null;const r=i.meta;if(!r)return null;let s;return this.ignoreTexture||r.texture==null||r.texture===-1||(s=yield e.parser.getDependency("texture",r.texture)),{allowedUserName:r.allowedUserName,author:r.author,commercialUssageName:r.commercialUssageName,contactInformation:r.contactInformation,licenseName:r.licenseName,otherLicenseUrl:r.otherLicenseUrl,otherPermissionUrl:r.otherPermissionUrl,reference:r.reference,sexualUssageName:r.sexualUssageName,texture:s!=null?s:void 0,title:r.title,version:r.version,violentUssageName:r.violentUssageName}})}}const ia=new De;function mr(a){return a.invert?a.invert():a.getInverse(ia.copy(a)),a}class ra{constructor(e){this._inverseCache=new De,this._shouldUpdateInverse=!0,this.matrix=e;const n={set:(i,r,s)=>(this._shouldUpdateInverse=!0,i[r]=s,!0)};this._originalElements=e.elements,e.elements=new Proxy(e.elements,n)}get inverse(){return this._shouldUpdateInverse&&(mr(this._inverseCache.copy(this.matrix)),this._shouldUpdateInverse=!1),this._inverseCache}revert(){this.matrix.elements=this._originalElements}}const oa=Object.freeze(new De),sa=Object.freeze(new Ce),ft=new q,Bi=new q,aa=new q,la=new Ce,de=new De,jt=new De;class ua{constructor(e,n={}){var i,r,s,l,c,h;if(this._currentTail=new q,this._prevTail=new q,this._nextTail=new q,this._boneAxis=new q,this._centerSpacePosition=new q,this._center=null,this._parentWorldRotation=new Ce,this._initialLocalMatrix=new De,this._initialLocalRotation=new Ce,this._initialLocalChildPosition=new q,this.bone=e,this.bone.matrixAutoUpdate=!1,this.radius=(i=n.radius)!==null&&i!==void 0?i:.02,this.stiffnessForce=(r=n.stiffnessForce)!==null&&r!==void 0?r:1,this.gravityDir=n.gravityDir?new q().copy(n.gravityDir):new q().set(0,-1,0),this.gravityPower=(s=n.gravityPower)!==null&&s!==void 0?s:0,this.dragForce=(l=n.dragForce)!==null&&l!==void 0?l:.4,this.colliders=(c=n.colliders)!==null&&c!==void 0?c:[],this._centerSpacePosition.setFromMatrixPosition(this.bone.matrixWorld),this._initialLocalMatrix.copy(this.bone.matrix),this._initialLocalRotation.copy(this.bone.quaternion),this.bone.children.length===0)this._initialLocalChildPosition.copy(this.bone.position).normalize().multiplyScalar(.07);else{const f=this.bone.children[0];this._initialLocalChildPosition.copy(f.position)}this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)),this._prevTail.copy(this._currentTail),this._nextTail.copy(this._currentTail),this._boneAxis.copy(this._initialLocalChildPosition).normalize(),this._centerSpaceBoneLength=ft.copy(this._initialLocalChildPosition).applyMatrix4(this.bone.matrixWorld).sub(this._centerSpacePosition).length(),this.center=(h=n.center)!==null&&h!==void 0?h:null}get center(){return this._center}set center(e){var n;this._getMatrixCenterToWorld(de),this._currentTail.applyMatrix4(de),this._prevTail.applyMatrix4(de),this._nextTail.applyMatrix4(de),!((n=this._center)===null||n===void 0)&&n.userData.inverseCacheProxy&&(this._center.userData.inverseCacheProxy.revert(),delete this._center.userData.inverseCacheProxy),this._center=e,this._center&&(this._center.userData.inverseCacheProxy||(this._center.userData.inverseCacheProxy=new ra(this._center.matrixWorld))),this._getMatrixWorldToCenter(de),this._currentTail.applyMatrix4(de),this._prevTail.applyMatrix4(de),this._nextTail.applyMatrix4(de),de.multiply(this.bone.matrixWorld),this._centerSpacePosition.setFromMatrixPosition(de),this._centerSpaceBoneLength=ft.copy(this._initialLocalChildPosition).applyMatrix4(de).sub(this._centerSpacePosition).length()}reset(){this.bone.quaternion.copy(this._initialLocalRotation),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._getParentMatrixWorld(),this.bone.matrix),this._centerSpacePosition.setFromMatrixPosition(this.bone.matrixWorld),this.bone.localToWorld(this._currentTail.copy(this._initialLocalChildPosition)),this._prevTail.copy(this._currentTail),this._nextTail.copy(this._currentTail)}update(e){if(e<=0)return;this.bone.parent?Yt(this.bone.parent,this._parentWorldRotation):this._parentWorldRotation.copy(sa),this._getMatrixWorldToCenter(de),de.multiply(this.bone.matrixWorld),this._centerSpacePosition.setFromMatrixPosition(de),this._getMatrixWorldToCenter(jt),jt.multiply(this._getParentMatrixWorld());const n=this.stiffnessForce*e,i=Bi.copy(this.gravityDir).multiplyScalar(this.gravityPower*e);this._nextTail.copy(this._currentTail).add(ft.copy(this._currentTail).sub(this._prevTail).multiplyScalar(1-this.dragForce)).add(ft.copy(this._boneAxis).applyMatrix4(this._initialLocalMatrix).applyMatrix4(jt).sub(this._centerSpacePosition).normalize().multiplyScalar(n)).add(i),this._nextTail.sub(this._centerSpacePosition).normalize().multiplyScalar(this._centerSpaceBoneLength).add(this._centerSpacePosition),this._collision(this._nextTail),this._prevTail.copy(this._currentTail),this._currentTail.copy(this._nextTail);const r=mr(de.copy(jt.multiply(this._initialLocalMatrix))),s=la.setFromUnitVectors(this._boneAxis,ft.copy(this._nextTail).applyMatrix4(r).normalize());this.bone.quaternion.copy(this._initialLocalRotation).multiply(s),this.bone.updateMatrix(),this.bone.matrixWorld.multiplyMatrices(this._getParentMatrixWorld(),this.bone.matrix)}_collision(e){this.colliders.forEach(n=>{this._getMatrixWorldToCenter(de),de.multiply(n.matrixWorld);const i=ft.setFromMatrixPosition(de),r=n.geometry.boundingSphere.radius,s=this.radius+r;if(e.distanceToSquared(i)<=s*s){const l=Bi.subVectors(e,i).normalize(),c=aa.addVectors(i,l.multiplyScalar(s));e.copy(c.sub(this._centerSpacePosition).normalize().multiplyScalar(this._centerSpaceBoneLength).add(this._centerSpacePosition))}})}_getMatrixCenterToWorld(e){return this._center?e.copy(this._center.matrixWorld):e.identity(),e}_getMatrixWorldToCenter(e){return this._center?e.copy(this._center.userData.inverseCacheProxy.inverse):e.identity(),e}_getParentMatrixWorld(){return this.bone.parent?this.bone.parent.matrixWorld:oa}}class ca{constructor(e,n){this.colliderGroups=[],this.springBoneGroupList=[],this.colliderGroups=e,this.springBoneGroupList=n}setCenter(e){this.springBoneGroupList.forEach(n=>{n.forEach(i=>{i.center=e})})}lateUpdate(e){const n=new Set;this.springBoneGroupList.forEach(i=>{i.forEach(r=>{this._updateWorldMatrix(n,r.bone),r.update(e)})})}reset(){const e=new Set;this.springBoneGroupList.forEach(n=>{n.forEach(i=>{this._updateWorldMatrix(e,i.bone),i.reset()})})}_updateWorldMatrix(e,n){e.has(n)||(n.parent&&this._updateWorldMatrix(e,n.parent),n.updateWorldMatrix(!1,!1),e.add(n))}}const ha=new q,da=new Xe({visible:!1});class fa{import(e){var n;return ue(this,void 0,void 0,function*(){const i=(n=e.parser.json.extensions)===null||n===void 0?void 0:n.VRM;if(!i)return null;const r=i.secondaryAnimation;if(!r)return null;const s=yield this._importColliderMeshGroups(e,r),l=yield this._importSpringBoneGroupList(e,r,s);return new ca(s,l)})}_createSpringBone(e,n={}){return new ua(e,n)}_importSpringBoneGroupList(e,n,i){return ue(this,void 0,void 0,function*(){const r=n.boneGroups||[],s=[];return yield Promise.all(r.map(l=>ue(this,void 0,void 0,function*(){if(l.stiffiness===void 0||l.gravityDir===void 0||l.gravityDir.x===void 0||l.gravityDir.y===void 0||l.gravityDir.z===void 0||l.gravityPower===void 0||l.dragForce===void 0||l.hitRadius===void 0||l.colliderGroups===void 0||l.bones===void 0||l.center===void 0)return;const c=l.stiffiness,h=new q(l.gravityDir.x,l.gravityDir.y,-l.gravityDir.z),f=l.gravityPower,m=l.dragForce,p=l.hitRadius,L=[];l.colliderGroups.forEach(y=>{L.push(...i[y].colliders)});const x=[];yield Promise.all(l.bones.map(y=>ue(this,void 0,void 0,function*(){const E=yield e.parser.getDependency("node",y),M=l.center!==-1?yield e.parser.getDependency("node",l.center):null;E&&E.traverse(S=>{const R=this._createSpringBone(S,{radius:p,stiffnessForce:c,gravityDir:h,gravityPower:f,dragForce:m,colliders:L,center:M});x.push(R)})}))),s.push(x)}))),s})}_importColliderMeshGroups(e,n){return ue(this,void 0,void 0,function*(){const i=n.colliderGroups;if(i===void 0)return[];const r=[];return i.forEach(s=>ue(this,void 0,void 0,function*(){if(s.node===void 0||s.colliders===void 0)return;const l=yield e.parser.getDependency("node",s.node),c=[];s.colliders.forEach(f=>{if(f.offset===void 0||f.offset.x===void 0||f.offset.y===void 0||f.offset.z===void 0||f.radius===void 0)return;const m=ha.set(f.offset.x,f.offset.y,-f.offset.z),p=this._createColliderMesh(f.radius,m);l.add(p),c.push(p)});const h={node:s.node,colliders:c};r.push(h)})),r})}_createColliderMesh(e,n){const i=new Kt(new Ho(e,8,4),da);return i.position.copy(n),i.name="vrmColliderSphere",i.geometry.computeBoundingSphere(),i}}class pa{constructor(e={}){this._metaImporter=e.metaImporter||new na,this._blendShapeImporter=e.blendShapeImporter||new Bs,this._lookAtImporter=e.lookAtImporter||new Qs,this._humanoidImporter=e.humanoidImporter||new Xs,this._firstPersonImporter=e.firstPersonImporter||new js,this._materialImporter=e.materialImporter||new ta,this._springBoneImporter=e.springBoneImporter||new fa}import(e){return ue(this,void 0,void 0,function*(){if(e.parser.json.extensions===void 0||e.parser.json.extensions.VRM===void 0)throw new Error("Could not find VRM extension on the GLTF");const n=e.scene;n.updateMatrixWorld(!1),n.traverse(m=>{m.isMesh&&(m.frustumCulled=!1)});const i=(yield this._metaImporter.import(e))||void 0,r=(yield this._materialImporter.convertGLTFMaterials(e))||void 0,s=(yield this._humanoidImporter.import(e))||void 0,l=s&&(yield this._firstPersonImporter.import(e,s))||void 0,c=(yield this._blendShapeImporter.import(e))||void 0,h=l&&c&&s&&(yield this._lookAtImporter.import(e,l,c,s))||void 0,f=(yield this._springBoneImporter.import(e))||void 0;return new yr({scene:e.scene,meta:i,materials:r,humanoid:s,firstPerson:l,blendShapeProxy:c,lookAt:h,springBoneManager:f})})}}class yr{constructor(e){this.scene=e.scene,this.humanoid=e.humanoid,this.blendShapeProxy=e.blendShapeProxy,this.firstPerson=e.firstPerson,this.lookAt=e.lookAt,this.materials=e.materials,this.springBoneManager=e.springBoneManager,this.meta=e.meta}static from(e,n={}){return ue(this,void 0,void 0,function*(){return yield new pa(n).import(e)})}update(e){this.lookAt&&this.lookAt.update(e),this.blendShapeProxy&&this.blendShapeProxy.update(),this.springBoneManager&&this.springBoneManager.lateUpdate(e),this.materials&&this.materials.forEach(n=>{n.updateVRMMaterials&&n.updateVRMMaterials(e)})}dispose(){var e,n;const i=this.scene;i&&i.traverse(Is),(n=(e=this.meta)===null||e===void 0?void 0:e.texture)===null||n===void 0||n.dispose()}}const mn=new it,ga=new $i(-1,1,-1,1,-1,1),En=new Xe({color:16777215,side:Wt}),ma=new Kt(new Uo(2,2),En),vr=new Qi;vr.add(ma);class Ot{constructor(){}}Ot.extractThumbnailBlob=function(a,e,n=512){var i;const r=(i=e.meta)===null||i===void 0?void 0:i.texture;if(!r)throw new Error("extractThumbnailBlob: This VRM does not have a thumbnail");const s=a.getContext().canvas;a.getSize(mn);const l=mn.x,c=mn.y;return a.setSize(n,n,!1),En.map=r,a.render(vr,ga),En.map=null,s instanceof OffscreenCanvas?s.convertToBlob().finally(()=>{a.setSize(l,c,!1)}):new Promise((h,f)=>{s.toBlob(m=>{a.setSize(l,c,!1),m==null?f("extractThumbnailBlob: Failed to create a blob"):h(m)})})},Ot.removeUnnecessaryJoints=function(a){const e=new Map;a.traverse(n=>{if(n.type!=="SkinnedMesh")return;const i=n,r=i.geometry.getAttribute("skinIndex");let s=e.get(r);if(!s){const l=[],c=[],h={},f=r.array;for(let m=0;m<f.length;m++){const p=f[m];h[p]===void 0&&(h[p]=l.length,l.push(i.skeleton.bones[p]),c.push(i.skeleton.boneInverses[p])),f[m]=h[p]}r.copyArray(f),r.needsUpdate=!0,s=new wn(l,c),e.set(r,s)}i.bind(s,new De)})},Ot.removeUnnecessaryVertices=function(a){const e=new Map;a.traverse(n=>{var i,r,s,l;if(!n.isMesh)return;const c=n,h=c.geometry,f=h.index;if(f==null)return;const m=e.get(h);if(m!=null)return void(c.geometry=m);const p=new Yi;p.name=h.name,p.morphTargetsRelative=h.morphTargetsRelative,h.groups.forEach(E=>{p.addGroup(E.start,E.count,E.materialIndex)}),p.boundingBox=(r=(i=h.boundingBox)===null||i===void 0?void 0:i.clone())!==null&&r!==void 0?r:null,p.boundingSphere=(l=(s=h.boundingSphere)===null||s===void 0?void 0:s.clone())!==null&&l!==void 0?l:null,p.setDrawRange(h.drawRange.start,h.drawRange.count),p.userData=h.userData,e.set(h,p);const L=[],x=[];{const E=f.array,M=new E.constructor(E.length);let S=0;for(let R=0;R<E.length;R++){const O=E[R];let k=L[O];k==null&&(L[O]=S,x[S]=O,k=S,S++),M[R]=k}p.setIndex(new St(M,1,!1))}Object.keys(h.attributes).forEach(E=>{const M=h.attributes[E];if(M.isInterleavedBufferAttribute)throw new Error("removeUnnecessaryVertices: InterleavedBufferAttribute is not supported");const S=M.array,{itemSize:R,normalized:O}=M,k=new S.constructor(x.length*R);x.forEach(($,se)=>{for(let C=0;C<R;C++)k[se*R+C]=S[$*R+C]}),p.setAttribute(E,new St(k,R,O))});let y=!0;Object.keys(h.morphAttributes).forEach(E=>{p.morphAttributes[E]=[];const M=h.morphAttributes[E];for(let S=0;S<M.length;S++){const R=M[S];if(R.isInterleavedBufferAttribute)throw new Error("removeUnnecessaryVertices: InterleavedBufferAttribute is not supported");const O=R.array,{itemSize:k,normalized:$}=R,se=new O.constructor(x.length*k);x.forEach((C,N)=>{for(let j=0;j<k;j++)se[N*k+j]=O[C*k+j]}),y=y&&se.every(C=>C===0),p.morphAttributes[E][S]=new St(se,k,$)}}),y&&(p.morphAttributes={}),c.geometry=p}),Array.from(e.keys()).forEach(n=>{n.dispose()})};new q;new Xe({color:16711935,wireframe:!0,transparent:!0,depthTest:!1});new q;const ya={name:"PeoplePage",props:{faceData:{type:Object,default:()=>({})},leftHandData:{type:Object,default:()=>({})},rightHandData:{type:Object,default:()=>({})},poseData:{type:Object,default:()=>({})}},setup(a){let e,n,i,r,s,l;const c=new Go;let h={x:0,y:1,z:0};new Fo,new it;const f=()=>{e=new Qi},m=()=>{const C=document.querySelector("#webgl");n=new Zi(45,((C==null?void 0:C.clientWidth)||0)/((C==null?void 0:C.clientHeight)||0),.1,5e3),n.position.set(0,0,2),n.lookAt(e.position),e.add(n)},p=()=>{const C=document.querySelector("#webgl");i=new zo({antialias:!0,alpha:!0}),i.setClearAlpha(0),i.setPixelRatio(window.devicePixelRatio),i.setSize((C==null?void 0:C.clientWidth)||0,(C==null?void 0:C.clientHeight)||0),i.shadowMap.enabled=!0,i.render(e,n),C==null||C.appendChild(i.domElement)},L=()=>{r=new Bo(n,i.domElement),r.target.set(0,0,0),r.autoRotate=!1,r.enableDamping=!0,r.enableZoom=!0,r.enablePan=!0},x=()=>{const C=new Gi(16777215);C.position.set(0,100,0),C.castShadow=!1,e.add(C)},y=()=>{const C=v=>{},N=v=>{},j=new ns;j.setPath("/objs/"),j.load("girl.vrm",v=>{Ot.removeUnnecessaryVertices(v.scene),Ot.removeUnnecessaryJoints(v.scene),yr.from(v).then(A=>{var te,P;s=A;const H=(te=A==null?void 0:A.humanoid)==null?void 0:te.getBoneNode(ae.HumanoidBoneName.Hips);H!=null&&(H.rotation.y=Math.PI),(P=A==null?void 0:A.springBoneManager)==null||P.reset();const U=s.scene;U.position.set(0,-1,0),e.add(U),R("RightUpperArm",{x:0,y:0,z:-1.25,rotationOrder:"XYZ"}),R("RightLowerArm",{x:-0,y:0,z:-0,rotationOrder:"XYZ"}),R("LeftUpperArm",{x:0,y:-0,z:1.25,rotationOrder:"XYZ"}),R("LeftLowerArm",{x:0,y:-0,z:0,rotationOrder:"XYZ"}),l=new ko(A.scene);const F=(B,X)=>{B.forEach(ee=>{ee.children&&ee.children.length>0?F(ee.children,ee.name):ee instanceof Kt&&X&&(ee.name=X)})};U.traverse(B=>{F(B.children,"")})})},C,N)},E=()=>{requestAnimationFrame(E);const C=c.getDelta();s&&(JSON.stringify(a.faceData)!=="{}"&&(R("Neck",a.faceData.head,.7),$(a.faceData)),JSON.stringify(a.poseData)!=="{}"&&(R("Hips",a.poseData.Hips.rotation,.7),O("Hips",{x:a.poseData.Hips.position.x+h.x,y:a.poseData.Hips.position.y+h.y,z:-a.poseData.Hips.position.z+h.z},1,.07),R("Chest",a.poseData.Spine,.25,.3),R("Spine",a.poseData.Spine,.45,.3),R("RightUpperArm",a.poseData.RightUpperArm),R("RightLowerArm",a.poseData.RightLowerArm),R("LeftUpperArm",a.poseData.LeftUpperArm),R("LeftLowerArm",a.poseData.LeftLowerArm),R("LeftUpperLeg",a.poseData.LeftUpperLeg),R("LeftLowerLeg",a.poseData.LeftLowerLeg),R("RightUpperLeg",a.poseData.RightUpperLeg),R("RightLowerLeg",a.poseData.RightLowerLeg)),JSON.stringify(a.leftHandData)!=="{}"&&(R("LeftHand",{x:a.leftHandData.LeftWrist.x,y:a.leftHandData.LeftWrist.y,z:a.poseData.LeftHand.z,rotationOrder:"XYZ"}),R("LeftRingProximal",a.leftHandData.LeftRingProximal),R("LeftRingIntermediate",a.leftHandData.LeftRingIntermediate),R("LeftRingDistal",a.leftHandData.LeftRingDistal),R("LeftIndexProximal",a.leftHandData.LeftIndexProximal),R("LeftIndexIntermediate",a.leftHandData.LeftIndexIntermediate),R("LeftIndexDistal",a.leftHandData.LeftIndexDistal),R("LeftMiddleProximal",a.leftHandData.LeftMiddleProximal),R("LeftMiddleIntermediate",a.leftHandData.LeftMiddleIntermediate),R("LeftMiddleDistal",a.leftHandData.LeftMiddleDistal),R("LeftThumbProximal",a.leftHandData.LeftThumbProximal),R("LeftThumbIntermediate",a.leftHandData.LeftThumbIntermediate),R("LeftThumbDistal",a.leftHandData.LeftThumbDistal),R("LeftLittleProximal",a.leftHandData.LeftLittleProximal),R("LeftLittleIntermediate",a.leftHandData.LeftLittleIntermediate),R("LeftLittleDistal",a.leftHandData.LeftLittleDistal)),JSON.stringify(a.rightHandData)!=="{}"&&(R("RightHand",{z:a.poseData.RightHand.z,y:a.rightHandData.RightWrist.y,x:a.rightHandData.RightWrist.x,rotationOrder:"XYZ"}),R("RightRingProximal",a.rightHandData.RightRingProximal),R("RightRingIntermediate",a.rightHandData.RightRingIntermediate),R("RightRingDistal",a.rightHandData.RightRingDistal),R("RightIndexProximal",a.rightHandData.RightIndexProximal),R("RightIndexIntermediate",a.rightHandData.RightIndexIntermediate),R("RightIndexDistal",a.rightHandData.RightIndexDistal),R("RightMiddleProximal",a.rightHandData.RightMiddleProximal),R("RightMiddleIntermediate",a.rightHandData.RightMiddleIntermediate),R("RightMiddleDistal",a.rightHandData.RightMiddleDistal),R("RightThumbProximal",a.rightHandData.RightThumbProximal),R("RightThumbIntermediate",a.rightHandData.RightThumbIntermediate),R("RightThumbDistal",a.rightHandData.RightThumbDistal),R("RightLittleProximal",a.rightHandData.RightLittleProximal),R("RightLittleIntermediate",a.rightHandData.RightLittleIntermediate),R("RightLittleDistal",a.rightHandData.RightLittleDistal)),s.update(C)),l&&l.update(C),i.render(e,n)},M=ie,S=T.lerp,R=(C,N={x:0,y:0,z:0,rotationOrder:"XYZ"},j=1,v=.3)=>{var F;const A=(F=s==null?void 0:s.humanoid)==null?void 0:F.getBoneNode(ae.HumanoidBoneName[C]);let H=new At(N.x*j,N.y*j,N.z*j,N.rotationOrder),U=new Ce().setFromEuler(H);A==null||A.quaternion.slerp(U,v)},O=(C,N={x:0,y:0,z:0},j=1,v=.3)=>{var U;const A=(U=s==null?void 0:s.humanoid)==null?void 0:U.getBoneNode(ae.HumanoidBoneName[C]);if(!A)return;let H=new q(N.x*j,N.y*j,N.z*j);A.position.lerp(H,v)};let k=new At;const $=C=>{var A,H;if(!s)return;const N=s.blendShapeProxy,j=ae.BlendShapePresetName;C.eye.l=S(M(1-(C.eye.l||0),0,1),(N==null?void 0:N.getValue(j.Blink))||0,.4),C.eye.r=S(M(1-(C.eye.r||0),0,1),(N==null?void 0:N.getValue(j.Blink))||0,.4),C.eye.l=Xt.stabilizeBlink({l:C.eye.l,r:C.eye.l},C.head.y).l,C.eye.r=Xt.stabilizeBlink({l:C.eye.r,r:C.eye.r},C.head.y).r,C.eye.l/=.8,C.eye.r/=.8,N==null||N.setValue(j.BlinkL,C.eye.l),N==null||N.setValue(j.BlinkR,C.eye.r),N==null||N.setValue(j.I,S((C==null?void 0:C.mouth.shape.I)/.8,N.getValue(j.I)||0,.3)),N==null||N.setValue(j.A,S(C.mouth.shape.A/.8,N.getValue(j.A)||0,.3)),N==null||N.setValue(j.E,S(C.mouth.shape.E/.8,N.getValue(j.E)||0,.3)),N==null||N.setValue(j.O,S(C.mouth.shape.O/.8,N.getValue(j.O)||0,.3)),N==null||N.setValue(j.U,S(C.mouth.shape.U/.8,N.getValue(j.U)||0,.3));let v=new At(S(k.x,C.pupil.y,.4),S(k.y,C.pupil.x,.4),0,"XYZ");k.copy(v),(H=(A=s==null?void 0:s.lookAt)==null?void 0:A.applyer)==null||H.lookAt(v)},se=()=>{f(),m(),p(),L(),x(),y(),E()};jo(()=>{se()})}},va={class:"main-page"},_a=Rn("div",{id:"webgl"},null,-1),xa=[_a];function Ta(a,e,n,i,r,s){return ir(),rr("div",va,xa)}var Ea=nr(ya,[["render",Ta]]);const La={name:"AnimatePeople",components:{PeoplePage:Ea},data(){return{faceData:{},leftHandData:{},rightHandData:{},poseData:{}}},mounted(){const a=document.getElementById("video"),e=document.getElementById("canvas");let n=new Et.Holistic({locateFile:s=>typeof require!="undefined"?__dirname+`/../node_modules/@mediapipe/holistic/${s}`:`../node_modules/@mediapipe/holistic/${s}`});n.onResults(s=>{r(s);const l=s.faceLandmarks,c=s.poseLandmarks,h=s.ea,f=s.rightHandLandmarks,m=s.leftHandLandmarks,p=Xt.solve(l,{runtime:"mediapipe",video:a}),L=qt.solve(h,c,{runtime:"mediapipe",video:a}),x=wi.solve(m,"Left"),y=wi.solve(f,"Right");this.faceData=structuredClone(p),this.poseData=structuredClone(L),this.leftHandData=structuredClone(x),this.rightHandData=structuredClone(y)}),new ts.Camera(a,{onFrame:async()=>{await n.send({image:a})},width:800,height:800}).start();const r=s=>{e.width=a.videoWidth,e.height=a.videoHeight;let l=e.getContext("2d");l.save(),l.clearRect(0,0,e.width,e.height),We.drawConnectors(l,s.poseLandmarks,Et.POSE_CONNECTIONS,{color:"#00cff7",lineWidth:4}),We.drawLandmarks(l,s.poseLandmarks,{color:"#ff0364",lineWidth:2}),We.drawConnectors(l,s.faceLandmarks,Et.FACEMESH_TESSELATION,{color:"#C0C0C070",lineWidth:1}),s.faceLandmarks&&s.faceLandmarks.length===478&&We.drawLandmarks(l,[s.faceLandmarks[468],s.faceLandmarks[468+5]],{color:"#ffe603",lineWidth:2}),We.drawConnectors(l,s.leftHandLandmarks,Et.HAND_CONNECTIONS,{color:"#eb1064",lineWidth:5}),We.drawLandmarks(l,s.leftHandLandmarks,{color:"#00cff7",lineWidth:2}),We.drawConnectors(l,s.rightHandLandmarks,Et.HAND_CONNECTIONS,{color:"#22c3e3",lineWidth:5}),We.drawLandmarks(l,s.rightHandLandmarks,{color:"#ff0364",lineWidth:2})}}},wa={class:"container"},Ra=Rn("video",{class:"video hidden",id:"video"},null,-1),Ma=Rn("canvas",{class:"canvas hidden",id:"canvas"},null,-1);function Sa(a,e,n,i,r,s){const l=Wo("people-page");return ir(),rr("div",wa,[Ra,Ma,Vo(l,{faceData:r.faceData,leftHandData:r.leftHandData,poseData:r.poseData,rightHandData:r.rightHandData},null,8,["faceData","leftHandData","poseData","rightHandData"])])}var Ia=nr(La,[["render",Sa]]);export{Ia as default};
